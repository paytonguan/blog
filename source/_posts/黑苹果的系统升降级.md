---
title: 黑苹果的系统升降级
categories: Mac
abbrlink: Hackintosh-Upgrade-Downgrade
date: 2019-11-26 12:24:16
tags:
---

![](topic.jpg)

以下均在Mojave的基础上进行。

<!-- more -->

# 旧版系统

以下旧版系统不支持Intel CPU，需要模拟其它CPU的架构，因此只可在虚拟机中使用。

## 现成虚拟机

```
# System 8
https://github.com/felixrieseberg/macintosh.js

# System 7.5.3
https://jamesfriend.com.au/projects/basiliskii/BasiliskII-worker.html

# System 7.0.1
https://yksoft1.github.io/emularity/minivmac/mvmac-os70.html
https://yksoft1.github.io/emularity/minivmac/mvmac2-os70.html
https://yksoft1.github.io/emularity/minivmac/mvmac-os70x.html
https://yksoft1.github.io/emularity/minivmac/mvmac2-os70x.html
http://jamesfriend.com.au/pce-js/
https://jamesfriend.com.au/pce-js/pce-js-apps/

# System 6.0.8
https://jamesfriend.com.au/pce-js/system6/

# System 6.0.7
https://yksoft1.github.io/emularity/minivmac/mvmac-os6.html
https://yksoft1.github.io/emularity/minivmac/mvmac2-os6.html
https://yksoft1.github.io/emularity/minivmac/mvmac-os6x.html
https://yksoft1.github.io/emularity/minivmac/mvmac2-os6x.html

# System 1.1
https://jamesfriend.com.au/pce-js/mobile/
```

## 虚拟机安装

### 安装文件下载

#### ROM

用于模拟机型。ROM映像通过读取安装在Macintosh中的集成电路的内容来创建，包含了设备的以及来自Apple的版权数据。

打开以下链接下载ROM，选择Old_World_Mac_Roms.zip。

```
https://www.macintoshrepository.org/7038-all-macintosh-roms-68k-ppc-

# 或以下链接，为以上内容的克隆
https://github.com/sentient06/MacROMan/tree/master/TestImages
https://archive.org/details/mac_rom_archive_-_as_of_8-19-2011
```

也可选用以下特定ROM。

```
# Old World 4mb
https://www.redundantrobot.com/sheepshaver_files/roms/mac_oldworld_rom4mb.rom.zip

# New World PPC
# 适用于SheepShaver
https://www.redundantrobot.com/sheepshaver_files/roms/newworld86.rom.zip

# Apple II
https://www.redundantrobot.com/sheepshaver_files/roms/Apple2e.zip

# Performa
# 适用于Basilisk II
https://www.redundantrobot.com/sheepshaver_files/roms/1mbMacrom.zip

# Quadra 650
https://www.redundantrobot.com/sheepshaver_files/roms/Quad650.zip

# Quadra 900
https://www.redundantrobot.com/sheepshaver_files/roms/Quadra.zip

# Mac Classic
https://www.redundantrobot.com/sheepshaver_files/roms/vmac.rom.zip
```

<details>
<summary>【进阶】从Basilisk II提取SheepShaver适用的ROM</summary>

Basilisk II需要安装Stuffit Expander。下载TomeViewer，链接如下。TomeViewer适用于System 7.1及更高版本。

```
https://www.emaculation.com/sheepshaver/tomeviewer.sit
```

可从以下两个文件之一提取SheepShaver ROM，适用于在SheepShaver启动MacOS 8.5-9.0.4。

```
# Mac OS Rom Update 1.0
https://www.emaculation.com/sheepshaver/Mac_OS_ROM_Update_1.0.smi.bin

# iMac Update 1.1
https://www.emaculation.com/sheepshaver/iMac_Update_1.1.smi.bin
```

启用文件共享，在MacOS中打开以上两个文件之一，然后打开TomeViewer，点击File-Open，选择刚才挂载的磁盘。软件将提取ROM文件，点击蓝色图标保存即可。
</details>

#### 安装盘

用于安装系统。

##### Panther

```
https://winworldpc.com/product/mac-os-x/103

# Panther_CD1.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Panther_CD1.toast_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Panther_CD1.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Panther_CD1.toast_.zip
http://old.macintosh.garden/apps/Panther_CD1.toast_.zip

# Panther_CD2.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Panther_CD2.toast_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Panther_CD2.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Panther_CD2.toast_.zip
http://old.macintosh.garden/apps/Panther_CD2.toast_.zip

# Panther_CD3.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Panther_CD3.toast__0.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Panther_CD3.toast__0.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Panther_CD3.toast__0.zip
http://old.macintosh.garden/apps/Panther_CD3.toast__0.zip

# Panther 10.3 - Apple Internal Edition DVD
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/pantherappleint.cdr_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/pantherappleint.cdr_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/pantherappleint.cdr_.zip
http://old.macintosh.garden/apps/pantherappleint.cdr_.zip

# Panther 10.3.2 - CD 691-4822-A & 691-4823-A
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/691-4822-A_691-4823-A.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/691-4822-A_691-4823-A.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/691-4822-A_691-4823-A.zip
http://old.macintosh.garden/apps/691-4822-A_691-4823-A.zip
```

##### Jaguar

```
https://winworldpc.com/product/mac-os-x/102

# Jaguar_CD1.toast_.sit
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Jaguar_CD1.toast_.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Jaguar_CD1.toast_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Jaguar_CD1.toast_.sit
http://old.macintosh.garden/apps/Jaguar_CD1.toast_.sit

# Jaguar_CD2.toast_.sit
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Jaguar_CD2.toast_.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Jaguar_CD2.toast_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Jaguar_CD2.toast_.sit
http://old.macintosh.garden/apps/Jaguar_CD2.toast_.sit
```

##### Puma

```
https://winworldpc.com/product/mac-os-x/101

# 10.1.3
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Mac_OSX_10_1_3.toast_.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Mac_OSX_10_1_3.toast_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Mac_OSX_10_1_3.toast_.sit
http://old.macintosh.garden/apps/Mac_OSX_10_1_3.toast_.sit

# 10.1
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/MacOS_10_1.toast__0.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/MacOS_10_1.toast__0.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/MacOS_10_1.toast__0.sit
http://old.macintosh.garden/apps/MacOS_10_1.toast__0.sit
```

##### Cheetah

```
https://winworldpc.com/product/mac-os-x/100

# 10.0.3
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/MacOS_10_0_3.toast__0.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/MacOS_10_0_3.toast__0.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/MacOS_10_0_3.toast__0.sit
http://old.macintosh.garden/apps/MacOS_10_0_3.toast__0.sit

# Mac_OS_X_Cheetah_CD.dmg_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Mac_OS_X_Cheetah_CD.dmg_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/OSX_10.0_Internal.cdr_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Mac_OS_X_Cheetah_CD.dmg_.zip
http://old.macintosh.garden/apps/Mac_OS_X_Cheetah_CD.dmg_.zip
```

##### Kodiak

```
https://winworldpc.com/product/mac-os-x/developer-previews

# OSX_10.0_Internal.cdr_.sit
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/OSX_10.0_Internal.cdr_.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/OSX_10.0_Internal.cdr_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/OSX_10.0_Internal.cdr_.sit
http://old.macintosh.garden/apps/OSX_10.0_Internal.cdr_.sit


# Mac OS X Public Beta 1H39 (ZM691-2794-A)
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/ZM691-2794-A.toast_.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/ZM691-2794-A.toast_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/ZM691-2794-A.toast_.sit
http://old.macintosh.garden/apps/ZM691-2794-A.toast_.sit


# Mac OS X Public Beta 2E14 (ZM691-2858-A)
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/ZM691-2858-A.toast_.sit
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/ZM691-2858-A.toast_.sit
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/ZM691-2858-A.toast_.sit
http://old.macintosh.garden/apps/ZM691-2858-A.toast_.sit
```

##### Rhapsody

```
https://winworldpc.com/product/mac-os-x/rhapsody
```

##### Server 1.0

```
https://winworldpc.com/product/mac-os-x/server-10
```

##### System 9

```
# 根据个人需求选择版本
https://winworldpc.com/product/mac-os-9/90
```

##### System 8

```
# 根据个人需求选择版本
https://winworldpc.com/product/mac-os-8/80-final
```

##### System 7

```
# 根据个人需求选择版本
https://winworldpc.com/product/mac-os-7/70

# 7.0.1
https://drive.google.com/drive/folders/1mPoKlNEpizEmGF5h6DC0gtrOnx7jxHAI
```

##### System 6

```
https://winworldpc.com/product/mac-os-0-6/system-6x
```

##### System 5

```
https://winworldpc.com/product/mac-os-0-6/system-5x
```

##### System 4

```
https://winworldpc.com/product/mac-os-0-6/system-4x
```

##### System 3

```
https://winworldpc.com/product/mac-os-0-6/system-3x
```

##### System 2

```
https://winworldpc.com/product/mac-os-0-6/system-2x
```

##### System 1

```
https://winworldpc.com/product/mac-os-0-6/system-1x
```

#### 空白磁盘映像

用于提供磁盘空间。

打开以下链接下载空白磁盘映像。

```
# System 7选择5MB
https://sites.google.com/site/minivmacapplicationsv6/disk-images-and-roms

# 或以下链接
https://www.gryphel.com/c/minivmac/extras/blanks/index.html
```

### Mini vMac

模拟基于Motorola 68K的黑白Mac Plus，支持MacOS 1.1-7.5.5。下载链接如下。

```
https://www.gryphel.com/c/minivmac/download.html
```

在Mini vMac界面上，按住Control可弹出控制模式界面。Control+M让显示范围变大，Control+F全屏显示。

<details>
<summary>【特殊】iOS版本</summary>

iOS安装包下载链接如下。

```
https://github.com/zydeco/minivmac4ios
```
</details>

#### 模拟为Macintosh II

下载Mini vMac时，版本选择Macintosh II Variations。根据自己的操作系统下载对应安装包。

新建文件夹，将Mini vMac、磁盘映像和ROM包中的`1988-09 - 97221136 - Mac II FDHD & IIx & IIcx.ROM`放在一起，并将ROM重命名为`MacII.ROM`。打开Mini vMac，即模拟为Macintosh II，屏幕出现一个带有问号的软盘图标。

以安装System 7.0.1为例，拖动System 7.0.1安装盘中的Install 1.img至窗口，即可看到安装向导。拖动空白磁盘映像至窗口，以提供安装位置，然后点击Install即可，其中需要安装提示拖动不同的System 7安装盘至窗口。

安装完成后点击Quit-Rstart，拖动刚才的磁盘映像到窗口，即可加载系统。

#### 模拟为Macintosh Plus

前面下载时Mini vMac的版本选择Standard Variations，使用ROM包中的`1986-03 - 4D1F8172 - MacPlus v3.ROM`即可，注意需要重命名为`vMac.ROM`。打开后即模拟为Macintosh Plus。

### SheepShaver

#### 基本使用

模拟基于Power PC的Macintosh，支持MacOS 7.5.2-9.0.4。下载链接如下。

```
https://www.emaculation.com/forum/viewtopic.php?f=20&t=2409&sid=65c645c9dc937e59251f3ff05916b177
```

下载好ROM后重命名为`Mac OS ROM`，注意无后缀名，然后与SheepShaver放置在同一目录。打开应用，屏幕出现一个带有问号的软盘图标。点击菜单栏的Preferences，在Volumes手动添加安装盘即可。

接下来的步骤与Mini vMac一致。

#### 常见问题

##### 无法使用音频

若系统为Linux，可在终端输入以下命令。

```
sudo apt-get install osspd
```

然后使用以下命令打开SheepShaver。

```
padsp /usr/bin/SheepShaver
```

### Basilisk II

#### 基本使用

模仿基于摩托罗拉68k色彩的Mac，支持MacOS 7.x-8.1。最新版本下载链接如下，需要下载Basilisk II和Basilisk II GUI。

```
https://www.emaculation.com/doku.php/basilisk_ii
```

以Mac为例，需要下载以下两个文件。

```
# Basilisk II
https://www.emaculation.com/forum/viewtopic.php?f=6&t=7361

# Basilisk II GUI
https://www.emaculation.com/forum/viewtopic.php?f=6&t=10454
```

下载好ROM后打开Basilisk II GUI，点击菜单栏的Preferences，在Volumes手动添加安装盘，在System的ROM File选择下载好的ROM文件，点击Start即可。接下来的步骤与Mini vMac一致。

注意，若在Linux下使用Basilisk II，需要将安装盘设置为只读，且不要以root身份运行Basilisk II，否则将无法进行安装。

<details>
<summary>【进阶】详细配置</summary>

以Linux版的Basilisk II为例。该软件可通过系统包管理器获取。

```
# Volumes
点击create创建磁盘，大小一般小于200MB
Unix Root用于设置共享目录
Boot from设置为Any
disable CD-ROM driver不要勾选

# Graphics/Sound
设置运行时窗口的宽度和高度

# Keyboard/Mouse
使用US英语布局的QWERTY键盘不需要键盘配置文件，否则需要以下配置文件
http://www.xs4all.nl/~ronaldpr/sheepshaverforum/keycodes.zip

# Serial/Network
若需要启用网络，可设置为以下两种模式之一
（1）slirp
在Mac OS内需要按照以下配置连接
Connect via: Ethernet
Configure: DHCP
若没有网络，修改为以下内容
Connect via: Ethernet
Configure: Manually
IP address: 10.0.2.5
Subnet Mask: 255.255.255.0
Router Address: 10.0.2.2
Name server addr: 10.0.2.3
（2）eth0
需要正确安装sheep_net驱动后才会显示
在Mac OS内需要将TCP/IP设置为手动，然后设置IP、子网、路由器和DNS信息

# Memory/Misc
保持默认

# JIT Compiler
保持默认
```
</details>

#### 文件共享

可使用HFVExplorer。

```
https://emaculation.com/quick/hdexp131.zip
```

也可在设置中勾选`Enable 'My Computer' icon`，以在MacOS中访问当前文件系统。

### QEMU

支持MacOS 9.0.4-10.5。

#### 安装

在终端输入以下命令即可。

```
brew install qemu
```

<details>
<summary>【进阶】对于Mac OS X 10.4及以上版本</summary>

需要使用以下特殊版本。

```
https://static.imvictor.tech/static-old/201709/qemu-mac99p.zip
```

需在同目录下新建`qemu.command`，内容如下。保存后运行即可。

```
#!/bin/bash
cd "$(dirname "$0")"
./qemu-system-ppc-wip -bios openbios-qemu-wip.elf -L pc-bios -boot c -m 1024 -M mac99p -prom-env "auto-boot?=true" -net nic,model=e1000 -net user -hda osx_tiger.qcow2 -hdb swap.img
```
</details>

#### 使用

##### 生成虚拟硬盘镜像

选择其中一种格式即可。

```
# 生成IMG
qemu-img create -f raw disk.img 20G

# 生成QCOW2
qemu-img create -f qcow2 -o preallocation=metadata disk.qcow2 20G
```

##### 启动

在终端输入以下命令以打开。

```
# 内存256MB
# 磁盘disk.qcow2
# 光盘镜像macos9.iso，从光盘启动（首次安装时需要，启动时不需要）
qemu-system-ppc -M mac99 -m 256 -hda disk.qcow2 [-cdrom macos9.iso -boot d]
```

该命令格式如下。

```
qemu-system-x86_64 [参数]
```

其中参数如下。

|                                 参数                                 |          说明         |        选项       |
|----------------------------------------------------------------------|-----------------------|-------------------|
| -hda A.qcow2                                                         | 第一块内置硬盘的镜像  |                   |
| -hdb B.img                                                           | 第二块内置硬盘的镜像  |                   |
| -cdrom C.iso                                                         | 光盘镜像              |                   |
| -m 512                                                               | 内存（以MB为单位）    |                   |
| -boot c                                                              | 第一启动项为硬盘      | c-硬盘</br>d-光盘 |
| -net user                                                            | 网络配置              |                   |
| -M mac99p                                                            | 机型为mac99p          |                   |
| -prom-env "boot-args=-v"                                             | 向NVRAM写入启动参数-v |                   |
| -vga virtio                                                          |                       |                   |
| -display default,show-cursor=on                                      |                       |                   |
| -usb                                                                 |                       |                   |
| -device usb-tablet                                                   |                       |                   |
| -machine type=q35,accel=hvf                                          |                       |                   |
| -smp 2                                                               |                       |                   |
| -cpu Nehalem                                                         |                       |                   |
| -drive file=windows.iso,index=1,media=cdrom                          |                       |                   |
| -drive file=/Users/slanla/qemu/disk.img,index=0,format=raw,if=virtio |                       |                   |

### PearPC

仅可用于Windows和Linux，可用于Mac OS 10.3。

下载链接如下，注意需要下载源程序和空白磁盘。空白磁盘解压所得的bz2压缩包，并与ppc程序放置在同一目录。将安装盘也放置在同一目录。

```
http://pearpc.sourceforge.net/downloads.html
```

复制ppccfg.example并重命名，用文本编辑器打开。主要修改以下内容。

```
# 磁盘0
## 是否被安装，1为是，0为否
## 磁盘路径，为刚才的空白磁盘
pci_ide0_master_installed = 1
pci_ide0_master_image = "102.img"
#pci_ide0_master_type = "hd"

# 光盘0
## 是否被安装，1为是，0为否
## 光盘路径，为安装盘
## 光盘类型
pci_ide0_slave_installed = 1
#pci_ide0_slave_image = "e:\"
#pci_ide0_slave_image = "2,0,0"
pci_ide0_slave_image = "/dev/cdrom"
pci_ide0_slave_type = "cdrom"
```

打开命令提示符，切换到ppc程序所在路径后输入以下命令即可。

```
ppc [配置文件名]
```

### 现成磁盘映像

以下磁盘映像无需进行安装步骤，直接挂载即可使用。

#### Jaguar

适用于QEMU，磁盘映像如下。

```
http://macintoshgarden.org/apps/mac-os-x-102-pre-made-qemu-hard-drive
```

终端切换到磁盘映像所在目录，运行以下命令即可。

```
# 10.2.img为磁盘映像
qemu-system-ppc -hda 10.2.img -m 512 -boot c -net nic,model=e1000 -net user
```

#### System 9

适用于SheepShaver。设置好ROM后，在Preferences中添加该磁盘镜像即可。

```
# 9.0
https://www.redundantrobot.com/sheepshaver_files/disk_images/OS9.img
```

#### System 7

适用于Mini vMac。设置好ROM后，将以上镜像直接拖到窗口即可。

```
# 7.5.3
https://archive.org/details/AppleMacintoshSystem753
https://archive.org/details/HyperCardVol1
https://archive.org/details/HyperCardVol2
```

# 系统升级

## 基本知识

一般的小版本更新，如10.15.2升级10.15.3，可以直接在系统内升级。在「系统偏好设置」或「关于本机」中进去系统更新检查。当进度条走完后点击重启，在 Clover 引导界面会出现 Boot macOS install from xxxxx ，方向键选中并按空格，勾选 Verbose(-v) 和 nv_disable=1 后再启动。跑完日志和进度条后会开始升级、自动重启，如果重启后 Clover 中的 Boot macOS install from xxxxx 没有消失则重复上述操作（一般系统更新也需要二次安装）。升级成功后 Clover 引导界面下的 Boot macOS install from xxxxx 会消失。选择 Boot macOS install from xxxxx 进入系统即可。

## Catalina

### 下载

在黑果小兵的部落阁下载即可。

在Mac下也可通过以下链接，通过App Store下载。

```
https://apps.apple.com/cn/app/macos-catalina/id1466841314?mt=12
```

也可通过以下链接。

```
链接 / https://cloud.189.cn/t/UFNFvauUVjua
提取码 / 5ckc
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

### 必要配置

#### 配置EC

升级Catalina需要将EC控制器名称改为EC，否则系统启动崩溃。

##### 对于台式机

如果为台式机，可直接禁用EC。

###### 通过阻止AppleACPIEC

以OpenCore为例，在config.pilst中进入Kernel/Block，添加以下内容即可。

| 选项        | 内容                         |
| ----------- | ---------------------------- |
| Enabled     | True                         |
| Indentifier | com.apple.driver.AppleACPIEC |

###### 通过SSDT

可通过脚本自动添加。下载SSDTTime，解压后运行SSDTTime.command，选择Fake EC并拖拽DSDT文件以自动生成SSDT，放于引导器的ACPI部分即可。

也可手动添加。将以下代码复制到MaciASL中，将EC0改为对应的EC名称，另存为SSDT-no-EC.aml，放于引导器的ACPI部分即可。

```
DefinitionBlock ("", "SSDT", 2, "ACDT", "SsdtnoEC", 0x00001000)
{
    External (_SB.PCI0.LPCB, DeviceObj)
    External (_SB.PCI0.LPCB.EC0, DeviceObj)

    Scope (\_SB.PCI0.LPCB.EC0)
    {
        Method (_STA, 0, NotSerialized)  // _STA: Status
        {
            If (_OSI ("Darwin"))
            {
                Return (0)
            }
            Else
            {
                Return (0x0F)
            }
        }
    }
}
```

##### 对于笔记本

由于笔记本有电池，不能禁用EC。

打开系统DSDT，搜索PNP0C09，查看对应的EC名称。若不止一个，则需要判断此EC是否被屏蔽，主要看其_STA方法是否存在Return (Zero)，若存在，则说明此设备被禁用。如本机对应两个EC名称H_EC和EC0，但只有EC0未被屏蔽，则只需对EC0进行改名。

更名补丁示例如下，注意EC0需改成自己对应的EC设备名。

```
Comment: Rename EC0 to EC 
Find: 4543305F 
Replace: 45435F5F
```

#### 更新kexts

将要用到的kexts更新到最新版本。本机在未更新Lilu和Whatevergreen的情况下显卡出现GFX Firmware问题。 

### 系统使用

#### 解锁系统分区

Catalina的系统分区被锁定，无法直接修改系统盘内的文件。进行SLE路径的驱动安装等操作需要解锁。

##### 通过终端

```
sudo su
sudo mount -uw / && killall Finder
```

##### 通过自动执行脚本

打开系统的`自动操作`程序，选择应用程序-运行Shell脚本，修改Shell为/bin/bash并将以下脚本粘贴进去，保存为unlockSystem.app。

```
#! /bin/bash
echo '电脑密码' | sudo -S mount -uw / && killall Finder
```

打开偏好设置-用户与群组，在登录项中将unlockSystem.app添加到启动项并勾选隐藏即可。

##### 通过plist

将以下内容保存为CatalinaAutoMountWritable.plist，并放在系统盘的Library/LaunchDaemons即可。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>KeepAlive</key>
    <false/>
    <key>RunAtLoad</key>
    <true/>
    <key>LaunchOnlyOnce</key>
    <true/>
    <key>Label</key>
    <string>CatalinaAutoMountWritable</string>
    <key>ProgramArguments</key>
    <array>
        <string>/sbin/mount</string>
        <string>-uw</string>
        <string>/</string>
    </array>
</dict>
</plist>
```

#### 解锁Sidebar

部分机型不支持Sidebar，可通过修改机型或在终端输入以下命令解锁。

```
// 绕过SMBIOS限制
defaults write http://com.apple .sidecar.display allowAllDevices -bool YES

// 解锁系统首选项中Sidebar页
defaults write com.apple.sidecar.display hasShownPref -bool true
```

## Big Sur

支持的SMBIOS如下。

```
iMac14,4及更新
MacPro6,1及更新
iMacPro1,1及更新
MacMini7,1及更新
MacBook8,1及更新
MacBookAir6,x及更新
MacBookPro11,x及更新
```

### 特性

即使关闭SIP，root用户依然无法挂载根目录为读写。这意味着直接修改System文件夹内的文件需要到Recovery模式下的终端修改。

因此，单用户模式下不能再加载launchd服务，也不能通过调用OpenDirectory服务修改root密码和管理员密码。

```
launchctl load /S*/L*/LaunchDaemons/com.apple.opendirectory.plist
```

launchctl在单用户模式加载的服务会自动停止运行，同时屏幕显示service only ran for 5 seconds，无法在单用户模式找回管理员密码。

同时，单用户模式中加载kext的kextload命令也失去了效果，被/usr/bin/kmutil接替，不允许绕过系统安全性设置来加载kext，这意味着root用户不能通过终端加载kext。

同时，AppleIntelInfo.kext已经无法用于获取当前CPU状态。

对于AirportBrcmFixup，可能需要使用`brcmfx-driver=`参数以强制加载驱动，如BCM94352Z用户可能需要使用brcmfx-driver=2。同时需要阻止AirPortBrcm4360_Injector.kext加载，可将其MaxKernel设置为19.9.9。

### 下载

在黑果小兵的部落阁下载即可。

在Mac下也可通过以下链接，通过App Store下载。

```
https://apps.apple.com/cn/app/macos-big-sur/id1526878132?mt=12
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ Big\ Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

<details>
<summary>【进阶】安装在旧版实体Mac机器上</summary>

支持Catalina的实体Mac中部分不支持Big Sur，但可以通过制作安装盘并修改安装盘必要内容的方式顺利安装。

对于Mac Mini 2012和其它支持Catalina的设备，可下载以下补丁并解压。

```
https://github.com/barrykn/big-sur-micropatcher
```

在终端以管理员身份运行micropatcher.sh，选择制作好的安装盘进行修补。如果找不到安装盘，在运行时可将安装盘路径附加到后面，如下。

```
./micropatcher.sh [安装盘路径，如/Volumes/ABC]
```

同理以管理员身份运行install-setvars.sh。对于2013年末的iMac，该脚本将启用SIP和ARV（Authenticated Root Volume，经过身份验证的根卷）。

注意，若希望显示详细日志，可在其后添加参数`-v`。若希望强制禁用SIP和ARV，可在其后添加参数`-d`。若希望强制启用，则可添加参数`-e`。

修补完成后，将安装盘插入到Mac机器，重启并按住Option，然后选择安装盘即可。

若安装完成后出现panic，则按Command+Q，机器将重新启动。重新进入安装盘，打开终端并输入以下命令以安装WiFi补丁。

若希望尝试不同的WiFi补丁，可在脚本后添加参数--wifi=hv12v-old。若需要设置重写或不重写快照，可添加参数--create-snapshot或--no-create-snapshot。

```
# Image\ Volume为安装盘名称
# Macintosh\ HD为系统盘名称
# 用于普通Mac
/Volumes/Image\ Volume/patch-kexts.sh /Volumes/Macintosh\ HD

# 用于2010年或更旧的Mac（2009-2010Mac Pro除外）
/Volumes/Image\ Volume/patch-kexts.sh --2010 /Volumes/Macintosh\ HD
```

还可通过zap-snapshots.sh删除除最新快照外的所有快照，命令如下。

```
/Volumes/Image\ Volume/zap-snapshots.sh /Volumes/Macintosh\ HD
```
</details>


### 必要配置

除以下列出的项目外，其它与Catalina基本一致。

#### 硬盘驱动

对于OpenCore引导，可能需要CtlnaAHCIPort，否则无法正常识别SATA硬盘。Clover引导不需要该kext。

建议将CtlnaAHCIPort.kext的MinKernel值设置为20.0.0，以避免任何潜在的冲突。

```
https://github.com/dortania/OpenCore-Install-Guide/blob/master/extra-files/CtlnaAHCIPort.kext.zip
```

<details>
<summary>【进阶】原因</summary>

Apple从AppleAHCIPort.kext中删除了AppleIntelPchSeriesAHCI类。
</details>

### 引导器修改

Big Sur需要Clover版本至少为5120，且需要使用OcQuirks作为内存管理驱动。

需要额外添加的启动参数如下。

```
// DW1820A/DW1560/DW1830等博通网卡可能还需要添加brcmfx-aspm
plugin-type=1 vsmcgen=1 -lilubetaall -vsmcbeta
```

安装重启后的第二阶段，如果直接从安装盘启动，会一直循环com.apple.xpc.launchd[1]。这时需要在CLOVER主引导界面按F3，选择Preboot以继续完成安装。

注意部分指南会指出不应使用NoTouchID.kext，但使用该kext能大大提升系统速度，因此还是推荐使用。

OpenCore基本与Clover一致。

### 系统使用

注意不要用Karbiner，不要开启Airdrop有线传输。

#### 禁用SIP

对于OpenCore，打开config.plist，进入NVRAM-add-7C436110-AB2A-4BBB-A880-FE41995C9F82，并修改csr-active-config为FF0F0000，然后进入NVRAM-block-7C436110-AB2A-4BBB-A880-FE41995C9F82，添加`csr-active-config`一项。

然后进入系统恢复模式，输入以下命令后重启。

```
csrutil disable
csrutil authenticated-root disable
```

#### 重建kexts缓存

Big Sur重建缓存的命令有所变化，如下。

```
sudo chown -R root:wheel ~/livemount/System/Library/Extensions/
sudo chmod -R 755 ~/livemount/System/Library/Extensions/
sudo kmutil install --volume-root ~/livemount --update-all
sudo kcditto
```

#### 修改系统文件

Big Sur从快照启动，通过`sudo mount -uw /`挂载系统分区时会出现failed with 66的错误。

需要通过挂载系统分区，修改分区内容后新建系统分区快照，并指定启动时使用该快照，达到修改系统文件的目的。

注意，由于此方法会使快照的状态变为broken，所以只适用于OpenCore引导，并设置SecureBootModel为Disabled。若使用Clover引导或未设置SecureBootModel，则会启动到恢复模式。

确保禁用SIP后，打开终端并输入以下命令。

```
mkdir ~/livemount
diskutil list
// 查找系统分区，如disk1s5
sudo mount -o nobrowse -t apfs /dev/disk1s5 ~/livemount
```

前往用户目录，即可看到挂载的系统分区。在该目录下进行系统修改操作。完成后回到终端并输入以下命令，以创建新的快照。

```
sudo bless --folder ~/livemount/System/Library/CoreServices --bootefi --create-snapshot
```

<details>
<summary>其它方法</summary>

确保禁用SIP后，进入恢复模式，打开终端并输入以下命令。

```
diskutil list
// 查找系统分区，如disk1s5
diskutil mount disk1s5
ls -l /Volumes/
// 查找系统分区名称，如Samsung 1（因为挂载了快照，真正的系统分区后面会有一个1）
sudo mount -uw /Volumes/Samsung\ 1
sudo su
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -v /Volumes/Samsung\ 1 -r""

diskutil apfs listSnapshots disk1s5
// 删除所有快照
diskutil apfs deleteSnapshot disk1s5 -uuid [UUID]
```
</details>

#### 安装kext到SLE

确保禁用SIP后，打开终端并输入以下命令。

```
sudo kcditto
```

记录Volume Group UUID和Preboot disk。然后进入恢复模式，打开终端并输入以下命令。

```
diskutil mount /Volumes/[系统分区名称]
mount -uw /Volumes/[系统分区名称]
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -s "Before" -v /Volumes/[系统分区名称]
cd /Volumes/[系统分区名称]
```

命令执行完成后可通过终端完成文件移动操作。以安装IO80211Family为例，命令如下。

```
cd /Volumes/[系统分区名称]/System/Library/Extension
mv IO80211Family.kext IO80211Family.kext.backup
cp -r /Volumes/[IO80211Family的位置]/IO80211Family.kext .
```

完成后需要重建内核缓存，命令如下。

```
kmutil install --update-all --volume-root /Volumes/[系统分区名称]
```

继续执行以下命令以新建快照。

```
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -s "After" -v /Volumes/[系统分区名称]
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -r "After" -v /Volumes/[系统分区名称]
```

然后需要将更新后的BootKernelExtensions复制到Preboot分区。输入以下命令。

```
diskutil mount /dev/[前面记录的Preboot disk]
cd /Volumes/Preboot
ls
// 确保存在以前面记录的Volume Group UUID为名的文件夹
cp -r [Volume Group UUID] [Volume Group UUID].bak
cd /Volumes/Preboot/[Volume Group UUID]/boot/System/Library/KernelCollections
cp /Volumes/[系统分区名称]/System/Library/KernelCollections/BootKernelExtensions.kc .
cp /Volumes/[系统分区名称]/System/Library/KernelCollections/BootKernelExtensions.kc.elides .
```

完成后重启即可。若失败，则进入恢复模式或引导到USB安装器，打开终端并输入以下命令，重启即可。

```
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -r "Before" -v /Volumes/[系统分区名称]
cd /Volumes/Preboot
mv [Volume Group UUID] [Volume Group UUID].broken
cp -r [Volume Group UUID].bak [Volume Group UUID]
```

#### 常用命令

##### 重建内核缓存

```
kmutil install --update-all --volume-root /Volumes/[系统分区名称]
```

### 特殊安装方法

可通过VMWare在实体机上进行安装。需要本机同时安装有旧版Mac和Windows。

在Mac下打开磁盘工具，并分出一个新的APFS容器，建议分60G以上。打开VMWare Fusion并创建自定虚拟机，系统选择macOS的任意版本，选择新建虚拟磁盘。新建完成后调整内存大小，尽量调大以防止安装时卡住。

下载Paragon VMDK Mounter并激活，激活码如下。

```
VMDK-MOUNTER-2014-434979472，51537-43450-1B2D9-8213A
```

用Paragon VMDK Mounter打开新建的虚拟机，挂载刚创建的分区。若出现VDM API Error错误，则在系统偏好设置-安全性与隐私-通用中允许软件载入。

打开磁盘工具，将挂载好的VMDK外置磁盘格式化为`macOS扩展（日志式）`，名称为`Big Sur Installer`。完成格式化后将Big Sur安装包复制到应用程序，然后打开终端并输入以下命令以将安装包写入VDMK磁盘。

```
sudo /Applications/Install\ macOS\ Big\ Sur\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/Big\ Sur\ Installer
```

完成后在磁盘工具卸载VMDK磁盘，打开虚拟机检查是否能正常进入安装界面，若没有问题则直接关机。

将创建好的虚拟机复制到Windows，安装VMWare Workstation Pro并激活，双击虚拟机中的VMX文件以导入。打开VMX文件并添加以下内容，其中SMBIOS的应当用新的内容替换。

```
board-id.reflectHost = "FALSE"
board-id = "Mac-937A206F2EE63C01"
hw.model.reflectHost = "FALSE"
hw.model = "MacBookPro15,1"
serialNumber.reflectHost = "FALSE"
serialNumber = "D25XVQYDKGYG"
smbios.reflectHost = "FALSE"
```

打开VMWare macOS补丁Unblocker 302中的win-install，注意需要以管理员模式运行。进入VMWare Workstation Pro并选择刚才的虚拟机，点击编辑虚拟机设置，选择添加-硬盘-SATA-使用物理磁盘，设备选择之前在Mac下分出的APFS容器对应的设备，选择使用单个分区，然后根据分区大小选择对应的APFS容器。

开启虚拟机并完成安装，然后重启电脑即可通过OpenCore进入系统。

### 常见问题

#### 启动过程

##### 卡AppleACPICPU/x86Platform plugin

继续等待较长时间即可。在引导器的ACPI部分加入OC-little包X86注入部分的SSDT-PLUG即可修复。

##### 卡Forcing CS_RUNTIME for entitlement

安装程序仍在运行，等待即可。

##### 卡disk1s1 is locked

继续等待即可。

##### 卡PCI Configuration Begins

一般出现在X99/X299主板，主要为RTC设备问题。可使用以下SSDT补丁解决。

```
https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-RTC0-RANGE.dsl
```

##### 卡ramrod(^^^^^^^^^^^^^)

SMC错误。更新最新的VirtualSMC和Lilu，并添加vsmcgen=1启动参数。若无效，可切换为Rehabman的FakeSMC。

##### 卡waiting for root device

有可能是因为没有放VoodooI2C.kext，导致卡在IOUSBDevice。注意放置VoodooI2C.kext后，需要禁用其中的VoodooInput.kext.dYSM和VoodooInput.kext，因为VoodooI2C与VoodooPS2都有VoodooInput，两者会发生冲突。

##### 出现Couldn't alloc class "AppleIntelPchSeriesAHCI"

添加启动参数smcgen=1。

##### 内核错误

###### Rooting from the live fs of a sealed volume is not allowed on a release build

修改系统快照导致。

对于OpenCore，更新至0.6.4或更新即可，也可通过设置SecretBootModel为Disabled以解决。对于Clover，由于无法设置SecretBootModel，需要恢复为未修改的快照。

注意，快照没有被破坏时，SecureBootModel可以设为Default。

可打开终端并输入以下命令以判断快照情况。若返回Snapshot Sealed为Yes，则未被修改。若为Broken，则快照被修改，可进入恢复模式，通过时间恢复机器回滚到以前的快照，或重新安装。

```
diskutil apfs list
Volume [disk number(disk1s8)] [UUID(A604D636-3C54-4CAA-9A31-5E1A460DC5C0)]
```

###### cannot perform kext scan

加载了多个VoodooInput。VoodooI2C和VoodooPS2都有VoodooInput，两者只能启用一个。

###### IOPCIFamily

一般出现在X79/X99主板，主要由于在ACPI中启用了未使用的非核心PCI桥接器导致。可使用以下SSDT补丁解决。

```
https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-UNC.dsl
```

###### max_cpus_from_firmware not yet initialized

确保OpenCore版本为0.6.0以上，并启用AvoidRuntimeDefrag这一Quirk。

在配置文件的Kernel-Patch添加以下补丁可能会有用，注意需将BB804000000C3中的04替换为硬件支持的CPU线程数。

|     选项    |                    值                    |
|-------------|------------------------------------------|
| Base        | `_acpi_count_enabled_logical_processors` |
| Count       | 1                                        |
| Enabled     | True                                     |
| Find        |                                          |
| Identifier  | Kernel                                   |
| Limit       | 0                                        |
| Mask        |                                          |
| MaxKernel   |                                          |
| MinKernel   | 20.0.0                                   |
| Replace     | B804000000C3                             |
| ReplaceMask |                                          |
| Skip        | 0                                        |

#### 系统运行

##### 设备属性注入失败

打开IORegistryExplorer并切换到对应设备，查看acpi-path属性是否存在。若不存在，则需要创建一个提供完整路径的SSDT，因为可能有一个未记录在ACPI表中的PCI桥接器。示例如下。

```
https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-BRG0.dsl
```

##### 基于HID的键盘/鼠标失效

在配置文件的Kernel-Patch添加以下补丁。

|     选项    |             值              |
|-------------|-----------------------------|
| Base        | _isSingleUser               |
| Count       | 1                           |
| Enabled     | True                        |
| Find        |                             |
| Identifier  | com.apple.iokit.IOHIDFamily |
| Limit       | 0                           |
| Mask        |                             |
| MaxKernel   |                             |
| MinKernel   | 20.0.0                      |
| Replace     | B801000000C3                |
| ReplaceMask |                             |
| Skip        | 0                           |

##### DRM视频解码黑屏

可尝试添加启动参数`shikigva=80`。

##### 状态栏卡顿

找不到wifi设备造成。使用USB网卡或无网卡时，需要删除WiFiAgent启动项，在终端运行以下命令即可。

```
mount -o rw /
cd /System/Library/LaunchAgents
sudo mv com.apple.wifi.WiFiAgent.plist ../LaunchAgentsIgnored
```

##### 无法升级到更新的Big Sur版本

可能是Update Utility损坏，常见于Beta更新。在终端输入以下命令即可。

```
# Unenroll from beta catalog
sudo /System/Library/PrivateFrameworks/Seeding.framework/Resources/seedutil unenroll

# Enroll back in
sudo /System/Library/PrivateFrameworks/Seeding.framework/Resources/seedutil enroll DeveloperSeed
```

完成后可通过以下命令进行软件更新。

```
# List software updates via terminal
softwareupdate -l
```

若问题仍存在，可能是快照损坏。在终端输入以下命令以判断。

```
# List all APFS volumes
diskutil apfs list

# 替换为系统分区
Volume disk1s8 A604D636-3C54-4CAA-9A31-5E1A460DC5C0
```

若结果为`Snapshot Sealed: Broken`，则需要将OpenCore更新至0.6.4或更新，然后回滚系统快照。进入恢复模式后选择Restore From Time Machine Backup即可。

# 系统降级

以下均在Mojave的基础上进行。

注意Lilu及插件（包括VirtualSMC）需要Mountain Lion及更高版本才可运行。VirtualSMC需要Snow Leopard及更高版本，较低版本可使用FakeSMC。AppleALC需要Mountain Lion及更高版本才可运行，较低版本可使用VoodooHDA（10.6+）或VoodooHDA-FAT（10.5，32位CPU)。下载链接如下。

```
# VoodooHDA-FAT
https://github.com/khronokernel/Legacy-Kexts/blob/master/FAT/Zip/VoodooHDA.kext.zip
```

Snow Leopard及更低版本在使用OpenCore引导时需要启用RebuildAppleMemoryMap，以解决早期内核问题。Snow Leopard及更低版本仅支持iASL 4/5编译的DSDT/SSDT，不支持iASL 6。

## High Sierra

### 下载

在黑果小兵的部落阁下载即可。此处使用10.13.6，使用10.13可能会出现`OSInstall.mpkg似乎已缺失或已损坏`的问题。

在Mac下也可通过以下链接，通过App Store下载。

```
https://apps.apple.com/cn/app/macos-high-sierra/id1246284741?mt=12
```

也可通过以下链接下载。

```
链接 / https://cloud.189.cn/t/2Iruua6B73Yj
提取码 / vc40
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

<details>
<summary>【进阶】在Windows下制作的其它方法</summary>

也适用于Mojave。

下载以下内容并放置到名为SharedSupport的新建文件夹中。

```
# High Sierra
# BaseSystem.dmg
https://swdist.apple.com/content/downloads/06/50/041-91758-A_M8T44LH2AW/b5r4og05fhbgatve4agwy4kgkzv07mdid9/BaseSystem.dmg

# BaseSystem.chunklist
https://swdist.apple.com/content/downloads/06/50/041-91758-A_M8T44LH2AW/b5r4og05fhbgatve4agwy4kgkzv07mdid9/BaseSystem.chunklist

# InstallInfo.plist
https://swdist.apple.com/content/downloads/06/50/041-91758-A_M8T44LH2AW/b5r4og05fhbgatve4agwy4kgkzv07mdid9/InstallInfo.plist

# InstallESDDmg.pkg
https://swdist.apple.com/content/downloads/06/50/041-91758-A_M8T44LH2AW/b5r4og05fhbgatve4agwy4kgkzv07mdid9/InstallESDDmg.pkg

# AppleDiagnostics.dmg
https://swdist.apple.com/content/downloads/06/50/041-91758-A_M8T44LH2AW/b5r4og05fhbgatve4agwy4kgkzv07mdid9/AppleDiagnostics.dmg

# AppleDiagnostics.chunklist
https://swdist.apple.com/content/downloads/06/50/041-91758-A_M8T44LH2AW/b5r4og05fhbgatve4agwy4kgkzv07mdid9/AppleDiagnostics.chunklist

# Mojave
# BaseSystem.dmg
https://swdist.apple.com/content/downloads/41/56/061-94403-A_5AM6QB8TGK/ijdhki76d4rw19t579eblaqc26ngzlhu1p/BaseSystem.dmg

# BaseSystem.chunklist
https://swdist.apple.com/content/downloads/41/56/061-94403-A_5AM6QB8TGK/ijdhki76d4rw19t579eblaqc26ngzlhu1p/BaseSystem.chunklist

# InstallInfo.plist
https://swdist.apple.com/content/downloads/41/56/061-94403-A_5AM6QB8TGK/ijdhki76d4rw19t579eblaqc26ngzlhu1p/InstallInfo.plist

# InstallESDDmg.pkg
https://swdist.apple.com/content/downloads/41/56/061-94403-A_5AM6QB8TGK/ijdhki76d4rw19t579eblaqc26ngzlhu1p/InstallESDDmg.pkg

# AppleDiagnostics.dmg
https://swdist.apple.com/content/downloads/41/56/061-94403-A_5AM6QB8TGK/ijdhki76d4rw19t579eblaqc26ngzlhu1p/AppleDiagnostics.dmg

# AppleDiagnostics.chunklist
https://swdist.apple.com/content/downloads/41/56/061-94403-A_5AM6QB8TGK/ijdhki76d4rw19t579eblaqc26ngzlhu1p/AppleDiagnostics.chunklist
```

下载完成后将InstallESDDmg.pkg重命名为InstallESD.dmg。用记事本打开InstallInfo.plist，删除InstallESD的chunklistURL和chunklistid键，同时将InstallESDDmg.pkg重命名为InstallESD.dmg。

打开BDU，选择用于制作安装盘的USB，点击Options，Source选择DL，将自动从网络下载最新版的Clover。Boot records选择Clover，分区格式选择FAT32-LBA，点击Refresh。

点击Tools-Extract HFS(HFS+) partition from DMG-files，选择BaseSystem.dmg，提取得到4.hfs。点击USB的第二个分区，选择Restore Partition，来源为刚才的4.hfs。

完成后通过Paragon Partition Manager Free将第二个分区的大小调整至足够大。然后打开TransMac，切换到刚才的HFS分区，进入Install macOS High Sierra.app/Contents，右侧点击Copy Here，来源选择刚才准备的SharedSupport文件夹。

若无法使用Paragon Partition Manager或TransMac，也可先尝试通过该USB引导。若成功进入安装程序，则可打开终端并通过以下命令复制必要的文件并开始安装。

```
# 复制文件
cd /
cp -R Install\ macOS\ High\ Sierra.app /Volumes/Macintosh\ HD/
cp -R /Volumes/DATA/SharedSupport /Volumes/Macintosh\ HD/Install\ macOS\ High\ Sierra.app/Contents/

# 启动安装
/Volumes/Macintosh\ HD/Install\ macOS\ High\ Sierra.app/Contents/Resources/startosinstall --volume /Volumes/Macintosh\ HD --converttoapfs NO --applicationpath /Volumes/Macintosh\ HD/Install\ macOS\ High\ Sierra.app
```

也可使用startosinstall.command脚本执行以上步骤，下载链接如下。解压后放置到安装盘根目录。

```
https://www.insanelymac.com/applications/core/interface/file/attachment.php?id=273769
```

在终端运行以下命令即可。

```
cd "/Volumes/Macintosh HD"
chmod +x startosinstall.command
./startosinstall.command
```
</details>

### 必要配置

#### 时间设置

从U盘启动后，安装向导会提示安装包破损，其原因是苹果对安装包的签名已经过期。保持断网，在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 0201010116
```

### 引导器修改

可使用原来的引导，将SMBIOS改为MacBook Pro14,2即可。注意csrconfig应为0x67。

### 驱动修补

无需任何修改。

## Sierra

### 下载

在黑果小兵的部落阁下载即可。此处使用10.12.6，这是Whatevergreen支持的Kaby Lake架构下的最旧版本。

也可通过以下链接下载。

```
链接 / https://cloud.189.cn/t/BBJ3EnMvQZJr
提取码 / 9rhh
```

也可下载Apple官方镜像，如下。

```
http://updates-http.cdn-apple.com/2019/cert/061-39476-20191023-48f365f4-0015-4c41-9f44-39d3d2aca067/InstallOS.dmg
```

Apple官方镜像可能需要手动提取安装包。挂载dmg后，打开终端并输入以下命令。

```
cd ~/Desktop
mkdir MacInstall && cd MacInstall
xar -xf /Volumes/Install\ macOS/InstallOS.pkg
cd InstallOS.pkg
tar xvzf Payload
mv InstallESD.dmg Install\ macOS\ Sierra.app/Contents/SharedSupport/
mv Install\ macOS\ Sierra.app /Applications
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 100123452015
```

### 引导器修改

与High Sierra一致。

### 驱动修补

与High Sierra一致。

## El Capitan

### 下载

10.11.6下载链接如下。

```
# 其它
https://sundryfiles.com/1LI3~i
https://sundryfiles.com/31KG~i
https://sundryfiles.com/1LI2~i

链接 / https://cloud.189.cn/t/ANVNv2mUfmMf
提取码 / mh5y
```

也可下载Apple官方镜像，如下。

```
http://updates-http.cdn-apple.com/2019/cert/061-41424-20191024-218af9ec-cf50-4516-9011-228c78eda3d2/InstallMacOSX.dmg
```

Apple官方镜像可能需要手动提取安装包。挂载dmg后，打开终端并输入以下命令。

```
cd ~/Desktop
mkdir MacInstall && cd MacInstall
xar -xf /Volumes/Install\ OS\ X/InstallMacOSX.pkg
cd InstallMacOSX.pkg
tar xvzf Payload
mv InstallESD.dmg Install\ OS\ X\ El\ Capitan.app/Contents/SharedSupport/
mv Install\ OS\ X\ El\ Capitan.app /Applications
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ OS\ X\ El\ Capitan.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ El\ Capitan.app
```

### 引导器修改

使用Clover 3911。

#### 设置FakeCPUID

每个系统都只能在特定架构的CPU下使用，系统会有对应的CPU白名单，在名单内的CPU才能被运行。对于Kaby Lake，El Capitan本身并不支持，因此启动时会出现卡一排+号，或卡AppleIntelCPU的问题。

通过设置FakeCPUID，可以在启动过程中骗过系统，从而顺利完成启动。注意系统启动完成后，通过Hackintool可以看到正确的CPU信息。对于El Capitan，可使用`0406E3`。

若一时未能找到合适的CPUID，可在Clover引导页面进入Options-Binary Patching，勾选Support CPU，然后返回主界面进行引导。由于Clover引导的CPUID未必合适，因此可能会产生问题。

可通过查看安装包中的InstallESD.dmg/BaseSystem.dmg/System/Library/Extensions中含有架构缩写（如SL、KBL等）的kext，以判断该系统适用于哪些架构的CPU。

#### 其它配置

勾选Kernel Pm、AppleRTC、XCPM、IntelCPUPM，csrconfig设置为0x67。

### 驱动修补

#### SATA支持

对于本机，El Capitan无法提供完整的SATA支持，从而导致启动时卡在DSMOS has arrived，且启动后无法识别SATA硬盘的问题。可通过在Clover中放置SATA-unsupported.kext修复。

#### 键盘

不能使用最新版的VoodooPS2Controller，会卡在鼠标键盘解锁的页面。可以使用20161208的RehabMan版VoodooPS2Controller。



### 常见问题

#### 登录时卡无敌风火轮

若已经出现该问题，则可重新进入一次设置向导以临时进入。Clover启动时添加引导参数-s以进入单用户模式，然后运行以下命令即可。

```
sbin/mount -uw
rm /var/db/.AppleSetupDone
```

也可在输入密码后，不要敲Enter键，而是单击输入框右侧的箭头按钮以临时进入系统。

设置自动登录即可从本质上避免此问题。也可打开终端，输入以下命令以解决。

```
su [用户名]
sudo find /private/var/folders | grep com.apple.LaunchServices | grep csstore
/private/var/folders/cd/someLongRandomNameHere/someFolderNumberHere/[上面出现的每一个.csstore文件]
```



## Yosemite

### 下载

10.10.5下载链接如下。

```
# 其它
https://sundryfiles.com/2BK5~i
https://sundryfiles.com/2BK3~i
https://sundryfiles.com/2BK2~i

链接 / https://cloud.189.cn/t/zYFZnifm2iyq
提取码 / v0q0
```

也可下载Apple官方镜像，如下。

```
http://updates-http.cdn-apple.com/2019/cert/061-41343-20191023-02465f92-3ab5-4c92-bfe2-b725447a070d/InstallMacOSX.dmg
```

Apple官方镜像可能需要手动提取安装包。挂载dmg后，打开终端并输入以下命令。

```
cd ~/Desktop
mkdir MacInstall && cd MacInstall
xar -xf /Volumes/Install\ OS\ X/InstallMacOSX.pkg
cd InstallMacOSX.pkg
tar xvzf Payload
mv InstallESD.dmg Install\ OS\ X\ Yosemite.app/Contents/SharedSupport/
mv Install\ OS\ X\ Yosemite.app /Applications
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ OS\ X\ Yosemite.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ Yosemite.app
```

<details>
<summary>【旧版】其它方法</summary>

在安装包上右键并点击`显示包内容`，双击Contents/SharedSupport/InstallESD.dmg以挂载。显示隐藏文件后挂载该镜像中的BaseSystem.dmg，挂载的磁盘将会显示为OS X Base System。

插入USB磁盘，打开磁盘工具，将OS X Base System磁盘恢复到USB磁盘。
</details>

<details>
<summary>【特殊】修改内核</summary>

对于Haswell，需要修改过的内核，链接如下。需复制到USB安装盘的/System/Library/Kernels。

```
https://www.dropbox.com/sh/dogcgje65kthyqy/AADhBj3_7Y5zxMlgrYe-mT25a
```

安装后需要替换系统盘中的内核。重新启动到安装程序，打开终端并输入以下命令。

```
# Hackintosh为系统盘名称
cp /System/Library/Kernels/kernel "/Volumes/Hacintosh/System/Library/Kernels/kernel"
```
</details>

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 100123452015
```












### 引导器修改

Clover使用4096。

#### 设置FakeCPUID

可使用0306D0，以仿冒BroadWell。

#### 其它配置

勾选Kernel Pm、AppleRTC、XCPM、IntelCPUPM，csrconfig设置为0x67。

### 驱动修补

#### USB

需要添加GenericUSBXHCI.kext以修补USB3驱动，且添加引导参数`-gux_nomsi`，否则在通过U盘启动时，由于无法找到启动盘，将卡在Still Waiting for root device。

注意，插入的设备在系统启动后无法热插拔。

### 常见问题

#### 安装时卡one second remaining

原因是缺少TSplicedFont字体。通过以下链接下载字体包，放入USB安装盘的System/Library/Fonts即可。

```
https://www.google.com/get/noto/
```

## Mavericks

### 下载

```
# 10.9.5
http://updates-http.cdn-apple.com/2019/cert/061-41343-20191023-02465f92-3ab5-4c92-bfe2-b725447a070d/InstallMacOSX.dmg

# 10.9.5
链接 / https://cloud.189.cn/t/VbAF3u3y6VB3
提取码 / to12


// 10.9
https://sundryfiles.com/2BKy~i
https://sundryfiles.com/3eM
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ OS\ X\ Mavericks.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ Mavericks.app --nointeraction
```

<details>
<summary>【旧版】其它方法</summary>

与Yosemite相同。
</details>

<details>
<summary>【特殊】修改内核</summary>

对于Haswell，需要修改过的内核，链接如下。需复制到USB安装盘的根目录。

```
https://www.dropbox.com/sh/dogcgje65kthyqy/AADhBj3_7Y5zxMlgrYe-mT25a
```

安装后需要替换系统盘中的内核。重新启动到安装程序，打开终端并输入以下命令。

```
# Hackintosh为系统盘名称
cp /mach_kernel "/Volumes/Hacintosh/mach_kernel"
```
</details>

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 100123452014
```

### 引导器修改

#### Clover

Clover使用4096。

##### 设置FakeCPUID

可使用0306C0，以仿冒HasWell。

##### 其它配置

同Yosemite。

#### OpenCore

Mavericks的磁盘映像使用的是Apple分区方案（Apple Partitioning Scheme），需要OpenPartitionDxe驱动程序来进行DMG恢复和安装。可以将DmgLoading设置为Disabled，以在不加载DMG的情况下运行恢复功能，同时也避免了OpenPartitionDxe的需求。

缓存的内核映像通常不包括网络（IONetworkingFamily）或音频（IOAudioFamily）的家族驱动，这些家族驱动往往需要使用Force加载来注入。

#### Chameleon

Extra文件夹示例如下。

```
https://www.dropbox.com/s/8xw3bzol3xivqjh/Extra.zip
```

### 驱动修补

同Yosemite。

## Mountain Lion

### 下载

```
// 速度较慢
https://thepiratebay.org/description.php?id=8922294
https://thepiratebay.org/description.php?id=8604586

// iATKOS
https://thepiratebay.org/description.php?id=7973176

// 10.8.5
https://sundryfiles.com/2BKv~i
https://sundryfiles.com/31KE
https://sundryfiles.com/2BJ7
```

### 安装盘制作

在系统app安装包上右键，点击显示包内容，进入Contents/Shared Support，双击InstallESD.dmg以挂载。打开磁盘工具，选择要设置为安装盘的USB，点击恢复，来源为刚才挂载的镜像Mac OS X Install ESD，等待完成即可。若报错，则可能需要禁用SIP。

如果为dmg镜像，也可直接双击挂载该镜像，并用该镜像恢复。

若无USB，可在硬盘上划分一块区域作为安装盘，在恢复时选择该分区即可。该方法可以摆脱USB的限制，如因USB 3.0未驱动而出现的Still Waiting for Root Device问题。


<details>
<summary>【特殊】修改内核</summary>

对于AMD CPU，需要修改过的内核，链接如下。

```
https://www.insanelymac.com/forum/topic/281450-mavericks-kernel-testing-on-amd-formerly-mountain-lion-kernel-testing-on-amd
```
</details>

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 020123452013
```










### 引导器修改

CLover和OpenCore同Mavericks。启动参数可能需要slide=0。

### 驱动修补

#### 显卡

若使用HD 2500，可在变色龙的org.Chameleon.boot.plist添加以下内容。

```
<key>device-properties</key>
<string>7f0000000100000001000000730000000200000002010c00d041030a000000000101060000027fff04002c0000004100410050004c002c00690067002d0070006c006100740066006f0072006d002d00690064000000080000000b006601140000006800640061002d0067006600780000000d0000006f6e626f6172642d31</string>
```

若使用ATI 5000/6000控制器，需要使用ATIConnectors patch。

## Lion

### 下载

尽量使用10.7.5。该版本前的SLE中的IOUSBFamily没有AppleUSBXHCI，因此GenericUSBXHCI无法工作，USB3不受支持。

```
# 10.7.5
https://sundryfiles.com/IO
https://sundryfiles.com/31KT~i
https://sundryfiles.com/2BK0~i
https://sundryfiles.com/2BK1~i
https://www.malavida.com/en/soft/lion/mac/download
https://allmacworld.com/mac-os-x-lion-10-7-5-dmg-free-download/
https://justapplestuff.com/mac-os-x-lion-download/
https://pan.baidu.com/s/1dDEdXa5
https://igetintopc.com/mac-os-x-lion-10-7-5-dmg-free-download/

# 10.7
https://sundryfiles.com/1LI1
https://sundryfiles.com/31KH
https://sundryfiles.com/1LI0~i

# 其它
https://thepiratebay.org/description.php?id=6554150
https://thepiratebay.org/description.php?id=6688033
https://thepiratebay.org/description.php?id=7056418

# 速度较慢
https://thepiratebay.org/description.php?id=6200584
https://thepiratebay.org/description.php?id=6555402
```

### 安装盘制作

同Mountain Lion。

### 引导器修改

#### Clover

Clover使用4096。

##### 设置FakeCPUID

可使用0206F0，以仿冒WestmereFx。

##### 其它配置

勾选Kernel Pm、AppleRTC、XCPM、IntelCPUPM，csrconfig设置为0x67。

#### OpenCore

同Mavericks。

### 驱动修补

包括Lilu（使用32位内核时）及其插件在内的许多Kext在Lion或更低版本上都不支持，它们所需的内核API比较新，不在SDK之中。

Lion及更早系统不支持KASLR slide，因此会导致内存较低的固件分配内存失败。

#### 显卡

若使用ATI 5000/6000控制器，需要使用ATIConnectors patch。

### 系统使用

#### 显示隐藏文件

打开终端并输入以下命令即可。

```
defaults write com.apple.finder AppleShowAllFiles TRUE
killall Finder
```

### 常见问题

#### 啰嗦模式

##### 卡在MBR Start!

在BIOS关闭串行端口。

#### 系统运行

##### 出现「您的电脑尚未连接任何键盘，现在，请连接您的键盘」错误

删除/System/Library/CoreServices/Setup Assistant.app/Contents/Resources/DeviceSection.bundle即可。

## Snow Leopard

### 下载

```
# 10.6.7 Acidanthera版（删除SMBIOS锁）
https://archive.org/details/10.6.7-10j3250-disk-images
https://mega.nz/folder/z5YUhYTb#gA_IRY5KMuYpnNCg7kR3ug/file/ioQkTagI

# 10.6.7
https://drive.google.com/drive/folders/0B661P9Kp9bPAdUViMVFYRW9KWFE

# 10.6.3
https://sundryfiles.com/1LI6~i
https://sundryfiles.com/3eO
http://shortconnect.com//81

# 其它
https://macintoshgarden.org/apps/apple-osx-snow-leopard
https://lu9-my.sharepoint.com/personal/barneys_5tb_in/_layouts/15/onedrive.aspx?originalPath=aHR0cHM6Ly9sdTktbXkuc2hhcmVwb2ludC5jb20vOnU6L2cvcGVyc29uYWwvYmFybmV5c181dGJfaW4vRVdTcFpSUXRvZ2hPbkVlYkQtQzBGdWdCVkhvbjRSVkxsYTgzcDRqYnc2eU11UT9ydGltZT1nNVd0RFh5aDJFZw&id=%2Fpersonal%2Fbarneys%5F5tb%5Fin%2FDocuments%2FMac%20OS%20Snow%20Leopard
https://thepiratebay.org/description.php?id=5068890
https://thepiratebay.org/description.php?id=6106470
https://thepiratebay.org/description.php?id=6407331
```

### 安装盘制作

同Mountain Lion。也可在终端输入以下命令以制作。

```
# /Volumes/Mac\ OS\ X\ Install\ DVD为挂载的磁盘
# /Volumes/MyVolume为需要制作的USB设备路径
sudo asr restore -source /Volumes/Mac\ OS\ X\ Install\ DVD  -target /Volumes/MyVolume -erase -noverify
```

<details>
<summary>【进阶】在Lion上安装Snow Leopard</summary>

仅适用于BIOS引导。

挂载安装包后，切换到`/Volumes/Mac OS X Install DVD/System/Installation/Packages`，打开OSInstall.mpkg，安装目标选择要安装Snow Leopard的GUID磁盘。

若需要为MBR引导，可先用Flat Package Editor打开OSInstall.mpkg，打开Distribution并删除以下字段，然后保存。

```
eraseOptionAvailable='true'
hostArchitectures='i386'
allow-external-scripts='yes'
```

工具下载地址如下。

```
http://www.mediafire.com/file/mzomjodmkmm/SL_Files.zip/file
```

安装完成后需要安装Chameleon引导。下载以下文件后打开Apps-PC EFI 10.1，安装目标选择安装Snow Leopard的磁盘。

```
http://www.lookass.ch/?id=4&area=art&art=248
```

完成后打开安装磁盘，删除boot文件夹，并将下载文件中的boot和Extra复制到磁盘根目录。若无P55M-UD2主板，则需要删除Extra/Extensions目录下的LegacyHDA_ALC888B.kext。若无GA-P55M-UD2主板，则需要删除Extra目录下的Extensions.mkext。若为GA-P55M-UD2主板，则需要放置DSDT.aml。

完成后重启即可。
</details>

### 引导器修改

#### Clover

##### 设置FakeCPUID

可使用0206A0，以仿冒SandyBridge。

##### 启动参数

由于系统默认启动32位内核，因此需要启动参数`arch=x86_64`以强制使用64位内核。

##### 设置SMBIOS

SMBIOS应设置为MacBookPro8,1/MacBookPro8,2/MacBookPro8,3。

##### 其它

对于OpenCore，需要在Snow Leopard及更早版本上启用RebuildAppleMemoryMap。

#### OpenCore

同Lion。

可通过LegacyCommpage这一Quirk解除64位用户空间内核的SSSE3要求。

### 驱动修补

需要FakeSMC.kext、AppleACPIPS2Nub.kext、ApplePS2Controller.kext、VoodooHDA.kext、LegacyT60p.kext。

对于声卡，可能需要AppleAzaliaAudio.kext或AppleHDA.kext。

#### 显卡

对于使用ATI Radeon X1650的用户，该显卡的DeviceID不太平常，为0x71cd。需要使用ATIRadeonX1000.kext，且添加以下patch。

```
<dict>
<key>Name</key>
<string>ATIRadeonX1000</string>
<key>Find</key>
<string>81fa87710000</string>
<key>Replace</key>
<string>81facd710000</string>
</dict>
```

#### USB

由于SLE中的IOUSBFamily没有AppleUSBXHCI，只有AppleUSBEHCI，因此仅支持USB2，不支持USB3。

### 虚拟机安装

#### VirtualBox

创建新虚拟机，系统类型为BSD-FreeBSD，在System-Motherboard勾选Enable IO APIC，System-Acceleration勾选Enable VT-x/AMD-V，Storage-IDE Controller选择ICH6，CPU选择2核或4核，并挂载下载好的安装ISO镜像。

创建完成后切换到虚拟机所在目录并编辑XML文件，添加以下内容到`<ExtraData>`部分。

```
<ExtraDataItem name="VBoxInternal/Devices/e1000f/0/Trusted" value="integer:1"/>
<ExtraDataItem name="VBoxInternal/PDM/Devices/PcExt/Path" value="VBoxDD3"/>
```

### 常见问题

#### 啰嗦模式

##### 卡在panic: "Unable to find driver for this platform: \"ACPI\"

具体消息如下。

```
panic(cpu caller 0xffffff801ead78f4): "Unable to find driver for this platform: \"ACPI\".\n"@/Library/Caches/com.apple.xbs/Sources/xnu/xnu-3789.51.2/iokit/Kernel/IOPlatformExpert.cpp:1672
```

com.apple.driver.AppleACPIPlatform引发的内核崩溃代表了DSDT.aml的错误。事实上，Snow Leopard及以前的系统只支持iASL 4.0或5.0编译的DSDT与SSDT，iASL 6.0及更新的版本并不支持。可通过在MaciASL中点击偏好设置，选择编译器为iASL 4.0即可。修改编译器后出现错误的解决方法可看ACPI一章。

##### 卡在panic: AppleIntelCPUManagement

可以尝试使用Nullpowermanagement。若无效，则删除SLE下的AppleIntelCPUManagement。

##### 卡在PCI configuation begin

在启动时可查看打印出的线程数。若与现实不符，如四核八线程的CPU打印出了16个线程，则可能是系统启动时找到了另一个虚构的CPU。此时添加启动参数`cpus=1`即可。

##### 卡在panic: kernel trap

尝试使用OpenCore引导，注意需要设置EnableWriteUnprotector为True，RebuildAppleMemoryMap为false。

##### 卡在BSD Process name corresponding to current thread: kernel_task/BSD Process name corresponding to current thread: unknown

放入ACPI补丁，可使用IOATAFamily.kext。IOATAFamily.kext包括了以下kexts。

|              名称             |        说明       |
|-------------------------------|-------------------|
| AppleIntelPIIXATA             | Intel免AHCI补丁   |
| AppleATIATA                   | AMD免AHCI补丁     |
| AppleATIPATA                  | AMD免AHCI补丁     |
| AppleNForceATA                | NForce免AHCI补丁  |
| AppleVIAATA                   | VIA免AHCI补丁     |
| AppleVIAATA.kext.for.sis.SATA | SIS免AHCI补丁     |
| JMicronATA                    | JMicron免AHCI补丁 |

#### 系统运行

##### 鼠标不起作用

可尝试VBVMMDevice.kext。

```
http://www.mediafire.com/file/c1mzumynm3w/VBVMMDevice.kext.zip/file
```

## Leopard

不支持x86_64内核，需要i386内核扩展和补丁。

prelinkedkernel Kext无法被OpenCore注入。Mkext Kext的注入仍然正常，也不会有明显的性能消耗。

### 下载

```
# 10.5.7 Acidanthera版（删除了SMBIOS锁）
https://archive.org/details/10.5.7-9-j-3050
https://mega.nz/folder/inRBTarD#zanf7fUbviwz3WHBU5xpCg

# 10.5.6
https://sundryfiles.com/sD
https://www.shortconnect.com/84
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Mac_OS_X_Leopard_10.5.6.iso
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Mac_OS_X_Leopard_10.5.6.iso
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Mac_OS_X_Leopard_10.5.6.iso
http://old.macintosh.garden/apps/Mac_OS_X_Leopard_10.5.6.iso

# 10.5.6 iPC版
https://thepiratebay.org/description.php?id=4608978
magnet:?xt=urn:btih:E09F09BE2CF14BC8889DEB22139CA9615D735900
http://ipcosx86.wikidot.com/

# 10.5.4
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Leopard_10_5_4.dmg__0.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Leopard_10_5_4.dmg__0.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Leopard_10_5_4.dmg__0.zip
http://old.macintosh.garden/apps/Leopard_10_5_4.dmg__0.zip
https://mega.co.nz/#!DQQynArA!fYuxBw3m3sN082Xpuj6U7y9He-B9YWwQjPy6sZm2k-Y

# 10.5.2 Kalyway版
https://archive.org/details/Kalyway10.5.2DVDIntelAmd
https://macintoshgarden.org/apps/kalyway-1052-intel-and-amd
https://www.insanelymac.com/forum/topic/77069-kalyway-1051-dvd-release-the-official/

# 10.5
https://sundryfiles.com/J2
https://thepiratebay.org/description.php?id=4179024
```

### 驱动修补

即使是在64位CPU上，系统内核空间仍然是32位。若使用OpenCore引导，可将FakeSMC-32与VirtualSMC结合使用，且将FakeSMC-32的Archentry设置为i386，VirtualSMC的entry设置为x86_64。

#### USB

由于SLE中的IOUSBFamily没有AppleUSBXHCI，只有AppleUSBEHCI，因此仅支持USB2，不支持USB3。

### 专用Kexts

#### AppleACPIPS2NUB

有可能解决Panic (cpu 0 caller 0x.....) Unable to find driver for this platform :\ACPI\".\n"@/SourceCache/xnu/xnu-1456.1.25/iokit /Kernel/IOPlatformExpert.cpp:1389的问题。

```
https://www.insanelymac.com/forum/topic/114578-appleacpips2nub-for-leopard-only/
```

### 虚拟机安装

#### VMware

以Jas 10.5.2发行版为例。

在Vmware新建虚拟机，其中硬盘类型为IDE，硬盘大小为6G或以上，系统类型为其他-FreeBSD/FreeBSD64，内存为512MB或以上。

新建完成后编辑虚拟机设置，在处理器选项卡中勾选`虚拟化Intel VT-x/EPT或AMD-V/RVI`，在硬盘-高级勾选`独立`并选择`永久`，在网络适配器选择`仅主机模式`以防止在安装过程中无法注册。

启动虚拟机后按F8，选择ISO安装盘并填写启动参数`-v -x cpus=1`，开始安装。安装前组件选择如下，错误选择将会造成CPU has been disabled，或中途无故卡死。

|            组件            | 是否选择 |
|----------------------------|----------|
| Jas 10.5.2 Intel.sse2 sse3 | 选       |
| Leopard Graphics Update    | 选       |
| Patched Driver             | 全选     |
| PlugIns                    | 全选     |
| Device Identification      | 全选     |
| Kernel                     | 选       |
| Darwin x/86 Bootloader     | -        |
| PC EFI GIUD                | -        |
| PC EFI MBR                 | 选       |
| Post Install Optimization  | 选       |

安装完成后仍需要从ISO启动，按F8并选择安装好的硬盘以进入系统。

#### VirtualBox

创建新虚拟机，系统类型为BSD-FreeBSD，在System-Motherboard勾选Enable IO APIC，System-Acceleration勾选Enable VT-x/AMD-V，Storage-IDE Controller选择ICH6，CPU选择2核或4核，并挂载下载好的安装ISO镜像。

创建完成后切换到虚拟机所在目录并编辑XML文件，添加以下内容到`<ExtraData>`部分。

```
<ExtraDataItem name="VBoxInternal2/SupportExtHwProfile" value="on"/>
```

### 常见问题

#### 啰嗦模式

##### 显示OsxAptioFixDrv: requested memory exceeds our allocated relocation block

换用OsxAptioFixDrv2即可。

##### 卡在panic: Unsupported CPU

在Clover的配置文件中勾选IntelCPUPMKernel即可。

##### 重启出现b0 error

将启动硬盘设置为激活分区。通过DOS版的DiskGenius即可。

## Tiger

不支持x86_64内核，需要i386内核扩展和补丁。

prelinkedkernel Kext无法被OpenCore注入。Mkext Kext的注入仍然正常，也不会有明显的性能消耗。

这个版本需要两张光盘或两个USB安装介质来访问第二张DVD盘安装介质上的所有可选包。

### 下载

```
# 10.4.8 Acidanthera版（删除了SMBIOS锁）
https://archive.org/details/10.4.10-8-r-4088-acdt
https://mega.nz/folder/D3ASzLzA#7sjYXE2X09f6aGjol_C7dg

# 原版
https://sundryfiles.com/2BKz~i
https://sundryfiles.com/4px
http://macbold.com/wp-content/uploads/2018/10/Mac-OS-X-Tiger-Retail-DVD-ISO.torrent.zip
https://macbold.com/mac-os-x-10-4-tiger-retail-dvd-dmg-iso-torrent-download/

# 10.4.8 Jas发行版
https://thepiratebay.org/description.php?id=3924157
https://archive.org/details/mac-os-x-tiger-10-4-8-hackintosh-jas
https://archive.org/details/mac-os-x-10.4.8-ja-s-amd-intel-sse-2-sse-3-with-ppf-1-ppf-2
https://github.com/akineechan/MacOSX-T42

# Tiger_CD1.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Tiger_CD1.toast_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Tiger_CD1.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Tiger_CD1.toast_.zip
http://old.macintosh.garden/apps/Tiger_CD1.toast_.zip

# Tiger_CD2.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Tiger_CD2.toast_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Tiger_CD2.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Tiger_CD2.toast_.zip
http://old.macintosh.garden/apps/Tiger_CD2.toast_.zip

# Tiger_CD3.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Tiger_CD3.toast_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Tiger_CD3.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Tiger_CD3.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Tiger_CD3.toast_.zip

# Tiger_CD4.toast_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Tiger_CD4.toast_.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Tiger_CD4.toast_.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Tiger_CD4.toast_.zip
http://old.macintosh.garden/apps/Tiger_CD4.toast_.zip





# Tiger_4_6.dmg_.zip
http://macintoshgarden.org/sites/macintoshgarden.org/files/apps/Tiger_4_6.dmg__0.zip
ftp://macgarden:publicdl@repo1.macintoshgarden.org/Garden/apps/Tiger_4_6.dmg__0.zip
http://mirror.macintosharchive.org/macintoshgarden.org/files/apps/Tiger_4_6.dmg__0.zip
http://old.macintosh.garden/apps/Tiger_4_6.dmg__0.zip
https://mega.co.nz/#!7BwTwKoZ!B2F-kddHr-HB0kzuwgDt7ui8oIaboMokb0wJdoT1cLs
```

### 驱动修补

即使是在64位CPU上，系统内核空间仍然是32位。若使用OpenCore引导，可将FakeSMC-32与VirtualSMC结合使用，且将FakeSMC-32的Archentry设置为i386，VirtualSMC的entry设置为x86_64。

### 虚拟机安装

以Jas 10.4.8发行版为例。

在Vmware新建虚拟机，配置与Leopard基本一致。完成后定位到虚拟机文件位置，打开配置文件并添加以下内容，保存后启动虚拟机。注意不要在Vmware界面中修改虚拟机配置，否则以下更改会丢失。

```
paevm="true"
ethernet0.virtualDev="e1000"

# 仅用于加速，非必须
guestOS="darwin"

# 正常情况无需修改以下行
scsi0.present="FALSE"
```

### 常见问题

#### 系统运行

##### Reset问题

用16进制编辑软件编辑mach_kernel文件，将EBFE9090替换为B0FEE664即可。

##### SATA硬盘无法装载，提示AppleVIAATA.kext装载失败

打开终端并输入以下命令即可。

```
sudo -s
cd /System/Library/Extensions
chown -R root:wheel AppleVIAATA.kext
chmod -R 755 AppleVIAATA.kext
kextload -v AppleVIAATA.kext
kextcache -k /System/Library/Extensions
```

# 旧硬件安装

硬件配置如下。

|          |                                 型号                                 | Device ID | Vendor ID |
|----------|----------------------------------------------------------------------|-----------|-----------|
| CPU      | Intel Core 2 Duo T5750 2000MHz（x86/x86-64/MMX/SSE/SSE2/SSE3/SSSE3） | /         | /         |
| 显卡     |                                                                      |           |           |
| 声卡     |                                                                      |           |           |
| 有线网卡 |                                                                      | /         | /         |
| 无线网卡 |                                                                      |           |           |
| 键盘     |                                                                      | /         | /         |
| 触摸板   |                                                                      | /         | /         |
| 蓝牙     |                                                                      |           |           |

## 系统选择

如果主板或CPU较旧，则只能安装旧版系统。可先查看CPU支持的指令集，如果CPU不支持SSE4.1指令集，则不能运行10.12及以上的系统。

10.11支持SSE3指令集。各系统情况具体可参看黑苹果发展一章。

## 引导方式

### UEFI

#### 安装引导器

如果主板为BIOS Legacy模式，可以通过模拟UEFI实现运行UEFI的效果，具体做法可参照有关引导的文章。向EFI分区安装好Clover后即可开始。

#### 准备安装介质

##### U盘安装

在Mac系统下下载好后缀为app的安装包拖到`应用程序`文件夹。用磁盘工具格式化U盘，选择GUID分区图，格式化为Mac日志式。然后打开终端并输入以下命令，以Sierra安装包为例，其中/Volumes/Sierra为U盘的盘符。

```
sudo /Applications/Install\ macOS\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/Sierra --applicationpath /Applications/Install\ macOS\ Sierra.app --nointeraction
```

制作完成后，插入到需要安装的电脑即可引导启动。

##### 硬盘安装

用Diskgenius划分一块10G左右的磁盘作为安装盘，注意分配盘符但不要分区。通过硬盘安装助手，可以把镜像写到硬盘中。

如果镜像为cdr格式，则需要以管理员模式打开硬盘安装助手，选择安装镜像和安装磁盘，只勾选`写入`，点击开始即可。如果不以管理员身份运行，则会出现`not a HFS partition`的错误提示。

完成写入后需要手动设置安装盘的参数。打开Diskgenius，在安装盘分区上右键选择修改参数，修改系统类型为`48465300-0000-11AA-AA11-00306543ECAC`即可。

如果是以app为后缀的安装包，则需要从app包制作cdr镜像。打开终端并输入以下命令即可。

```
# 创建dmg
# -size 8300m是指镜像大小8300MB，这里的8300改为app包大小的基础上增加500MB左右
hdiutil create -o /tmp/Install\ macOS\ Catalina -size 8500m -layout SPUD -fs HFS+J

# 挂载dmg
hdiutil attach /tmp/Install\ macOS\ Catalina.dmg -noverify -mountpoint /Volumes/Install\ macOS\ Catalina

# 将app写入dmg
echo Y | sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/Install\ macOS\ Catalina

# 卸载挂载的dmg
hdiutil detach /Volumes/Install\ macOS\ Catalina

# 将dmg转换为cdr
hdiutil convert /tmp/Install\ macOS\ Catalina.dmg -format UDTO -o ~/Desktop/Install\ macOS\ Catalina

# 删除dmg
rm /tmp/Install\ macOS\ Catalina.dmg
```

### BIOS

如果不希望使用模拟UEFI，也可以通过MBR+BIOS的模式。注意，由于​Mac不支持MBR启动，因此需要通过MBR补丁的方式实现，且应当使用Ecoch即变色龙进行引导，通过Clover引导时可能会出现`X64 Exception`的错误。

#### 安装引导器

##### U盘安装

在Mac系统下下载Ecoch的pkg安装包，安装时安装路径选择U盘即可。U盘可为MBR分区表。

##### 硬盘安装

下载Chameleon Install安装器并打开，按照提示完成安装。安装好的镜像文件wowpc.iso位于系统分区根目录，下载最新的wowpc.iso并替换即可。

#### 准备安装介质

下载Catalina MBR HFS Firmware Check Patch。

```
https://www.insanelymac.com/forum/files/file/985-catalina-mbr-hfs-firmware-check-patch/
https://github.com/crazybirdy/MBR-Manual-Method
```

打开dmg文件，进入`Old-macOS-10+11+12`，运行想安装的系统的脚本。注意需要使用一个U盘作为写入盘，并按照提示格式化。

安装盘完成后，需要将Enoch-r2922里的文件拷贝到引导器。对于U盘安装的变色龙而言，直接替换文件即可。而对于硬盘安装，需要编辑iso文件。

## 常见问题

### 引导启动

#### 启动界面中键盘无法使用

有可能由不兼容的键盘驱动程序引起。对于OpenCore，可以在配置文件中取消勾选PollAppleHotKeys并勾选KeySupport，然后在Drivers文件夹中删除OpenUsbKbDxe。

若无效，则进行相反的操作，即取消勾选KeySupport，然后在Drivers文件夹中添加OpenUsbKbDxe。

也有可能由缺失PS2键盘驱动引起。在Drivers文件夹中添加Ps2KeyboardDxe即可。

也可尝试在Drivers文件夹中添加AptioInputFix。若仍无效，可通过设置倒计时的方式暂时在启动时能够引导到系统。

### 啰嗦模式

#### 用Clover引导选择完启动项后即黑屏

更换旧版Clover，如r3333。注意，旧版Clover需要在启动项上空格，并选择`Boot with injected kexts`才能载入kexts。

#### 卡AppleEHCI/AppleUHCI

Clover配置文件中勾选FixHPET和FixIPIC。若无效则改用硬盘模式安装。

#### 显示panic(CPU 1 caller 0xffffff800e7ce6fa):Kernel trap at 0xffffff7f9294d4c6

Clover配置文件中勾选FixHPET和FixIPIC。

#### 卡Missing bluetooth controller transport!后禁行

Clover配置文件中勾选FixHPEC、FixIPIC、FixFirewire、FixUSB、DropOEM，并关闭所有USB注入。也可尝试在启动参数添加`dart=0`。

#### 出现满屏FireWire错误

可能为在BIOS中关闭了CSM导致，关闭CSM会确保是纯UEFI启动。

可在Clover的配置文件中勾选Fix Firewire解决。也可尝试使用FireWireDriver.efi，放置于Clover的driver64UEFI文件夹即可。

```
https://www.insanelymac.com/applications/core/interface/file/attachment.php?id=124931
```

注意，该错误理论上不造成系统启动时卡住，若卡住，应该为其它原因导致。




#### 








# 参考教程

## A full history of macOS (OS X) release dates and rates

```
https://robservatory.com/a-full-history-of-macos-os-x-release-dates-and-rates/
```

## Show Hidden Files OS X 10.7 Lion

```
https://apple.stackexchange.com/questions/18662/show-hidden-files-os-x-10-7-lion
```

## Is Intel's 8th gen Compatible with OS X 10.9, 10.10, 10.11, 10.12?

```
https://www.tonymacx86.com/threads/is-intels-8th-gen-compatible-with-os-x-10-9-10-10-10-11-10-12.253152/
```

## How to create a bootable OS X Snow Leopard USB drive?

```
https://apple.stackexchange.com/questions/400472/how-to-create-a-bootable-os-x-snow-leopard-usb-drive
```

## Download MacOS X 10.4 - 10.15 original - All versions

```
https://applehint.com/t/download-macos-x-10-4-10-15-original-all-versions/376
```

## Common boot options for Chimera, Chameleon, Unibeast, Niresh, and more

```
http://www.macbreaker.com/2012/01/list-of-common-hackintosh-boot-flags_29.html
```

## 关于黑苹果升级macOS11（bigsur）的建议与观点

```
https://zhuanlan.zhihu.com/p/158770898
```
