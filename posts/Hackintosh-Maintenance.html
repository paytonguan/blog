<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#000">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#000">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"paytonguan.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","sidebar":"fadeIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="黑苹果的系统维护。">
<meta property="og:type" content="article">
<meta property="og:title" content="黑苹果的系统维护">
<meta property="og:url" content="https://paytonguan.github.io/blog/posts/Hackintosh-Maintenance.html">
<meta property="og:site_name" content="Payton&#39;s blog">
<meta property="og:description" content="黑苹果的系统维护。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://paytonguan.github.io/blog/posts/Hackintosh-Maintenance/topic.jpg">
<meta property="article:published_time" content="2019-11-30T17:55:29.000Z">
<meta property="article:modified_time" content="2025-04-03T18:55:58.593Z">
<meta property="article:author" content="Payton">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://paytonguan.github.io/blog/posts/Hackintosh-Maintenance/topic.jpg">

<link rel="canonical" href="https://paytonguan.github.io/blog/posts/Hackintosh-Maintenance.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>黑苹果的系统维护 | Payton's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Payton's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Somewhere leisure.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://paytonguan.github.io/blog/posts/Hackintosh-Maintenance.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Payton">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Payton's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          黑苹果的系统维护
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-01 01:55:29" itemprop="dateCreated datePublished" datetime="2019-12-01T01:55:29+08:00">2019-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-04 02:55:58" itemprop="dateModified" datetime="2025-04-04T02:55:58+08:00">2025-04-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Mac/" itemprop="url" rel="index"><span itemprop="name">Mac</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>69k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:03</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="/blog/posts/Hackintosh-Maintenance/topic.jpg"></p>
<p>黑苹果的系统维护。</p>
<span id="more"></span>

<h1 id="ACPI优化"><a href="#ACPI优化" class="headerlink" title="ACPI优化"></a>ACPI优化</h1><p>用于优化黑苹果对设备的识别。</p>
<h2 id="DSDT"><a href="#DSDT" class="headerlink" title="DSDT"></a>DSDT</h2><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><h4 id="DTGP方法"><a href="#DTGP方法" class="headerlink" title="DTGP方法"></a>DTGP方法</h4><p>许多修复需要调用到该方法，放置于DSDT的前部即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Method (DTGP, 5, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If (LEqual (Arg0, Buffer (0x10)</span><br><span class="line">            &#123;</span><br><span class="line">                /* 0000 */    0xC6, 0xB7, 0xB5, 0xA0, 0x18, 0x13, 0x1C, 0x44,</span><br><span class="line">                /* 0008 */    0xB0, 0xC9, 0xFE, 0x69, 0x5E, 0xAF, 0x94, 0x9B</span><br><span class="line">            &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">        If (LEqual (Arg1, One))</span><br><span class="line">        &#123;</span><br><span class="line">            If (LEqual (Arg2, Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (Buffer (One)</span><br><span class="line">                &#123;</span><br><span class="line">                    0x03</span><br><span class="line">                &#125;, Arg4)</span><br><span class="line">                Return (One)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (Arg2, One))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (One)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Store (Buffer (One)</span><br><span class="line">    &#123;</span><br><span class="line">        0x00</span><br><span class="line">    &#125;, Arg4)</span><br><span class="line">    Return (Zero)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RTC修复"><a href="#RTC修复" class="headerlink" title="RTC修复"></a>RTC修复</h4><p>适用于开机时发生错误，然后重新启动的情况。该情况下BIOS会恢复为默认设置。</p>
<p>修改前如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Device (RTC)&#123;</span><br><span class="line">    Name (_HID, Eisald (&quot;PNP0B00&quot;))</span><br><span class="line">    Name (ATT0, ResourceTemplate()</span><br><span class="line">    &#123;</span><br><span class="line">        IO (Decode16,</span><br><span class="line">            0x0070,</span><br><span class="line">            0x0070,</span><br><span class="line">            0x00,</span><br><span class="line">            0x04</span><br><span class="line">            )</span><br><span class="line">    &#125;)</span><br><span class="line">    Name (ATT1, ResourceTemplate()&#123;</span><br><span class="line">        IO (Decode16,</span><br><span class="line">            0x0070,</span><br><span class="line">            0x0070,</span><br><span class="line">            0x00,</span><br><span class="line">            0x04</span><br><span class="line">            )</span><br><span class="line">        IRQNoFlags ()</span><br><span class="line">            &#123;8&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    Method (_CRS, 0, NotSerialized)</span><br><span class="line">    &#123;</span><br><span class="line">        If （LGreaterEqual (OSFX, 0x03))</span><br><span class="line">        &#123;</span><br><span class="line">            If (HPTF)&#123;</span><br><span class="line">                Return (ATT1)</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Return (ATT0)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Else</span><br><span class="line">        &#123;</span><br><span class="line">            Return (ATT0)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Device (RTC)&#123;</span><br><span class="line">    Name (_HID, Eisald (&quot;PNP0B00&quot;))</span><br><span class="line">    Name (_CRS, ResourceTemplate()      // ATT0修改为_CRS</span><br><span class="line">    &#123;</span><br><span class="line">        IO (Decode16,</span><br><span class="line">            0x0070,</span><br><span class="line">            0x0070,</span><br><span class="line">            0x00,</span><br><span class="line">            0x02       // 0x04修改为0x02以防止BIOS重置</span><br><span class="line">            )</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 后面的内容非必要，直接删除</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="HPET修复"><a href="#HPET修复" class="headerlink" title="HPET修复"></a>HPET修复</h4><p>将HPET设备修改如下即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Device (HPET)</span><br><span class="line">&#123;</span><br><span class="line">Name (_HID, EisaId (&quot;PNP0103&quot;))</span><br><span class="line">Name (_CID, EisaId (&quot;PNP0C01&quot;)) </span><br><span class="line">Name (_STA, 0x0F)</span><br><span class="line">Name (_CRS, ResourceTemplate ()</span><br><span class="line">&#123;</span><br><span class="line">    IRQNoFlags ()</span><br><span class="line">        &#123;0&#125;</span><br><span class="line">    IRQNoFlags ()</span><br><span class="line">        &#123;8&#125;</span><br><span class="line">    Memory32Fixed (ReadOnly,</span><br><span class="line">        0xFED00000,      // Address Base</span><br><span class="line">        0x00000400,      // Address Length</span><br><span class="line">        )</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PIC-x2F-TIMR设备修复"><a href="#PIC-x2F-TIMR设备修复" class="headerlink" title="PIC&#x2F;TIMR设备修复"></a>PIC&#x2F;TIMR设备修复</h4><p>删除它们中的每一条<code>IRQNoFlags () &#123;2&#125;</code>和<code>IRQNoFlags () &#123;0&#125;</code>语句即可。</p>
<h4 id="IOATAFamily-kext内核恐慌修复"><a href="#IOATAFamily-kext内核恐慌修复" class="headerlink" title="IOATAFamily.kext内核恐慌修复"></a>IOATAFamily.kext内核恐慌修复</h4><p>在SATA和IDE0设备的GPCT方法前添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Field (IDCS, DWordAcc, NoLock, Preserve)</span><br><span class="line">&#123;</span><br><span class="line">        Offset (0x40), </span><br><span class="line">PRIT,   16, </span><br><span class="line">SECT,   16</span><br><span class="line">&#125;</span><br><span class="line">Method (_INI, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">Store (0xE307, PRIT)</span><br><span class="line">Store (0xC000, SECT)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在_WAK方法中的最前面添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\_SB.PCI0.PATA._INI ()</span><br><span class="line">\_SB.PCI0.SATA._INI ()</span><br></pre></td></tr></table></figure>

<h4 id="原生AHCI支持"><a href="#原生AHCI支持" class="headerlink" title="原生AHCI支持"></a>原生AHCI支持</h4><p>在GPCT方法前插入以下代码。此代码依赖DTGP方法，需提前添加DTGP方法到DSDT前部。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Method (_DSM, 4, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">Store (Package (0x02)</span><br><span class="line">&#123;</span><br><span class="line">   &quot;device-id&quot;,</span><br><span class="line">   Buffer (0x04)</span><br><span class="line">     &#123;</span><br><span class="line">          0xC5, 0x27, 0x00, 0x00</span><br><span class="line">      &#125;</span><br><span class="line">&#125;, Local0)</span><br><span class="line">DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">Return (Local0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Clamshell修复"><a href="#Clamshell修复" class="headerlink" title="Clamshell修复"></a>Clamshell修复</h4><p>定位到LID设备的<code>_LID</code>方法并修改如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Name (LIDS, One)</span><br><span class="line">Method (_LID, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">        Store (^^PCI0.LPC.EC.HPLD, LIDS) </span><br><span class="line">        XOr (LIDS, One, Local0)</span><br><span class="line">        If (Local0)                     </span><br><span class="line">        &#123; </span><br><span class="line">            Notify (SLPB, 0x80)             </span><br><span class="line">        &#125; </span><br><span class="line">        Return (LIDS)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="修复UUID-Error"><a href="#修复UUID-Error" class="headerlink" title="修复UUID Error"></a>修复UUID Error</h4><p>在DSDT中搜索PCI0设备，查看<code>_UID</code>的值，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Name (_UID, One)</span><br></pre></td></tr></table></figure>

<p>启动参数添加<code>PciRoot=#</code>即可，其中#为_UID的值，上例为1。</p>
<h4 id="让EHCI-USB-2-0识别为内建"><a href="#让EHCI-USB-2-0识别为内建" class="headerlink" title="让EHCI USB 2.0识别为内建"></a>让EHCI USB 2.0识别为内建</h4><p>此代码依赖DTGP方法，需提前添加DTGP方法到DSDT前部。找到0x001D0007和0x001A0007两个设备，并将原来的设备名称分别更改为EHC1和EHC2。在EHC1设备下添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Method (_DSM, 4, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Store (Package (0x04)</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;AAPL,clock-id&quot;,</span><br><span class="line">        Buffer (One)</span><br><span class="line">        &#123;</span><br><span class="line">            0x01</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, Local0)</span><br><span class="line">    DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">    Return (Local0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在EHC2设备下添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Method (_DSM, 4, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Store (Package (0x04)</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;AAPL,clock-id&quot;,</span><br><span class="line">        Buffer (One)</span><br><span class="line">        &#123;</span><br><span class="line">            0x02</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, Local0)</span><br><span class="line">    DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">    Return (Local0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="跳过操作系统检查"><a href="#跳过操作系统检查" class="headerlink" title="跳过操作系统检查"></a>跳过操作系统检查</h4><p>在操作系统检查功能的代码下方以及If (LGreaterEqual (_REV, 0x02))上方加入以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Store (One, WNTF)</span><br><span class="line">Store (One, WXPF)</span><br><span class="line">Store (0x02, WSPV)</span><br><span class="line">Store (One, WVIS)</span><br></pre></td></tr></table></figure>

<h4 id="开启亮度滑块"><a href="#开启亮度滑块" class="headerlink" title="开启亮度滑块"></a>开启亮度滑块</h4><p>在<code>Scope (_SB)</code>块中的_INI方法之后，需要在LNKA设备上方添加以下设备。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Device (PNLF)</span><br><span class="line">&#123;</span><br><span class="line">Name (_HID, EisaId (&quot;APP0002&quot;))</span><br><span class="line">Name (_CID, &quot;backlight&quot;)</span><br><span class="line">Name (_UID, 0x0A)</span><br><span class="line">Name (_STA, 0x0B)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="用USB唤醒睡眠"><a href="#用USB唤醒睡眠" class="headerlink" title="用USB唤醒睡眠"></a>用USB唤醒睡眠</h4><p>适用于只可通过电源键进行睡眠唤醒的情况。</p>
<p>找到<code>_WAK</code>方法，将Notify附近的代码修改如下。具体为将USB0-USB4修改为UHC1-UHC5，添加EHC1和EHC2，并添加Return方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Notify (\_SB.PCI0.UHC1, Zero)</span><br><span class="line">Notify (\_SB.PCI0.UHC2, Zero)</span><br><span class="line">Notify (\_SB.PCI0.UHC3, Zero)</span><br><span class="line">Notify (\_SB.PCI0.UHC4, Zero)</span><br><span class="line">Notify (\_SB.PCI0.UHC5, Zero)</span><br><span class="line">Notify (\_SB.PCI0.EHC1, Zero)</span><br><span class="line">Notify (\_SB.PCI0.EHC2, Zero)</span><br><span class="line">Return (Package (0x02)</span><br><span class="line">&#123;</span><br><span class="line">    Zero,</span><br><span class="line">    Zero</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>找到<code>Scope (_GPE)</code>物件，将USB0-USB4修改为UHC1-UHC5，USB1-USB2修改为EHC1-EHC2，并删除<code>Notify (\_SB.PCI0.USB3, 0x02)</code>，然后在每个修改过的Notify方法后面加<code>Notify (\_SB.PWRB, 0x02)</code>。</p>
<p>找到UHC1-UHC5和EHC1-EHC2设备，将其中<code>_PRW</code>中的Package的第二个参数由0x01或One修改为0x03。</p>
<p>添加以下物件后，在引导器配置中修改device-id的参数即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Method (DTGP, 5, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If (LEqual (Arg0, Buffer (0x10)</span><br><span class="line">            &#123;</span><br><span class="line">                /* 0000 */    0xC6, 0xB7, 0xB5, 0xA0, 0x18, 0x13, 0x1C, 0x44,</span><br><span class="line">                /* 0008 */    0xB0, 0xC9, 0xFE, 0x69, 0x5E, 0xAF, 0x94, 0x9B</span><br><span class="line">            &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">    If (LEqual (Arg1, One))</span><br><span class="line">        &#123;</span><br><span class="line">            If (LEqual (Arg2, Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (Buffer (One)</span><br><span class="line">                    &#123;</span><br><span class="line">                        0x03</span><br><span class="line">                    &#125;, Arg4)</span><br><span class="line">                Return (One)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (Arg2, One))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (One)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Store (Buffer (One)</span><br><span class="line">        &#123;</span><br><span class="line">            0x00</span><br><span class="line">        &#125;, Arg4)</span><br><span class="line">    Return (Zero)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用VoodooHDA但忘记删除AppleHDA修复"><a href="#使用VoodooHDA但忘记删除AppleHDA修复" class="headerlink" title="使用VoodooHDA但忘记删除AppleHDA修复"></a>使用VoodooHDA但忘记删除AppleHDA修复</h4><p>注释HDEF设备即可。</p>
<h4 id="引导加载AC适配器驱动"><a href="#引导加载AC适配器驱动" class="headerlink" title="引导加载AC适配器驱动"></a>引导加载AC适配器驱动</h4><p>在AC设备的Name (_UID, Zero)后添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Name (_PRW, Package (0x02)</span><br><span class="line">&#123;</span><br><span class="line">0x18,</span><br><span class="line">0x03</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="引导加载AppleLPC"><a href="#引导加载AppleLPC" class="headerlink" title="引导加载AppleLPC"></a>引导加载AppleLPC</h4><p>DSDT搜索0x001F0000，查看对应的设备，对于技嘉为PX40，可全部修改为LPCB或不修改。然后在该设备添加以下方法即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Method (_DSM, 4, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Store (Package (0x02)</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;device-id&quot;,</span><br><span class="line">            Buffer (0x04)</span><br><span class="line">            &#123;</span><br><span class="line">                0x18, 0x3A, 0x00, 0x00</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, Local0)</span><br><span class="line">    DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">    Return (Local0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中device-id列表如下。</p>
<table>
<thead>
<tr>
<th>device-id</th>
<th>型号</th>
</tr>
</thead>
<tbody><tr>
<td>0x02, 0x3B, 0x00, 0x00</td>
<td>5 Series&#x2F;3400 Series</td>
</tr>
<tr>
<td>0x01, 0x3B, 0x00, 0x00</td>
<td>Mobile 5 Series</td>
</tr>
<tr>
<td>0x00, 0x3B, 0x00, 0x00</td>
<td>5 Series</td>
</tr>
<tr>
<td>0x18, 0x3A, 0x00, 0x00</td>
<td>ICH10</td>
</tr>
<tr>
<td>0x16, 0x29, 0x00, 0x00</td>
<td>ICH9R</td>
</tr>
<tr>
<td>0x15, 0x28, 0x00, 0x00</td>
<td>ICH8M</td>
</tr>
<tr>
<td>0x11, 0x28, 0x00, 0x00</td>
<td>ICH8M-E</td>
</tr>
<tr>
<td>0xBD, 0x27, 0x00, 0x00</td>
<td>ICH7M-DH</td>
</tr>
<tr>
<td>0xB9, 0x27, 0x00, 0x00</td>
<td>ICH7M</td>
</tr>
<tr>
<td>0x70, 0x26, 0x00, 0x00</td>
<td>ICH6-ESB</td>
</tr>
</tbody></table>
<h4 id="引导加载显卡驱动"><a href="#引导加载显卡驱动" class="headerlink" title="引导加载显卡驱动"></a>引导加载显卡驱动</h4><p>DSDT搜索PCI0，然后在设备内添加以下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">Device (PEGP)</span><br><span class="line">&#123;</span><br><span class="line">    Name (_ADR, 0x00010000)</span><br><span class="line">    Device (GFX0)</span><br><span class="line">    &#123;</span><br><span class="line">        Name (_ADR, Zero)</span><br><span class="line">        Name (_SUN, One)</span><br><span class="line">        Method (_DSM, 4, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            Store (Package (0x18)</span><br><span class="line">                &#123;</span><br><span class="line">                    // ****可不使用此部分****</span><br><span class="line">                    &quot;AAPL,slot-name&quot;,</span><br><span class="line">                    Buffer (0x07)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;Slot-1&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    // ********************</span><br><span class="line"></span><br><span class="line">                    &quot;device_type&quot;,</span><br><span class="line">                    Buffer (0x0C)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;NVDA,Parent&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    // 根据显卡名称修改，注意也要修改0x17为字符串长度</span><br><span class="line">                    &quot;model&quot;,</span><br><span class="line">                    Buffer (0x17)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;NVIDIA Geforce 9800 GT&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    // 在Windows下通过NVFlash取得，具体查看以下解释</span><br><span class="line">                    &quot;NVCAP&quot;,</span><br><span class="line">                    Buffer (0x14)</span><br><span class="line">                                &#123;</span><br><span class="line">                        /* 0000 */    0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00,</span><br><span class="line">                        /* 0008 */    0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,</span><br><span class="line">                        /* 0010 */    0x00, 0x00, 0x00, 0x00</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    // 根据显卡名称修改，注意也要修改0x06为字符串长度</span><br><span class="line">                    &quot;rom-revision&quot;,</span><br><span class="line">                    Buffer (0x06)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;3173a&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    // 显卡显存</span><br><span class="line">                    // 0x10为256MB</span><br><span class="line">                    // 0x20为512MB</span><br><span class="line">                    // 0x40为1024MB</span><br><span class="line">                    &quot;VRAM,totalsize&quot;,</span><br><span class="line">                    Buffer (0x04)</span><br><span class="line">                    &#123;</span><br><span class="line">                        0x00, 0x00, 0x00, 0x20</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    &quot;@0,compatible&quot;,</span><br><span class="line">                    Buffer (0x0B)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;NVDA,NVMac&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    &quot;@0,device_type&quot;,</span><br><span class="line">                    Buffer (0x08)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;display&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    &quot;@0,name&quot;,</span><br><span class="line">                    Buffer (0x0F)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;NVDA,Display-A&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    &quot;@1,compatible&quot;,</span><br><span class="line">                    Buffer (0x0B)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;NVDA,NVMac&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    &quot;@1,device_type&quot;,</span><br><span class="line">                    Buffer (0x08)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;display&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    &quot;@1,name&quot;,</span><br><span class="line">                    Buffer (0x0F)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;NVDA,Display-B&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, Local0)</span><br><span class="line">            DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">            Return (Local0)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NVCAP的内容需要先在Windows下打开NVFlash，并输入以下命令以生成ROM。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvflash -b nvidia.rom</span><br></pre></td></tr></table></figure>

<p>然后在Mac下使用NVCAP Maker打开生成的nvidia.rom，得到数字后两两分开即可，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 处理前</span><br><span class="line">04000000000003000c0000000000000700000000</span><br><span class="line"></span><br><span class="line"># 处理后</span><br><span class="line">0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00</span><br></pre></td></tr></table></figure>

<h4 id="禁用显卡"><a href="#禁用显卡" class="headerlink" title="禁用显卡"></a>禁用显卡</h4><p>在显卡设备的_INI方法添加以下代码即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_OFF()</span><br></pre></td></tr></table></figure>

<p>若提示未找到对象，添加外部引用即可。</p>
<h4 id="引导加载声卡驱动"><a href="#引导加载声卡驱动" class="headerlink" title="引导加载声卡驱动"></a>引导加载声卡驱动</h4><p>DSDT搜索0x001B0000，查看对应的设备，应当为AZAL。将AZAL全部修改为HDEF，然后在该设备添加以下方法即可，注意layout-id需要配合自行制作的驱动参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Method (_DSM, 4, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Store (Package (0x04)</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;layout-id&quot;,</span><br><span class="line">            Buffer (0x04)</span><br><span class="line">            &#123;</span><br><span class="line">                0x78, 0x03, 0x00, 0x00</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            &quot;PinConfigurations&quot;,</span><br><span class="line">            Buffer (Zero) &#123;&#125;</span><br><span class="line">        &#125;, Local0)</span><br><span class="line">    DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">    Return (Local0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="设置调节风扇转速快捷键"><a href="#设置调节风扇转速快捷键" class="headerlink" title="设置调节风扇转速快捷键"></a>设置调节风扇转速快捷键</h4><p>以Fn+Home为例，该快捷键在<code>_Q14</code>被定义。也可使用Fn+End，定义于<code>_Q15</code>。根据需求，在快捷键的对应方法添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 选择其一即可</span><br><span class="line">## 自动模式</span><br><span class="line">Store (0x80, \_SB.PCI0.LPC.EC.HFSP)</span><br><span class="line">## 关闭</span><br><span class="line">Store (0x00, \_SB.PCI0.LPC.EC.HFSP)</span><br><span class="line">## 最慢</span><br><span class="line">Store (0x01, \_SB.PCI0.LPC.EC.HFSP)</span><br><span class="line">## 最快</span><br><span class="line">Store (0x05, \_SB.PCI0.LPC.EC.HFSP)</span><br></pre></td></tr></table></figure>

<h4 id="亮度按键映射"><a href="#亮度按键映射" class="headerlink" title="亮度按键映射"></a>亮度按键映射</h4><p>对于使用VoodooPS2Controller，补丁如下。注意LPCB也可能为LPC、SBRG，PS2K也可能为KBD、KBD0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">into method label _Q11 replace_content</span><br><span class="line">begin</span><br><span class="line">// Brightness Down\n</span><br><span class="line">    Notify(\_SB.PCI0.LPCB.PS2K, 0x0405)\n</span><br><span class="line">end;</span><br><span class="line">into method label _Q12 replace_content</span><br><span class="line">begin</span><br><span class="line">// Brightness Up\n</span><br><span class="line">    Notify(\_SB.PCI0.LPCB.PS2K, 0x0406)\n</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>对于使用ApplePS2SmartTouchPad，补丁如下。注意PS2K也可能为KBD、KBD0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">into method label _Q11 replace_content</span><br><span class="line">begin</span><br><span class="line">// Brightness Down\n</span><br><span class="line">Notify (PS2K, 0x20)\n</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">into method label _Q12 replace_content</span><br><span class="line">begin</span><br><span class="line">// Brightness Up\n</span><br><span class="line">Notify (PS2K, 0x10)\n</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h4 id="加载AppleLPC"><a href="#加载AppleLPC" class="headerlink" title="加载AppleLPC"></a>加载AppleLPC</h4><p>加载AppleLPC可实现原生CPU电源管理。</p>
<p>查看SLE下的AppleLPC.kext&#x2F;Contents&#x2F;Info.plist，可查看和AppleLPC匹配的设备ID。打开DSDT，搜索0x001F0000，在该设备下添加以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Method (_DSM, 4, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Store (Package (0x02)</span><br><span class="line">    &#123;</span><br><span class="line">            &quot;device-id&quot;,</span><br><span class="line">            Buffer (0x04)</span><br><span class="line">            &#123;</span><br><span class="line">                0x18, 0x3A, 0x00, 0x00</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, Local0)</span><br><span class="line">    DTGP (Arg0, Arg1, Arg2, Arg3, RefOf (Local0))</span><br><span class="line">    Return (Local0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后需要屏蔽IRQ。查找PNP0000，按以下代码屏蔽IRQ。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Device (PIC)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    Name (_CRS, ResourceTemplate()</span><br><span class="line">    &#123;</span><br><span class="line">        IO (Decode16,</span><br><span class="line">            0x0020,</span><br><span class="line">            0x0020,</span><br><span class="line">            0x01,</span><br><span class="line">            0x02,</span><br><span class="line">            )</span><br><span class="line">        IO (Decode16,</span><br><span class="line">            0x00A0,</span><br><span class="line">            0x00A0,</span><br><span class="line">            0x01,</span><br><span class="line">            0x02,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        /* IRQNoFlags ()</span><br><span class="line">                &#123;2&#125; */</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查找PNP0100，按以下代码屏蔽IRQ。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Device (TMR)&#123;</span><br><span class="line">    ...</span><br><span class="line">    Name (ATT5, ResourceTemplate()</span><br><span class="line">    &#123;</span><br><span class="line">        IO (Decode16,</span><br><span class="line">            0x0040,</span><br><span class="line">            0x0040,</span><br><span class="line">            0x00,</span><br><span class="line">            0x04,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            /* IRQNoFlags ()</span><br><span class="line">                &#123;0&#125; */</span><br><span class="line">        &#125;)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>可在任意地方插入以下代码，运行时睡眠灯将会闪烁。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\_SB.PCI0.LPC.EC.LED (0x07, 0x80)</span><br><span class="line">Sleep(0x64)</span><br><span class="line">\_SB.PCI0.LPC.EC.LED (0x07, 0x00)</span><br></pre></td></tr></table></figure>

<h2 id="SSDT"><a href="#SSDT" class="headerlink" title="SSDT"></a>SSDT</h2><p>应当实现以下SSDT修补。以下修补文件在OpenCore的AcpiSamples文件夹。</p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><table>
<thead>
<tr>
<th>平台</th>
<th>CPU</th>
<th>EC</th>
<th>AWAC&#x2F;RTC</th>
<th>NVRAM</th>
<th>USB</th>
<th>PCI</th>
<th>Backlight</th>
<th>I2C触控板</th>
<th>IRQ</th>
<th>IMEI</th>
</tr>
</thead>
<tbody><tr>
<td>Penryn</td>
<td>&#x2F;</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Lynnfield and Clarkdale</td>
<td>&#x2F;</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Clarksfield and Arrandale</td>
<td>&#x2F;</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td>SSDT-PNLF</td>
<td></td>
<td>IRQ SSDT</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Sandy Bridge</td>
<td>CPU-PM（系统安装后使用）</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF</td>
<td></td>
<td>IRQ SSDT</td>
<td>SSDT-IMEI（用于7代主板）</td>
</tr>
<tr>
<td>Ivy Bridge</td>
<td>CPU-PM（系统安装后使用）</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF</td>
<td></td>
<td>IRQ SSDT</td>
<td>SSDT-IMEI（用于6代主板）</td>
</tr>
<tr>
<td>Haswell</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF</td>
<td>SSDT-GPI0</td>
<td>IRQ SSDT</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Broadwell</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF</td>
<td>SSDT-GPI0</td>
<td>IRQ SSDT</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Skylake</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF</td>
<td>SSDT-GPI0</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Kaby Lake</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF</td>
<td>SSDT-GPI0</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Coffee Lake (8th Gen) and Whiskey Lake</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-AWAC</td>
<td>SSDT-PMC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF-CFL</td>
<td>SSDT-GPI0</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Coffee Lake (9th Gen)</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-AWAC</td>
<td>SSDT-PMC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-PNLF-CFL</td>
<td>SSDT-GPI0</td>
<td>&#x2F;</td>
<td></td>
</tr>
<tr>
<td>Comet Lake</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-AWAC</td>
<td>&#x2F;</td>
<td>SSDT-RHUB</td>
<td>&#x2F;</td>
<td>SSDT-PNLF-CFL</td>
<td>SSDT-GPI0</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>Ice Lake</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-AWAC</td>
<td>&#x2F;</td>
<td>SSDT-RHUB</td>
<td>&#x2F;</td>
<td>SSDT-PNLF-CFL</td>
<td>SSDT-GPI0</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>AMD (15&#x2F;16h, Bulldozer&#x2F;Jaguar)</td>
<td>&#x2F;</td>
<td>SSDT-EC-USBX</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>AMD (17&#x2F;19h, Zen)</td>
<td>SSDT-CPUR for B550 and A520</td>
<td>SSDT-EC-USBX</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Nehalem and Westmere</td>
<td>&#x2F;</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Sandy Bridge-E</td>
<td>&#x2F;</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-UNC</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ivy Bridge-E</td>
<td>&#x2F;</td>
<td>SSDT-EC</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-UNC</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Haswell-E</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-RTC0-RANGE</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-UNC</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Broadwell-E</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-RTC0-RANGE</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>SSDT-UNC</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skylake-X</td>
<td>SSDT-PLUG</td>
<td>SSDT-EC-USBX</td>
<td>SSDT-RTC0-RANGE</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<details>
<summary>【旧版】SSDT列表</summary>

<table>
<thead>
<tr>
<th>名称</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>SSDT-Config</td>
<td>SSDT控制入口文件</td>
</tr>
<tr>
<td>SSDT-LPC</td>
<td>正确识别LPC总线到系统</td>
</tr>
<tr>
<td>SSDT-SMBUS</td>
<td>正确识别SMBus到系统</td>
</tr>
<tr>
<td>SSDT-DMAC</td>
<td>将DMA控制器公开给系统</td>
</tr>
<tr>
<td>SSDT-MCHC</td>
<td>将内存控制器暴露在系统中</td>
</tr>
<tr>
<td>SSDT-IGPU</td>
<td>将属性添加到集成显卡设备，可以实现HDMI音频以及正确显示</td>
</tr>
<tr>
<td>SSDT-Disable_DGPU</td>
<td>在启动时关闭独立显卡，因为Mac OS无法使用它</td>
</tr>
<tr>
<td>SSDT-ALS0</td>
<td>添加假环境光传感器以在重新启动之间保存背光信息</td>
</tr>
<tr>
<td>SSDT-BRT6</td>
<td>将键盘的ACPI管理亮度键映射到VoodooPS2Controller.kext的PS2代码</td>
</tr>
<tr>
<td>SSDT-Dell_FN</td>
<td>将键盘的ACPI管理亮度键映射到VoodooPS2Controller.kext的PS2代码 （部分DELL机型）</td>
</tr>
<tr>
<td>SSDT-PNLF</td>
<td>显示器亮度控制，为IntelBacklight.kext或AppleBacklight.kext + AppleBacklightInjector.kext添加PNLF设备</td>
</tr>
<tr>
<td>SSDT-HDAU</td>
<td>自动注入HDAU属性（适用于Haswell和Broadwell平台）</td>
</tr>
<tr>
<td>SSDT-HDEF</td>
<td>自动注入HDEF属性（声卡layoutid注入点）</td>
</tr>
<tr>
<td>SSDT-GPRW</td>
<td>通过挂接GPRW或UPRW来解决即时唤醒</td>
</tr>
<tr>
<td>SSDT-LANC_PRW</td>
<td>通过挂接GPRW来解决即时唤醒</td>
</tr>
<tr>
<td>SSDT-UPRW</td>
<td>通过挂接GPRW或UPRW来解决即时唤醒</td>
</tr>
<tr>
<td>SSDT-IMEI</td>
<td>添加IMEI（6系列HD4000，7系HD3000）</td>
</tr>
<tr>
<td>SSDT-PTSWAK</td>
<td>在睡眠之前对离散GPU进行驱动，并在唤醒后将其关闭，以确保系统能够跟踪它</td>
</tr>
<tr>
<td>SSDT-Debug</td>
<td>用于ACPIDebug，该文件是通过将「添加DSDT调试方法」应用于空SSDT创建的，使用「添加SSDT调试外部声明」从其他方式访问这些方法hotpatch SSDT甚至打补丁的OEM ACPI文件</td>
</tr>
<tr>
<td>SSDT-ESEL</td>
<td>关闭ESEL，在DSDT里原生ESEL被重命名为ESEX</td>
</tr>
<tr>
<td>SSDT-XWAK</td>
<td>关闭XWAK，在DSDT里原生的XWAK被重命名为ZWAK</td>
</tr>
<tr>
<td>SSDT-PluginType1</td>
<td>在_PR.CPU0上插入plugin-type&#x3D;1，可能是所有支持XCPM的SMBIOS只需要这种插件类型的注入</td>
</tr>
<tr>
<td>SSDT-SATA</td>
<td>修复某些不支持的SATA设备</td>
</tr>
<tr>
<td>SSDT-XHC</td>
<td>自动注入XHC属性</td>
</tr>
<tr>
<td>SSDT-XOSI</td>
<td>操作系统补丁</td>
</tr>
<tr>
<td>SSDT-AWAC</td>
<td>修复300系列主板（B360&#x2F;B365&#x2F;H310&#x2F;H370&#x2F;Z390等）系列主板的RTC设备问题，部分微星的主板&#x2F;清华同方九代模具需要应用这个补丁，否则会卡住而无法进入系统，建议八代 CoffeeLake以上的用户都添加</td>
</tr>
<tr>
<td>SSDT-EC-USBX</td>
<td>添加了一个仿冒的EC设备并完善了USB的供电，若主板的EmbeddedController原生ACPI命名就是EC则不需要该补丁</td>
</tr>
<tr>
<td>SSDT-PMC</td>
<td>与NVRAM相关</td>
</tr>
<tr>
<td>SSDT-PLUG</td>
<td>启用原生电源管理，Skylake六代以上的机型在Clover中可以直接勾选注入插件类型，自动注入<code>plugin-type=1</code>参数实现同等效果</td>
</tr>
</tbody></table>
</details>

<h3 id="SSDT示例"><a href="#SSDT示例" class="headerlink" title="SSDT示例"></a>SSDT示例</h3><h4 id="SSDT-EC"><a href="#SSDT-EC" class="headerlink" title="SSDT-EC"></a>SSDT-EC</h4><p>禁用原有EC设备，并新建一个新的EC设备。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Desktop</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-EC-DESKTOP.aml</span><br><span class="line"></span><br><span class="line"># Laptop</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-EC-LAPTOP.aml</span><br></pre></td></tr></table></figure>

<details>
<summary>【进阶】手动编写</summary>

<p>在DSDT中搜索PNP0C09，即可定位到EC设备。也可在Windows下的设备管理器下查找Embedded Controller，右键选择属性，在详细页面选择BIOS名称查看设备路径。</p>
<p>根据需求下载以下示例并打开。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># SSDT-EC-USBX</span><br><span class="line">https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-EC-USBX.dsl</span><br><span class="line"></span><br><span class="line"># SSDT-EC</span><br><span class="line">https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-EC.dsl</span><br></pre></td></tr></table></figure>

<p>若为笔记本，则不要修改注释掉的代码，否则取消对代码的注释。这段代码的主要用途为禁用EC设备。</p>
<p>重命名以下地方为获得的EC设备路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_.PCI0.LPCB, DeviceObj)</span><br><span class="line">Scope (_SB.PCI0.LPCB)</span><br></pre></td></tr></table></figure>

<p>若出现多个PNP0C09，则检查是否存在<code>_HID</code>、<code>_CRS</code>、<code>_GPE</code>方法，若均存在，则该设备为所求的EC设备。但若有<code>_STA</code>方法，说明该EC设备是无用设备。</p>
<p>若无PNP0C09，则只需虚拟一个EC。尝试搜索LPCB、LPC0、LPC、SBRG、PX40，若其一存在，则使用其LPC路径取代SSDT中的EC设备路径。</p>
<p>若PNP0C09已被重命名为EC，则无需使用以上SSDT。但若为Skylake及更新版本，则仍需要SSDT-USBX。</p>
</details>

<h4 id="SSDT-EC-USBX"><a href="#SSDT-EC-USBX" class="headerlink" title="SSDT-EC-USBX"></a>SSDT-EC-USBX</h4><p>用于禁用真正的嵌入式控制器并为Mac创建一个假的控制器。USBX部分用于注入Skylake和更新版本上缺少的USB电源属性。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Desktop</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-EC-USBX-DESKTOP.aml</span><br><span class="line"></span><br><span class="line"># Laptop</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-EC-USBX-LAPTOP.aml</span><br></pre></td></tr></table></figure>

<p>在Catalina及更新版本中，AppleACPIEC.kext及其插件和USB电源管理依赖于名为EC的ACPI设备。同时，AppleBusPowerController也会查找名为EC的设备，还需要一个USBX设备来为Skylake和更新版本提供USB电源属性，因此SSDT-EC-USBX将SSDT-EC和SSDT-USBX进行了结合。</p>
<p>EC设备在笔记本上主要用于电池管理和热键处理，在台式机上与AppleACPIEC冲突。因此在笔记本上可以通过创建一个假EC设备实现启动，而在台式机中直接禁用该设备。</p>
<details>
<summary>【备注】SSDT-USBX</summary>

<p>SSDT-USBX不可使用于Broadwell及更早版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/OpenCore-Post-Install/blob/master/extra-files/SSDT-USBX.aml</span><br></pre></td></tr></table></figure>
</details>

<h4 id="SSDT-IMEI"><a href="#SSDT-IMEI" class="headerlink" title="SSDT-IMEI"></a>SSDT-IMEI</h4><p>在ACPI中不存在IMEI设备时创建IMEI设备。</p>
<p>使用Sandy Bridge CPU的7系列主板（B75、Q75、Z75、H77、Q77、Z77）和Ivy Bridge CPU的6系列主板（H61、B65、Q65、P67、H67、Q67、Z68）需要。</p>
<p>在DSDT中搜索IMEI&#x2F;HECI&#x2F;MEI，若出现其一，则不需要SSDT-IMEI。若未出现则需要使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-IMEI.aml</span><br></pre></td></tr></table></figure>

<h4 id="SSDT-PLUG"><a href="#SSDT-PLUG" class="headerlink" title="SSDT-PLUG"></a>SSDT-PLUG</h4><p>启用Apple的XCPM，从而实现更好的CPU电源管理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-PLUG-DRTNIA.aml</span><br></pre></td></tr></table></figure>

<h4 id="SSDT-AWAC-x2F-SSDT-RTC0-RANGE-HEDT"><a href="#SSDT-AWAC-x2F-SSDT-RTC0-RANGE-HEDT" class="headerlink" title="SSDT-AWAC&#x2F;SSDT-RTC0-RANGE-HEDT"></a>SSDT-AWAC&#x2F;SSDT-RTC0-RANGE-HEDT</h4><p>在Mac中启用旧版RTC时钟，因为不支持较新的AWAC时钟。适用于以下主板。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">B360</span><br><span class="line">B365</span><br><span class="line">H310</span><br><span class="line">H370</span><br><span class="line">Z370 (Gigabyte and AsRock boards with newer BIOS versions)</span><br><span class="line">Z390</span><br><span class="line">B460</span><br><span class="line">Z490</span><br><span class="line">400 series (Comet Lake, including Z490)</span><br><span class="line">495 series (Icelake)</span><br><span class="line">X99</span><br><span class="line">X299</span><br></pre></td></tr></table></figure>

<p>SSDT-RTC0-RANGE-HEDT还解决了由于ACPI实施不佳而导致的Big Sur启动的提前停止。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># SSDT-AWAC</span><br><span class="line"># 适用于大多数主板</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-AWAC.aml</span><br><span class="line"></span><br><span class="line"># SSDT-RTC0-RANGE-HEDT</span><br><span class="line"># 适用于Intel的X99和X299平台</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-RTC0-RANGE-HEDT.aml</span><br></pre></td></tr></table></figure>

<details>
<summary>【进阶】手动编写</summary>

<p>在DSDT中搜索ACPI000E，用于搜索AWAC设备。若无该设备则无需进行以下操作。</p>
<p>继续搜索PNP0B00，用于搜索RTC设备。若有该设备，则证明可以禁用AWAC并启用RTC，使用上面的SSDT-AWAC即可。</p>
<p>若无RTC设备，则需要使用SSDT-RTC0，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-RTC0.dsl</span><br></pre></td></tr></table></figure>

<p>需要改动的设备路径如下，其中LPCB路径可通过搜索<code>Name (_ADR, 0x001F0000)</code>查看。注意应当保证PCI设备存在，可通过搜索<code>PNP0A08</code>确定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_.PCI0.LPCB, DeviceObj)</span><br><span class="line">Scope (_SB.PCI0.LPCB)</span><br></pre></td></tr></table></figure>
</details>

<h4 id="SSDT-PMC"><a href="#SSDT-PMC" class="headerlink" title="SSDT-PMC"></a>SSDT-PMC</h4><p>在300系列主板上启用本机NVRAM，如B360、B365、H310、H370、Z390。Z370、HM370不需要。仅适用于第九代笔记本电脑，第十代不需要。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-PMC.aml</span><br></pre></td></tr></table></figure>

<details>
<summary>【进阶】手动编写</summary>

<p>需要使用的SSDT如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/acidanthera/OpenCorePkg/tree/master/Docs/AcpiSamples/Source/SSDT-PMC.dsl</span><br></pre></td></tr></table></figure>

<p>需要改动的设备路径如下，其中LPCB路径可通过搜索<code>Name (_ADR, 0x001F0000)</code>查看。注意应当保证PCI设备存在，可通过搜索<code>PNP0A08</code>确定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_.PCI0.LPCB, DeviceObj)</span><br><span class="line">Scope (_SB.PCI0.LPCB)</span><br></pre></td></tr></table></figure>
</details>

<h4 id="SSDT-RHUB"><a href="#SSDT-RHUB" class="headerlink" title="SSDT-RHUB"></a>SSDT-RHUB</h4><p>重置Asus 400系列主板上的USB控制器。Gigabyte、MSI、AsRock等不需要。主要用于使用Ice Lake的Dell笔记本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-RHUB.aml</span><br></pre></td></tr></table></figure>

<details>
<summary>【进阶】手动编写</summary>

<p>需要使用的SSDT如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/decompiled/SSDT-RHUB.dsl</span><br></pre></td></tr></table></figure>

<p>需要改动的设备路径如下，其中RHUB路径可通过搜索<code>Device (RHUB)</code>查看。也可搜索XHC&#x2F;XHCI&#x2F;XHC1。注意应当保证PCI设备存在，可通过搜索<code>PNP0A08</code>确定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_.PCI0.XHC1.RHUB, DeviceObj)</span><br><span class="line">Scope (_SB.PCI0.XHC1.RHUB)</span><br></pre></td></tr></table></figure>
</details>

<h4 id="SSDT-PNLF"><a href="#SSDT-PNLF" class="headerlink" title="SSDT-PNLF"></a>SSDT-PNLF</h4><p>控制内部显示器背光。在极少数情况下，可能需要修改GFX0为显卡设备名称。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Kaby Lake及更低</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-PNLF.aml</span><br><span class="line"></span><br><span class="line"># Coffee Lake及更高</span><br><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-PNLF-CFL.aml</span><br></pre></td></tr></table></figure>

<h4 id="SSDT-XOSI"><a href="#SSDT-XOSI" class="headerlink" title="SSDT-XOSI"></a>SSDT-XOSI</h4><p>在macOS中启用许多仅限Windows的功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-XOSI.aml</span><br></pre></td></tr></table></figure>

<h4 id="SSDT-UNC"><a href="#SSDT-UNC" class="headerlink" title="SSDT-UNC"></a>SSDT-UNC</h4><p>确保正确禁用未使用或丢失的非核心桥接器，否则会在Big Sur中出现IOPCIFamily的panic。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-UNC.aml</span><br></pre></td></tr></table></figure>

<h4 id="SSDT-CPUR"><a href="#SSDT-CPUR" class="headerlink" title="SSDT-CPUR"></a>SSDT-CPUR</h4><p>用于修复ACPI中的CPU定义，因为Mac不能正确支持B550和更新的主板中使用的ACPI。仅无threadripper的机器以及B550、A520和更新版本需要，X570和更旧版本并不需要。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/Getting-Started-With-ACPI/blob/master/extra-files/compiled/SSDT-CPUR.aml</span><br></pre></td></tr></table></figure>

<h4 id="SSDT-SBUS-MCHC"><a href="#SSDT-SBUS-MCHC" class="headerlink" title="SSDT-SBUS-MCHC"></a>SSDT-SBUS-MCHC</h4><p>修复AppleSMBus。非必需，安装时无需此SSDT。</p>
<p>打开Hackintool并点击PCI选项卡，在SubClass下查找SMBus设备，即可找到其ACPI路径。也可在Windows下通过设备管理器，查找SMBus设备并查看其BIOS名称。</p>
<p>获取以下示例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-SBUS-MCHC.dsl</span><br></pre></td></tr></table></figure>

<p>需要修改的设备路径如下，修改为上面找到的SMBus设备路径即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_.PCI0, DeviceObj)</span><br><span class="line">External (_SB_.PCI0.SBUS.BUS0, DeviceObj)</span><br><span class="line">Scope (_SB.PCI0)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">Device (_SB.PCI0.SBUS.BUS0</span><br></pre></td></tr></table></figure>

<p>编译并放置后，可在终端输入以下命令以查看是否工作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kextstat | grep -E &quot;AppleSMBusController|AppleSMBusPCI&quot;</span><br></pre></td></tr></table></figure>

<h4 id="IRQ-SSDT"><a href="#IRQ-SSDT" class="headerlink" title="IRQ SSDT"></a>IRQ SSDT</h4><p>使用SSDTTime即可。</p>
<details>
<summary>【进阶】对于HP Compaq DC7900</summary>

<p>需要以下SSDT。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/khronokernel/trashOS/blob/master/HP-Compaq-DC7900/0.6.1%20HP%20EFI/EFI/OC/ACPI/SSDT-CSR-HPET.aml</span><br></pre></td></tr></table></figure>

<p>在OpenCore配置文件的ACPI-Patch添加以下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Comment: change CRES to XCRES</span><br><span class="line">Find: 48504554085F4849440C41D00103085F5549440A010843524553</span><br><span class="line">Replace: 48504554085F4849440C41D00103085F5549440A010858524553</span><br></pre></td></tr></table></figure>
</details>

<h4 id="FixShutdown-USB-SSDT"><a href="#FixShutdown-USB-SSDT" class="headerlink" title="FixShutdown-USB-SSDT"></a>FixShutdown-USB-SSDT</h4><p>用于替代FixShutdown。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dortania/OpenCore-Post-Install/blob/master/extra-files/FixShutdown-USB-SSDT.dsl</span><br><span class="line"></span><br><span class="line"># 搭配以下更名补丁</span><br><span class="line">https://github.com/dortania/OpenCore-Post-Install/blob/master/extra-files/FixShutdown-Patch.plist</span><br></pre></td></tr></table></figure>

<h3 id="SSDT生成"><a href="#SSDT生成" class="headerlink" title="SSDT生成"></a>SSDT生成</h3><p>可使用SSDTTime生成部分SSDT，具体如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">IRQ patch</span><br><span class="line">SSDT-EC（注意没有SSDT-EC-USBX，可手动添加SSDT-USBX）</span><br><span class="line">SSDT-PLUG</span><br><span class="line">SSDT-PMC</span><br><span class="line">SSDT-AWAC/RTC0</span><br><span class="line">SSDT-RHUB</span><br></pre></td></tr></table></figure>

<p>注意，若进行FixHPET，还需要将oc_patches.plist合并到原来的配置文件中，具体为添加ACPI-Patch部分。</p>
<h3 id="SSDT制作"><a href="#SSDT制作" class="headerlink" title="SSDT制作"></a>SSDT制作</h3><h4 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h4><h5 id="外部引用"><a href="#外部引用" class="headerlink" title="外部引用"></a>外部引用</h5><p>由于SSDT仅为DSDT的一部分，在该SSDT中的变量可能并不在这段代码中定义，在编译时则会出现<code>对象不存在</code>错误。因此需要添加外部引用，声明该变量在DSDT中已被定义过。</p>
<p>外部引用通过以下语句完成，它应当填到DefinitionBlock的下面。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">External ([字段名（包含路径）], [字段对象])</span><br></pre></td></tr></table></figure>

<p>在DSDT中搜索需要添加的外部字段，一般所得到的第一个结果即为其字段定义，字段定义与字段对象的对应关系如下表。编译不报错时，添加外部引用完成。</p>
<p>添加外部引用的示例可参照电池修补过程。</p>
<table>
<thead>
<tr>
<th>字段定义</th>
<th>字段对象</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>Name (GZXB, 0)</td>
<td>IntObj</td>
<td>整数</td>
<td>External (GZXB, IntObj)</td>
</tr>
<tr>
<td>Field (…){…, OSYS,16, …}</td>
<td>FieldUnitObj</td>
<td>字段单元</td>
<td>External (OSYS, FieldUnitObj)</td>
</tr>
<tr>
<td>Mutex (BATM, 0x07)</td>
<td>MutexObj</td>
<td>互斥体</td>
<td><code>External (_SB.PCI0.LPCB.H_EC.BATM, MutexObj)</code></td>
</tr>
<tr>
<td>Name (BPKH, Package (0x07){……})</td>
<td>PkgObj</td>
<td>包</td>
<td><code>External (_SB.PCI0.LPCB.H_EC.BAT1.BPKH, PkgObj)</code></td>
</tr>
<tr>
<td>Device (TPD0)</td>
<td>DeviceObj</td>
<td>设备</td>
<td><code>External (_SB.PCI0.I2C1.TPD0, DeviceObj)</code></td>
</tr>
<tr>
<td>Method (_STA, 0, NotSerialized)</td>
<td>MethodObj</td>
<td>函数</td>
<td><code>External (_SB.PCI0.I2C1.TPD0._STA, MethodObj)</code></td>
</tr>
<tr>
<td>OperationRegion (GNVS, SystemMemory, 0x7A4E7000, 0x0866)</td>
<td>OpRegionObj</td>
<td>操作区</td>
<td>External (GNVS, OpRegionObj)</td>
</tr>
<tr>
<td>Event (XXXX)</td>
<td>EventObj</td>
<td>事件</td>
<td>External (XXXX, EventObj)</td>
</tr>
<tr>
<td>ThermalZone (THRM)</td>
<td>ThermalZoneObj</td>
<td>温控区</td>
<td>External (THRM, ThermalZoneObj)</td>
</tr>
<tr>
<td>CreateField (AAAA, Zero, BBBB)</td>
<td>BuffFieldObj</td>
<td>缓冲区</td>
<td><code>External (_SB.PCI0._CRS.BBBB, BuffFieldObj)</code></td>
</tr>
<tr>
<td>Name (BPKH, Buffer (0x07){……})</td>
<td>BuffObj</td>
<td>缓冲</td>
<td>External (BPKH, BuffObj)</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>UnknownObj</td>
<td>未知</td>
<td>External (_SB.EROR, UnknownObj)</td>
</tr>
<tr>
<td><code>Name (MSTR,&quot;ASL&quot;)</code></td>
<td>StrObj</td>
<td>字符串</td>
<td>External (_PR.MSTR, StrObj)</td>
</tr>
<tr>
<td>PowerResource (USBC, 0, 0)</td>
<td>PowerResObj</td>
<td>电源资源</td>
<td>External (_SB.PCI0.XDCI, PowerResObj</td>
</tr>
<tr>
<td>Processor (PR00, 0x01, 0x00001810, 0x06)</td>
<td>ProcessorObj</td>
<td>处理器</td>
<td>External (_SB.PR00, ProcessorObj)</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>DDBHandleObj</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="偏移量"><a href="#偏移量" class="headerlink" title="偏移量"></a>偏移量</h5><p>以下代码中GNVS可以替换为任意名称，因为<code>0x100, Zero</code>指向该地址的范围，偏移量地址已经被确定。而OOXX可以用0x1E代替，因为首先要保证的是字段的偏移量正确，故OOXX与OOX1互换，其数据也会跟着变化。</p>
<p>偏移量以字节为单位，一字节等于8位，故OOX1的偏移量为0x1E+1&#x3D;0x20。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name (OOXX, Zero)</span><br><span class="line">OperationRegion (GNVS, SystemMemory, 0x100, Zero)</span><br><span class="line">    Field (GNVS,AnyAcc, Lock, Preserve)</span><br><span class="line">    &#123;</span><br><span class="line">        Offset(0x1E),</span><br><span class="line">        OOXX,   16, // 0x1E</span><br><span class="line">        OOX1,   8, // 0x20</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="预置变量法开关设备"><a href="#预置变量法开关设备" class="headerlink" title="预置变量法开关设备"></a>预置变量法开关设备</h5><p>每个设备的_STA方法用于控制设备开关，返回非零为开，返回零为关。因此通过修改_STA的返回值，可以禁用或启用该设备。</p>
<p>预置变量法即在SSDT中对某些变量预先赋值，使某个设备的_STA按照需求返回零或非零。</p>
<h6 id="一般情况"><a href="#一般情况" class="headerlink" title="一般情况"></a>一般情况</h6><p>被修正的变量可能存在于多个地方，对它修正后，在达到预期效果的同时，有可能影响到到其它部件。因此应当尽量修正该设备独有的变量。</p>
<p>预置变量法的示例可参照I2C触控板修补过程。</p>
<h6 id="特殊情况"><a href="#特殊情况" class="headerlink" title="特殊情况"></a>特殊情况</h6><p>被修正的变量可能来自硬件信息，只能读取不能写入。这种情况下需要二进制更名和SSDT补丁共同完成。示例原文如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// IM01为只读</span><br><span class="line">// 实际情况IM01不等于0x02，If内的代码无法被执行</span><br><span class="line">OperationRegion (PNVA, SystemMemory, PNVB, PNVL)</span><br><span class="line">Field (PNVA, AnyAcc, Lock, Preserve)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    IM01,   8,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">If ((IM01 == 0x02))</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为修改IM01，需要将IM01重命名，然后直接通过操作系统而非IM01作为判断条件。假设重命名为XM01，则重命名如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Comment: change IM01 to IM01</span><br><span class="line">Find: 49 4D 30 31 08</span><br><span class="line">Replace: 58 4D 30 31 08</span><br></pre></td></tr></table></figure>

<p>补丁如下。该补丁表示如果操作系统不是Mac，则将IM01恢复为原值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name (IM01, 0x02)</span><br><span class="line">If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">Else</span><br><span class="line">&#123;</span><br><span class="line">      IM01 = XM01 /* 同原始ACPI变量的路径 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于仅包含返回设备状态的使能位和根据条件判断返回的使能位的_STA方法，可以直接将该方法引用为IntObj并赋值。示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 示例一</span><br><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If ((XXXX == Zero))</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line">    Return (0x0F)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 示例二</span><br><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Return (0x0F)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 示例三</span><br><span class="line">Name (_STA, 0x0F)</span><br></pre></td></tr></table></figure>

<p>补丁如下。该方法有效的原因是_STA方法在操作系统OSPM模块对设备状态评估和初始化的优先级高于<code>_INI</code>、<code>_ADR</code>、<code>_HID</code>，且_STA的返回值本身也是整数Integer。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">External (_SB_.PCI0.XXXX._STA, IntObj)</span><br><span class="line"></span><br><span class="line">\_SB.PCI0.XXXX._STA = Zero</span><br></pre></td></tr></table></figure>

<p>不可使用该方法的示例如下。原因是_STA方法中还有其它操作，直接让_STA返回会使这些操作失效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 示例一</span><br><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    ECTP (Zero)</span><br><span class="line">    If (XXXX == One)</span><br><span class="line">    &#123;</span><br><span class="line">        Return (0x0F)</span><br><span class="line">    &#123;</span><br><span class="line">    </span><br><span class="line">    Return (Zero)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 示例二</span><br><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    ^^^GFX0.CLKF = 0x03</span><br><span class="line">    Return (Zero)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="基本框架"><a href="#基本框架" class="headerlink" title="基本框架"></a>基本框架</h5><p>打开MaciASL，新建文件并将本机DSDT中的DefinitionBlock头复制到文件中。然后将里面的DSDT改为SSDT，即可得到适用于本机的SSDT框架。保存时文件名应当以<code>SSDT-</code>开头。</p>
<p>所有SSDT补丁均需满足该基本框架的需求。以下示例的DefinitionBlock头应当根据本机的具体内容替换。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="电池修补"><a href="#电池修补" class="headerlink" title="电池修补"></a>电池修补</h4><p>请基于在修改DSDT后设备能够正常显示电量的前提下制作此热补丁。</p>
<p>电池热补丁的基本原理是，新建一个OperationRegion块，在这个新块里动态注入所有的拆分字节数据，同时对原有的未拆分字节保留空位，从而在保证位移量正确的情况下正确注入并引用新的数据。</p>
<h5 id="确认修改位置"><a href="#确认修改位置" class="headerlink" title="确认修改位置"></a>确认修改位置</h5><p>打开IORegistryExplorer，查找<code>BAT</code>，记录电池设备名称，本机为<code>SB.PCI0.LPCB.EC0.BAT0</code>。对修补DSDT的补丁进行分析，内容如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 字段拆分</span><br><span class="line">into device label EC0 code_regex B0C3,\s+16, replace_matched begin C3HG,8,C3HF,8, end;</span><br><span class="line">into device label EC0 code_regex B0SN,\s+16, replace_matched begin BSVN,8,BSVM,8, end;</span><br><span class="line">into device label EC0 code_regex B1SN,\s+16 replace_matched begin SBUY,8,SBUP,8 end;</span><br><span class="line"></span><br><span class="line">// 替换调用方法</span><br><span class="line">into method label _BIX code_regex \(B0C3, replaceall_matched begin (B1B2(C3HG,C3HF), end;</span><br><span class="line">into method label BIFA code_regex \(B0SN, replaceall_matched begin (B1B2(BSVN,BSVM), end;</span><br><span class="line">into method label BIFA code_regex \(B1SN, replaceall_matched begin (B1B2(SBUY,SBUP), end;</span><br><span class="line"></span><br><span class="line">// 数据处理方法</span><br><span class="line">into method label B1B2 remove_entry;</span><br><span class="line">into definitionblock code_regex . insert</span><br><span class="line">begin</span><br><span class="line">Method (B1B2, 2, NotSerialized)\n</span><br><span class="line">&#123;\n</span><br><span class="line">Return(Or(Arg0, ShiftLeft(Arg1, 8)))\n</span><br><span class="line">&#125;\n</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<p>可以得出，实际修改的字节数据如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">B0C3-&gt;B1B2（C3HG,C3HF）</span><br><span class="line">B0SN-&gt;B1B2（BSVN,BSVM）</span><br><span class="line">B1SN-&gt;B1B2（SBUY,SBUP）</span><br></pre></td></tr></table></figure>

<p>故需要拆解的字节有B0C3、B0SN、B1SN，需要添加的额外方法（Method）为B1B2。比对原DSDT和已修改好的DSDT，查找调用到这些变化过的字段的Method位置，以及需要添加的Method出现位置。本机调用到B0C3、B0SN、B1SN的Method为BIFA和_BIX，需添加的额外方法B1B2在原DSDT中不存在，在修改过的DSDT中位于根目录。至此所有需要修改的地方已完全确定。</p>
<h5 id="数据插入"><a href="#数据插入" class="headerlink" title="数据插入"></a>数据插入</h5><p>打开MaciASL，新建一个SSDT框架，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// xxxx用说找到的电池设备名（此处为BAT0）替换</span><br><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;hack&quot;, &quot;xxxx&quot;, 0x00000000)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打开原DSDT并搜索EmbeddedControl，复制整个OperationRegion到这个热补丁内。注意要把整个OperationRegion复制过来，即从OperationRegion行始，到第一个<code>&#125;</code>止。</p>
<p>然后把调用到变化字段的Method和所有额外添加的Method复制到OperationRegion后。对于本机而言，需复制OperationRegion段、Method (BIFA)、Method (_BIX)、Method (B1B2)，故完成后代码结构应如下所示。注意，在同一个设备下的Method需放到一起。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">OperationRegion (ECOR, EmbeddedControl, Zero, 0xFF)</span><br><span class="line">Field (ECOR, ByteAcc, Lock, Preserve)</span><br><span class="line">&#123;</span><br><span class="line">    Offset (0x04), </span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Method (BIFA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">        ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Method (_BIX, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">        ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Method (B1B2, 2, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    Return (Or (Arg0, ShiftLeft (Arg1, 0x08)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="添加位置代码"><a href="#添加位置代码" class="headerlink" title="添加位置代码"></a>添加位置代码</h5><p>在代码块前需添加它们的位置代码，以使BIOS修补时有迹可循。在代码块的前后分别用以下代码框住即可，注意xxxx为位置，需要用绝对路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Scope (xxxxx)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以本机为例，本机的OperationRegion和BIFA方法均在<code>_SB.PCI0.LPCB.EC0</code>下，而<code>_BIX</code>方法位于<code>_SB.PCI0.LPCB.EC0</code>的BAT0设备下。因此将OperationRegion和BIFA用<code>Scope (_SB.PCI0.LPCB.EC0)</code>框住，而<code>_BIX</code>方法则用<code>Scope (_SB.PCI0.LPCB.EC0.BAT0)</code>框住，如下。注意，B1B2和B1B4方法放置于根目录，故无需位置代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;hack&quot;, &quot;BAT0&quot;, 0x00000000)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    // OperationRegion和BIFA</span><br><span class="line">    Scope (_SB.PCI0.LPCB.EC0)</span><br><span class="line">    &#123;</span><br><span class="line">        OperationRegion (ECOR, EmbeddedControl, Zero, 0xFF)</span><br><span class="line">        Field (ECOR, ByteAcc, Lock, Preserve)</span><br><span class="line">        &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (BIFA, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // _BIX</span><br><span class="line">    Scope (_SB.PCI0.LPCB.EC0.BAT0)</span><br><span class="line">    &#123;</span><br><span class="line">        Method (_BIX, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // B1B2</span><br><span class="line">    Method (B1B2, 2, NotSerialized)</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Or (Arg0, ShiftLeft (Arg1, 0x08)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="添加外部引用"><a href="#添加外部引用" class="headerlink" title="添加外部引用"></a>添加外部引用</h5><p>完成以上步骤后进行编译，并根据相应错误添加外部引用。</p>
<p>首先添加设备引用。以上面代码为例，设备<code>_SB.PCI0.LPCB.EC0</code>与<code>_SB.PCI0.LPCB.EC0.BAT0</code>被引用，故需用以下语句进行声明。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// xxxx是设备地址</span><br><span class="line">External (xxxx, DeviceObj)</span><br></pre></td></tr></table></figure>

<p>该部分语句需添加到DefinitionBlock的下面，故代码如下，其中<code>DeviceObj</code>表示这是一个ACPI设备。再次编译，有关设备的报错均已消失。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;hack&quot;, &quot;BAT0&quot;, 0x00000000)</span><br><span class="line">&#123;</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0, DeviceObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BAT0, DeviceObj)    // 可以不写这行</span><br><span class="line">    Scope (_SB.PCI0.LPCB.EC0)</span><br><span class="line">    &#123;</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure>

<p>然后根据报错，继续在DSDT里搜索其他的报错代码。如对于BIXT，它是BAT0设备下的一个字段，在DSDT查询到的第一个结果是<code>Name (BIXT</code>，因此用以下代码进行外部引用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">External (_SB.PCI0.LPCB.EC0.BAT0.BIXT, IntObj)</span><br></pre></td></tr></table></figure>

<p>对于其余变量方法同理，字段定义与字段对象的对应关系见前面所列出的表格。</p>
<h5 id="字节处理"><a href="#字节处理" class="headerlink" title="字节处理"></a>字节处理</h5><p>首先需要把OperationRegion和Field里的字段重命名。以本机为例，由ECOR重命名为ECAG，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OperationRegion (ECAG, EmbeddedControl, Zero, 0xFF)</span><br><span class="line">Field (ECAG, ByteAcc, Lock, Preserve)</span><br></pre></td></tr></table></figure>

<p>然后要使字段有正确的偏移量，可把Field里所有不拆分的字节数据段名字去掉，只保留空位，如<code>ACST,  1</code>，清空变量名后变为<code>,  1,</code>。示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Offset (0x93),</span><br><span class="line">TH00,   8,</span><br><span class="line">TH01,   8,</span><br><span class="line">TH10,   8,</span><br><span class="line">TH11,   8,</span><br><span class="line">Offset (0xBE),</span><br><span class="line">,   16,</span><br><span class="line">,   16,</span><br><span class="line">,   16,</span><br><span class="line">XC30,   8,</span><br><span class="line">XC31,   8,</span><br></pre></td></tr></table></figure>

<p>或可采用以下注释的形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Offset (0x93),</span><br><span class="line">TH00,   8,</span><br><span class="line">TH01,   8,</span><br><span class="line">TH10,   8,</span><br><span class="line">TH11,   8,</span><br><span class="line">Offset (0xBE),</span><br><span class="line">/*B0TM*/,   16,</span><br><span class="line">/*B0C1*/,   16,</span><br><span class="line">/*B0C2*/,   16,</span><br><span class="line">XC30,   8,</span><br><span class="line">XC31,   8,</span><br></pre></td></tr></table></figure>

<p>或可手动计算偏移量，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Offset (0x93),</span><br><span class="line">TH00,   8,</span><br><span class="line">TH01,   8,</span><br><span class="line">TH10,   8,</span><br><span class="line">TH11,   8,</span><br><span class="line">Offset (0xC4), // 原本为0xBE，加上三个16字节的偏移量后变为0xC4</span><br><span class="line">XC30,   8,</span><br><span class="line">XC31,   8,</span><br></pre></td></tr></table></figure>

<p>修改完成后，将之前的电量补丁Patch使其生效，然后编译并保存。</p>
<h5 id="添加更名补丁"><a href="#添加更名补丁" class="headerlink" title="添加更名补丁"></a>添加更名补丁</h5><p>将热补丁中从原始DSDT复制过来的Method名全部进行修改，如热补丁中有从DSDT复制过来的代码<code>Method (BIFA, 1, NotSerialized)</code>，则BIFA需要更名。此处以更名为BIGA为例，打开config.plist，添加以下更名规则即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Comment: change BIFA(1, N) to BIGA(1, N)</span><br><span class="line">Find: 42494641 01</span><br><span class="line">Replace: 42494741 01</span><br></pre></td></tr></table></figure>

<p>若所需要更改的方法名位于电池设备（即BAT0）内，则在Tgtbridge栏还应加入该电池设备名的16进制数，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Comment: change _BIX(1, N) to XBIX(1, N) in BAT0</span><br><span class="line">Find: 5F424958 01</span><br><span class="line">Replace: 58424958 01</span><br><span class="line">Tgtbridge: 42415430</span><br></pre></td></tr></table></figure>

<p>但如果添加Tgtbridge后电池补丁反而失效，则将Tgtbridge值删除。</p>
<h5 id="添加-OSI判断"><a href="#添加-OSI判断" class="headerlink" title="添加_OSI判断"></a>添加_OSI判断</h5><p>在已经完成的补丁文件中，在每一个Method的开始部分加上_OSI系统判断并在结尾处回调原始方法，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Method (_BIF, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        // 修改过的方法内容</span><br><span class="line">    &#125;</span><br><span class="line">    Else</span><br><span class="line">    &#123;</span><br><span class="line">        Return (XBIF ())  // XBIF为修改后的方法名，即此处为change _BIF to XBIF</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Else后面的代码为回调原始方法，如果原始方法没有出现Return语句，则可直接以XBIF()的方式回调。如果原始方法的代码中出现了Return语句，则在回调时也需要以Return形式回调原方法，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Method (SMTF, 1, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        If ((Arg0 == Zero))</span><br><span class="line">        &#123;</span><br><span class="line">            Return (B1B2 (B0ET, B1ET))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        If ((Arg0 == One))</span><br><span class="line">        &#123;</span><br><span class="line">            Return (Zero)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line">    Else</span><br><span class="line">    &#123;</span><br><span class="line">        Return (XMTF (Arg0))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="完成修补"><a href="#完成修补" class="headerlink" title="完成修补"></a>完成修补</h5><p>将上述SSDT保存为aml文件，放到引导器的ACPI部分即可。</p>
<h5 id="特殊处理"><a href="#特殊处理" class="headerlink" title="特殊处理"></a>特殊处理</h5><h6 id="惠普笔记本ACEL设备禁止"><a href="#惠普笔记本ACEL设备禁止" class="headerlink" title="惠普笔记本ACEL设备禁止"></a>惠普笔记本ACEL设备禁止</h6><p>部分惠普笔记本配备机械硬盘防护传感器。该设备实际为一个加速度传感器，即便没有驱动也能保持运行，持续向EC中读写数据，会导致电池状态刷新异常。</p>
<p>在Windows下确认该设备ACPI名称为ACEL后，可通过ACPI更名其_STA，并在热补丁中要求macOS下禁止该设备即可。</p>
<h6 id="ECRD和ECWT读写控制"><a href="#ECRD和ECWT读写控制" class="headerlink" title="ECRD和ECWT读写控制"></a>ECRD和ECWT读写控制</h6><p>部分机器的ACPI对于EC作用域下的寄存器读写有严格控制，有时需要修改其中的代码以解除限制。暂时无相关解决方案。</p>
<h6 id="双电池系统"><a href="#双电池系统" class="headerlink" title="双电池系统"></a>双电池系统</h6><p>对于单块物理电池，禁用另一个电池设备即可，一般为BAT1。SSDT示例如下，其中BAT1路径根据实际替换。</p>
<p>在OpenCore中，加载顺序为主补丁-禁用BAT1补丁。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// battery for WTX30,WTX40,X260,X1C2014,X1C2016</span><br><span class="line">//</span><br><span class="line">// In config ACPI, _STA to XSTA</span><br><span class="line">// Count:          1</span><br><span class="line">// Find:           5F 53 54 41</span><br><span class="line">// Replace:        58 53 54 41</span><br><span class="line">// Skip:           12</span><br><span class="line">// TableSignature: 44 53 44 54</span><br><span class="line">//</span><br><span class="line">// battery for WTX50,WTX60,X1C2015</span><br><span class="line">//</span><br><span class="line">// In config ACPI, _STA to XSTA</span><br><span class="line">// Count:          1</span><br><span class="line">// Find:           5F 53 54 41</span><br><span class="line">// Replace:        58 53 54 41</span><br><span class="line">// Skip:           11</span><br><span class="line">// TableSignature: 44 53 44 54</span><br><span class="line">//</span><br><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;OCLT&quot;, &quot;BAT1-off&quot;, 0)</span><br><span class="line">&#123;</span><br><span class="line">    External(_SB.PCI0.LPC.EC.BAT1, DeviceObj)</span><br><span class="line">    External(_SB.PCI0.LPC.EC.BAT1.XSTA, MethodObj)</span><br><span class="line">    </span><br><span class="line">    Scope(\_SB.PCI0.LPC.EC.BAT1)</span><br><span class="line">    &#123;</span><br><span class="line">        Method(_STA)</span><br><span class="line">        &#123;</span><br><span class="line">            If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (0)</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Return (\_SB.PCI0.LPC.EC.BAT1.XSTA ())</span><br><span class="line">            &#125;   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// EOF</span><br></pre></td></tr></table></figure>

<p>对于两块物理电池，更改两块电池设备的ACPI _HID名称使其保持运行的情况下不被电池驱动识别，同时新建一个BATC设备用于合并计算两块电池的信息和状态，代替原来两块电池设备的代码为驱动提供信息。</p>
<p>分别使用SSDT-Notify-LPC和SSDT-OCBATC-TP-LPC进行实现，链接如下。注意根据DSDT的相关内容修改补丁，如3代机器的_Q4C的内容和样本内容不同，4&#x2F;5&#x2F;6&#x2F;7代机器无_Q4C，7代+机器有BFCC等。</p>
<p>在OpenCore中，加载顺序为主补丁-BATC设备补丁-Notify补丁。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># SSDT-Notify-LPC</span><br><span class="line">https://github.com/daliansky/OC-little/blob/master/08-%E7%94%B5%E6%B1%A0%E8%A1%A5%E4%B8%81/08-1-Thinkpad/%E5%90%84%E6%9C%BA%E5%9E%8B%E7%94%B5%E6%B1%A0%E8%A1%A5%E4%B8%81/SSDT-Notify-LPC.dsl</span><br><span class="line"></span><br><span class="line"># SSDT-OCBATC-TP-LPC</span><br><span class="line">https://github.com/daliansky/OC-little/blob/master/08-%E7%94%B5%E6%B1%A0%E8%A1%A5%E4%B8%81/08-1-Thinkpad/%E5%90%84%E6%9C%BA%E5%9E%8B%E7%94%B5%E6%B1%A0%E8%A1%A5%E4%B8%81/SSDT-OCBATC-TP-LPC.dsl</span><br></pre></td></tr></table></figure>

<h4 id="I2C触控板修补"><a href="#I2C触控板修补" class="headerlink" title="I2C触控板修补"></a>I2C触控板修补</h4><p>该SSDT不涉及任何的ACPI更名。</p>
<h5 id="修补准备"><a href="#修补准备" class="headerlink" title="修补准备"></a>修补准备</h5><p>按照与修改DSDT时相同的方法，确定设备路径和APIC Pin，并放置VoodooI2C驱动。</p>
<h5 id="禁用原设备"><a href="#禁用原设备" class="headerlink" title="禁用原设备"></a>禁用原设备</h5><h6 id="通过预置变量法"><a href="#通过预置变量法" class="headerlink" title="通过预置变量法"></a>通过预置变量法</h6><p>本方法在本机上通过Clover引导时可行，通过OpenCore引导时不起作用。</p>
<p>用Macisal打开本机DSDT，查找触控板设备名称，此处为ETPD。观察其_STA方法，该方法用于控制设备的开启与关闭，返回0x0F时为开启，返回Zero时为关闭。示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Method (_STA, 0, NotSerialized)  // _STA: Status</span><br><span class="line">&#123;</span><br><span class="line">    If (((TPIF != One) || (DSYN &amp;&amp; One)))</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Return (0x0F)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过简单的代码知识，可知若TPIF不等于1或DSYN不等于0，则会返回Zero，从而禁用该设备。</p>
<p>在DSDT中搜索TPIF，发现该变量仅在此处被引用。同理搜索DSYN，发现该变量有在其它地方被引用。因此选择改变TPIF而非DSYN的值，以避免对其它设备的影响。此处将TPIF设为0即可。</p>
<p>在DSDT中搜索TPIF，其定义示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Scope (_SB)</span><br><span class="line">&#123;</span><br><span class="line">    OperationRegion (ASIO, SystemMemory, ASIB, 0x09)</span><br><span class="line">    Field (ASIO, AnyAcc, NoLock, Preserve)</span><br><span class="line">    &#123;</span><br><span class="line">        ASIS,   32, </span><br><span class="line">        TPIF,   8, </span><br><span class="line">        TPDI,   8, </span><br><span class="line">        TPLP,   8, </span><br><span class="line">        TPLI,   8, </span><br><span class="line">        TPHI,   8</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见TPIF是一个FieldUnitObj，因此可得如下补丁示例。由于TPIF在<code>Scope (_SB)</code>内，而_SB即为根目录，因此补丁中可用<code>\</code>表示。</p>
<p>注意，上述过程仅为示例，用于阐述预置变量法的基本流程。具体的变量类型和数值设置需要根据不同的DSDT做出相应的调整。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    External (TPIF, FieldUnitObj)</span><br><span class="line">    </span><br><span class="line">    Scope (\)</span><br><span class="line">    &#123;</span><br><span class="line">        If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            TPIF = Zero</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="通过-STA修改法"><a href="#通过-STA修改法" class="headerlink" title="通过_STA修改法"></a>通过_STA修改法</h6><p>新建一个SSDT框架，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在其中添加Scope作用域，路径为原触控板设备的路径，此处为ETPD。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    Scope (_SB.PCI0.I2C1.ETPD)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把以下_STA方法复制到Scope作用域中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line">    Else</span><br><span class="line">    &#123;</span><br><span class="line">        Return (XSTA())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据添加外部引用的相关办法，添加对ETPD和XSTA的相关引用。其中XSTA为ETPD的原_STA方法，后面会通过更名的方式将其改为XSTA，因此上述注入的新_STA方法意为在系统不为Mac时，调用XSTA即原_STA方法。</p>
<p>完整补丁如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;DELL&quot;, &quot;CBX3&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    External (_SB.PCI0.I2C0.ETPD,DeviceObj)</span><br><span class="line">    External (_SB.PCI0.I2C0.ETPD.XSTA,MethodObj)</span><br><span class="line">  </span><br><span class="line">    Scope (_SB.PCI0.I2C0.TPD0)</span><br><span class="line">    &#123;</span><br><span class="line">        Method (_STA, 0, NotSerialized)  // _STA: Status</span><br><span class="line">        &#123;</span><br><span class="line">            If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (Zero)</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Return (XSTA())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在config.plist中添加以下重命名补丁，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Comment：change _STA(0,N) to XSTA(0,N)</span><br><span class="line">Find：5F535441 00A01390 929354</span><br><span class="line">Replace：58535441 00A01390 929354</span><br></pre></td></tr></table></figure>

<h5 id="启用GPIO"><a href="#启用GPIO" class="headerlink" title="启用GPIO"></a>启用GPIO</h5><p>DSDT搜索<code>Device (GPI0</code>，观察其_STA方法，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If ((SBRG == Zero))</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    If ((GPEN == Zero))</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Return (0x0F)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样使用预置变量法。观察以上代码，可知启用GPI0需要SBRG和GPEN都不等于0。搜索SBRG，发现该变量被多处引用。同理搜索GPEN，发现该变量仅本处被引用。考虑到SBRG可能本来就不为0，因此尝试只设定GPEN。</p>
<p>在DSDT中搜索SBRG和GPEN，其定义示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 这里就是根目录，没有Scope()</span><br><span class="line"></span><br><span class="line">    OperationRegion (PNVA, SystemMemory, PNVB, PNVL)</span><br><span class="line">    Field (PNVA, AnyAcc, Lock, Preserve)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">        SBRG,   32, </span><br><span class="line">        ...</span><br><span class="line">        GPEN,   8, </span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可见GPEN是一个FieldUnitObj，因此可得如下补丁示例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// GPI0 enable</span><br><span class="line">DefinitionBlock(&quot;&quot;, &quot;SSDT&quot;, 2, &quot;OCLT&quot;, &quot;GPI0&quot;, 0)</span><br><span class="line">&#123;</span><br><span class="line">    External(GPEN, FieldUnitObj)</span><br><span class="line">    </span><br><span class="line">    Scope (\)</span><br><span class="line">    &#123;</span><br><span class="line">        If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            GPEN = 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//EOF</span><br></pre></td></tr></table></figure>

<h5 id="新建热补丁"><a href="#新建热补丁" class="headerlink" title="新建热补丁"></a>新建热补丁</h5><p>新建一个SSDT框架，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用MaciASL打开系统的DSDT，搜索触控板名称，本机为ETPD，路径为_SB.PCI0.I2C1.ETPD。在新建的SSDT中，首先添加Scope域，注意小括号内为除触控板名称外的路径。然后将触控板名称对应的整个Device复制进去，此处为<code>Device (ETPD)</code>。完成后形式如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    Scope (_SB.PCI0.I2C1)</span><br><span class="line">    &#123;</span><br><span class="line">        Device (ETPD)</span><br><span class="line">        &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处也可以写成如下形式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    Device (_SB.PCI0.I2C1.ETPD)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将该SSDT中的ETPD进行改名，此处改为TPXX，该名称应当在DSDT中未出现过。然后替换<code>_STA</code>部分为以下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Method (_STA, 0, NotSerialized)</span><br><span class="line">&#123;</span><br><span class="line">    If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        Return (0x0F)</span><br><span class="line">    &#125;</span><br><span class="line">    Else</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Zero)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在禁用原设备中，若使用的是预置变量法，则在该SSDT中搜索上述用到的变量，此处为TPIF。若有类似<code>If(TPIF...)</code>的语句，则修改为<code>If(one)</code>。</p>
<p>在该SSDT中搜索OSYS。若有，则注释以下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">If (LLess (OSYS, 0x07DC))</span><br><span class="line">&#123;</span><br><span class="line">    SRXO (GPDI, One)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="移除APIC中断控制器"><a href="#移除APIC中断控制器" class="headerlink" title="移除APIC中断控制器"></a>移除APIC中断控制器</h5><p>在该SSDT中搜索_CRS方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Method (_CRS, 0, Serialized)</span><br><span class="line">&#123;</span><br><span class="line">    Name (SBFI, ResourceTemplate ()</span><br><span class="line">    &#123;</span><br><span class="line">        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,</span><br><span class="line">            AddressingMode7Bit, &quot;\\_SB.PCI0.I2C1&quot;,</span><br><span class="line">            0x00, ResourceConsumer, , Exclusive,</span><br><span class="line">            )</span><br><span class="line">        Interrupt (ResourceConsumer, Level, ActiveLow, Exclusive, ,, )</span><br><span class="line">        &#123;</span><br><span class="line">            0x0000006D,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    Return (SBFI)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若代码类似如上，则将<code>Name (SBFI</code>改为<code>Name (SBFB</code>，并删除整个Interrupt()函数，修改后变为如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Method (_CRS, 0, Serialized)</span><br><span class="line">&#123;</span><br><span class="line">    Name (SBFB, ResourceTemplate ()</span><br><span class="line">    &#123;</span><br><span class="line">        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,</span><br><span class="line">            AddressingMode7Bit, &quot;\\_SB.PCI0.I2C1&quot;,</span><br><span class="line">            0x00, ResourceConsumer, , Exclusive,</span><br><span class="line">            )</span><br><span class="line">    &#125;)</span><br><span class="line">    Return (SBFI)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在该SSDT中定位到_CRS方法，确保所有返回语句都改成以下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 若该SSDT中没有I2CM，选择该语句</span><br><span class="line">Return (ConcatenateResTemplate (SBFB, SBFG))</span><br><span class="line"></span><br><span class="line">// 若该SSDT中有I2CM，选择该语句</span><br><span class="line">Return (ConcatenateResTemplate (I2CM (I2CX, BADR, SPED), SBFG))</span><br></pre></td></tr></table></figure>

<p>示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Method (_CRS, 0, Serialized)</span><br><span class="line">&#123;</span><br><span class="line">    Name (SBFB, ResourceTemplate ()</span><br><span class="line">    &#123;</span><br><span class="line">        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,</span><br><span class="line">            AddressingMode7Bit, &quot;\\_SB.PCI0.I2C1&quot;,</span><br><span class="line">            0x00, ResourceConsumer, , Exclusive,</span><br><span class="line">            )</span><br><span class="line">    &#125;)</span><br><span class="line">    Return (ConcatenateResTemplate (SBFB, SBFG))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h5 id="GPIO固定"><a href="#GPIO固定" class="headerlink" title="GPIO固定"></a>GPIO固定</h5><h6 id="代码修补"><a href="#代码修补" class="headerlink" title="代码修补"></a>代码修补</h6><p>在该SSDT中寻找类似如下的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name (SBFG, ResourceTemplate ()</span><br><span class="line">&#123;</span><br><span class="line">    GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,</span><br><span class="line">        &quot;\\_SB.PCI0.GPI0&quot;, 0x00, ResourceConsumer, ,</span><br><span class="line">        )</span><br><span class="line">        &#123;   // Pin list</span><br><span class="line">            0x0000</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>若有该代码，则系统会自动注入GPIO Pin，可跳过GPIO Pin的计算与填入。若没有，则需要将该段代码复制到TPXX的根目录，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Device (TPXX)&#123;</span><br><span class="line">    Name (SBFG, ResourceTemplate ()</span><br><span class="line">    &#123;</span><br><span class="line">        GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,</span><br><span class="line">        &quot;\\_SB.PCI0.GPI0&quot;, 0x00, ResourceConsumer, ,</span><br><span class="line">        )</span><br><span class="line">        &#123;   // Pin list</span><br><span class="line">            0x0000</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="计算GPIO-Pin"><a href="#计算GPIO-Pin" class="headerlink" title="计算GPIO Pin"></a>计算GPIO Pin</h6><p>将上面得到的APIC Pin化为十进制，此处为6D，化成十进制为109。带入以下公式计算，计算完成后将答案重新化为十六进制，所得即为GPIO Pin的值。</p>
<p>对于Skylake平台，本机适用，所得为85&#x3D;0x55。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">If APICPIN &gt; 47 And APICPIN &lt;= 79 Then     </span><br><span class="line">    GPIOPIN = APICPIN - 24   </span><br><span class="line">    GPIOPIN2 = APICPIN + 72  </span><br><span class="line">ElseIf APICPIN &gt; 79 And APICPIN &lt;= 119 Then</span><br><span class="line">    GPIOPIN = APICPIN - 24</span><br><span class="line">End If</span><br></pre></td></tr></table></figure>

<p>对于CoffeeLake-H平台如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">If APICPIN &gt; 47 And APICPIN &lt;= 71 Then   </span><br><span class="line">    GPIOPIN = APICPIN - 16   </span><br><span class="line">    GPIOPIN2 = APICPIN + 240 </span><br><span class="line">    If APICPIN &gt; 47 And APICPIN &lt;= 59 Then GPIOPIN3 = APICPIN + 304  </span><br><span class="line">ElseIf APICPIN &gt; 71 And APICPIN &lt;= 95 Then </span><br><span class="line">    GPIOPIN = APICPIN - 8    </span><br><span class="line">    GPIOPIN3 = APICPIN + 152</span><br><span class="line">    GPIOPIN2 = APICPIN + 120 </span><br><span class="line">ElseIf APICPIN &gt; 95 And APICPIN &lt;= 119 Then </span><br><span class="line">    GPIOPIN = APICPIN        </span><br><span class="line">    If APICPIN &gt; 108 And APICPIN &lt;= 115 Then GPIOPIN2 = APICPIN + 20 </span><br><span class="line"> End If</span><br></pre></td></tr></table></figure>

<p>对于CoffeeLake-LF&#x2F;Whiskylake平台如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">If APICPIN &gt; 47 And APICPIN &lt;= 71 Then      </span><br><span class="line">    GPIOPIN = APICPIN - 16   </span><br><span class="line">    GPIOPIN2 = APICPIN + 80  </span><br><span class="line">ElseIf APICPIN &gt; 71 And APICPIN &lt;= 95 Then  </span><br><span class="line">    GPIOPIN2 = APICPIN + 184 </span><br><span class="line">    GPIOPIN = APICPIN + 88   </span><br><span class="line">ElseIf APICPIN &gt; 95 And APICPIN &lt;= 119 Then </span><br><span class="line">    GPIOPIN = APICPIN        </span><br><span class="line">    If APICPIN &gt; 108 And APICPIN &lt;= 115 Then GPIOPIN2 = APICPIN - 44 </span><br><span class="line">End If</span><br></pre></td></tr></table></figure>

<details>
<summary>【进阶】其它方法</summary>

<p>打开Hackintool，在PCI选项卡下可以查看触控板类型，包括SunrisePoint、CannonPoint(Lake)[Coffee Lake(-R)]和CannonPoint(Lake)[Whiskylake]。</p>
<p>打开下面相应平台的第一个链接，查找设备的十六进制APIC Pin值，并记录左侧标签值（只需记录GPP_XYY_IRQ中的XYY部分），若有多个标签值，需全部记录。再打开第二个链接，搜索上面所记录的XYY，记下右侧的数值（十进制），此即为触控板的硬件引脚号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// SunrisePoint[Kaby Lake(-R)]</span><br><span class="line">https://github.com/coreboot/coreboot/blob/master/src/soc/intel/skylake/include/soc/gpio_defs.h#L43</span><br><span class="line">https://github.com/coreboot/coreboot/blob/master/src/soc/intel/skylake/include/soc/gpio_soc_defs.h#L37</span><br><span class="line"></span><br><span class="line">// CannonPoint(Lake)[Coffee Lake-R]</span><br><span class="line">https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_defs_cnp_h.h#L42</span><br><span class="line">https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_soc_defs_cnp_h.h#L40</span><br><span class="line"></span><br><span class="line">// CannonPoint(Lake)[Whiskylake]</span><br><span class="line">https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_defs.h#L42</span><br><span class="line">https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_soc_defs.h#L45</span><br></pre></td></tr></table></figure>

<p>对于SunrisePoint，硬件引脚号即为GPIO引脚号。</p>
<p>对于CannonPoint(Lake)[Coffee Lake(-R)]或CannonPoint(Lake)[Whiskylake]，前面步骤与上面相同，但得到的硬件引脚号并不是GPIO引脚号，因此还需要进行转换。打开下面转换公式链接，搜索前面记录的GPP_X，得到格式如<code>CHIPSET_GPP(数字, 基数, 终止, GPIO基数)</code>的内容。用所记下的十进制硬件引脚号减去<code>基数</code>，再加上<code>GPIO基数</code>，就是最后的十进制的GPIO引脚号。注意，<code>X_NO_GPIO</code>表示此引脚号无效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// CannonPoint(Lake)[Coffee Lake-R]</span><br><span class="line">https://github.com/coolstar/VoodooGPIO/blob/master/VoodooGPIO/CannonLake-LP/VoodooGPIOCannonLakeLP.hpp#L366</span><br><span class="line"></span><br><span class="line">// CannonPoint(Lake)[Whiskylake]</span><br><span class="line">https://github.com/coolstar/VoodooGPIO/blob/master/VoodooGPIO/CannonLake-H/VoodooGPIOCannonLakeH.hpp#L414</span><br></pre></td></tr></table></figure>

<p>得到十进制的GPIO引脚后，需将数字转换为十六进制。</p>
</details>

<h6 id="填入GPIO-Pin"><a href="#填入GPIO-Pin" class="headerlink" title="填入GPIO Pin"></a>填入GPIO Pin</h6><p>在某些极端状况下，只能尝试比较常见的GPIO Pin。如SunrisePoint平台可尝试0x17、0x1b、0x34和0x55。</p>
<p>计算完成后把GPIO Pin填入到SBFG的Pin list，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name (SBFG, ResourceTemplate ()</span><br><span class="line">&#123;</span><br><span class="line">    GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,</span><br><span class="line">        &quot;\\_SB.PCI0.GPI0&quot;, 0x00, ResourceConsumer, ,</span><br><span class="line">        )</span><br><span class="line">        &#123;   // Pin list</span><br><span class="line">            0x55</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="添加外部引用-1"><a href="#添加外部引用-1" class="headerlink" title="添加外部引用"></a>添加外部引用</h5><p>点击编译并根据报错添加外部引用，过程可参照电池修补部分。</p>
<h5 id="完成修补-1"><a href="#完成修补-1" class="headerlink" title="完成修补"></a>完成修补</h5><p>至此触控板热补丁已完成，将上述生成的所有SSDT都另存为aml，放到引导器的ACPI部分。重启后打开IORegistryExplorer，查找触控板名称（ETPD），若无此设备则禁用成功。查找新建的触控板设备（TPXX），若有此设备则触控板已处于中断模式。</p>
<h2 id="ACPIDebug"><a href="#ACPIDebug" class="headerlink" title="ACPIDebug"></a>ACPIDebug</h2><p>ACPIDebug可用于高级人员排错，也可记录部分按键轨迹。</p>
<h3 id="驱动"><a href="#驱动" class="headerlink" title="驱动"></a>驱动</h3><p>ACPIDebug.kext下载链接如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://bitbucket.org/RehabMan/os-x-acpi-debug/downloads/</span><br></pre></td></tr></table></figure>

<p>下载后放入SLE中，用Kext Utility修复权限。</p>
<p>然后需要对DSDT进行修改。用MaciASL打开DSDT，点击Patch，在<code>_OS-X-ACPI-Debug</code>类别下打<code>Add DSDT Debug Methods</code>和<code>Instrument EC Queries</code>这两个补丁，退出并保存即可。</p>
<p>也可通过SSDT实现。放置以下SSDT即可。</p>
<p>SSDT-RMDT.aml如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">// for use with ACPIDebug</span><br><span class="line">// This file was created by applying &quot;Add DSDT Debug Methods&quot; to an empty SSDT</span><br><span class="line">//</span><br><span class="line">// Use &quot;Add SSDT Debug Extern Declarations&quot; to access these methods from other</span><br><span class="line">// hotpatch SSDTs or even patched OEM ACPI files.</span><br><span class="line">//</span><br><span class="line">DefinitionBlock(&quot;&quot;, &quot;SSDT&quot;, 2, &quot;OCLT&quot;, &quot;RMDT&quot;, 0)</span><br><span class="line">&#123;</span><br><span class="line">    If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        Device (RMDT)</span><br><span class="line">        &#123;</span><br><span class="line">            Name (_HID, &quot;RMD0000&quot;)  // _HID: Hardware ID</span><br><span class="line">            Name (RING, Package (0x0100)&#123;&#125;)</span><br><span class="line">            Mutex (RTMX, 0x00)</span><br><span class="line">            Name (HEAD, Zero)</span><br><span class="line">            Name (TAIL, Zero)</span><br><span class="line">            Method (PUSH, 1, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Acquire (RTMX, 0xFFFF)</span><br><span class="line">                Local0 = (HEAD + One)</span><br><span class="line">                If ((Local0 &gt;= SizeOf (RING)))</span><br><span class="line">                &#123;</span><br><span class="line">                    Local0 = Zero</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                If ((Local0 != TAIL))</span><br><span class="line">                &#123;</span><br><span class="line">                    RING [HEAD] = Arg0</span><br><span class="line">                    HEAD = Local0</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Release (RTMX)</span><br><span class="line">                Notify (RMDT, 0x80) // Status Change</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (FTCH, 0, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Acquire (RTMX, 0xFFFF)</span><br><span class="line">                Local0 = Zero</span><br><span class="line">                If ((HEAD != TAIL))</span><br><span class="line">                &#123;</span><br><span class="line">                    Local0 = DerefOf (RING [TAIL])</span><br><span class="line">                    TAIL++</span><br><span class="line">                    If ((TAIL &gt;= SizeOf (RING)))</span><br><span class="line">                    &#123;</span><br><span class="line">                        TAIL = Zero</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Release (RTMX)</span><br><span class="line">                Return (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (COUN, 0, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Acquire (RTMX, 0xFFFF)</span><br><span class="line">                Local0 = (HEAD - TAIL) /* \RMDT.TAIL */</span><br><span class="line">                If ((Local0 &lt; Zero))</span><br><span class="line">                &#123;</span><br><span class="line">                    Local0 += SizeOf (RING)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Release (RTMX)</span><br><span class="line">                Return (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P1, 1, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                PUSH (Arg0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P2, 2, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Local0 = Package (0x02)&#123;&#125;</span><br><span class="line">                Local0 [Zero] = Arg0</span><br><span class="line">                Local0 [One] = Arg1</span><br><span class="line">                PUSH (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P3, 3, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Local0 = Package (0x03)&#123;&#125;</span><br><span class="line">                Local0 [Zero] = Arg0</span><br><span class="line">                Local0 [One] = Arg1</span><br><span class="line">                Local0 [0x02] = Arg2</span><br><span class="line">                PUSH (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P4, 4, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Local0 = Package (0x04)&#123;&#125;</span><br><span class="line">                Local0 [Zero] = Arg0</span><br><span class="line">                Local0 [One] = Arg1</span><br><span class="line">                Local0 [0x02] = Arg2</span><br><span class="line">                Local0 [0x03] = Arg3</span><br><span class="line">                PUSH (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P5, 5, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Local0 = Package (0x05)&#123;&#125;</span><br><span class="line">                Local0 [Zero] = Arg0</span><br><span class="line">                Local0 [One] = Arg1</span><br><span class="line">                Local0 [0x02] = Arg2</span><br><span class="line">                Local0 [0x03] = Arg3</span><br><span class="line">                Local0 [0x04] = Arg4</span><br><span class="line">                PUSH (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P6, 6, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Local0 = Package (0x06)&#123;&#125;</span><br><span class="line">                Local0 [Zero] = Arg0</span><br><span class="line">                Local0 [One] = Arg1</span><br><span class="line">                Local0 [0x02] = Arg2</span><br><span class="line">                Local0 [0x03] = Arg3</span><br><span class="line">                Local0 [0x04] = Arg4</span><br><span class="line">                Local0 [0x05] = Arg5</span><br><span class="line">                PUSH (Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (P7, 7, NotSerialized)</span><br><span class="line">            &#123;</span><br><span class="line">                Local0 = Package (0x07)&#123;&#125;</span><br><span class="line">                Local0 [Zero] = Arg0</span><br><span class="line">                Local0 [One] = Arg1</span><br><span class="line">                Local0 [0x02] = Arg2</span><br><span class="line">                Local0 [0x03] = Arg3</span><br><span class="line">                Local0 [0x04] = Arg4</span><br><span class="line">                Local0 [0x05] = Arg5</span><br><span class="line">                Local0 [0x06] = Arg6</span><br><span class="line">                PUSH (Local0)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//EOF</span><br></pre></td></tr></table></figure>

<p>SSDT-TEST.aml，以Dell为例。注意需要重命名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// In config ACPI, NEVT to XEVT</span><br><span class="line">// Find:     4E 45 56 54 00</span><br><span class="line">// Replace:  58 45 56 54 00</span><br><span class="line">//</span><br><span class="line">DefinitionBlock(&quot;&quot;, &quot;SSDT&quot;, 2, &quot;ACDT&quot;, &quot;TEST&quot;, 0)</span><br><span class="line">&#123;</span><br><span class="line">    External(XEVT, MethodObj)</span><br><span class="line">    External(RMDT.P1, MethodObj)</span><br><span class="line">    </span><br><span class="line">    Method (NEVT, 0, NotSerialized)</span><br><span class="line">    &#123;</span><br><span class="line">        If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            \RMDT.P1(&quot;AAA001&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        \XEVT()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//EOF</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>重启后在Launchpad找到控制台，在搜索框输入ACPIDebug，然后按下键盘Fn+F5&#x2F;F6。若控制台中出现信息，则ACPIDebug驱动成功。</p>
<h1 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h1><h2 id="华硕笔记本键盘修复"><a href="#华硕笔记本键盘修复" class="headerlink" title="华硕笔记本键盘修复"></a>华硕笔记本键盘修复</h2><h3 id="按键驱动"><a href="#按键驱动" class="headerlink" title="按键驱动"></a>按键驱动</h3><p>利用AsusSMC.kext，可修复华硕笔记本键盘与Fn有关的快捷键不工作的问题。需要Lilu和VirtualSMC，下载链接如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/hieplpvip/AsusSMC</span><br></pre></td></tr></table></figure>

<p>将下载好的kext放到Clover的kexts文件夹中，若键盘有睡眠和飞行模式按键则还需运行install_daemon.sh，然后重启。逐个测试按键是否工作，若不工作，可通过SSDT或DSDT进行修补。</p>
<h3 id="按键修复"><a href="#按键修复" class="headerlink" title="按键修复"></a>按键修复</h3><h4 id="通过DSDT"><a href="#通过DSDT" class="headerlink" title="通过DSDT"></a>通过DSDT</h4><p>用MaciASL打开DSDT。添加以下源，然后点击Patch打相应补丁即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://raw.github.com/hieplpvip/AsusSMC/master</span><br></pre></td></tr></table></figure>

<h4 id="通过SSDT"><a href="#通过SSDT" class="headerlink" title="通过SSDT"></a>通过SSDT</h4><p>选取以下所需代码复制到MaciASL中，创建一个SSDT并保存为SSDT-ASUS.aml，放入引导器的ACPI部分，并按照注释在config.plist中添加更名补丁即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;hack&quot;, &quot;EC&quot;, 0x00000000)</span><br><span class="line">&#123;</span><br><span class="line">    External (_SB.ATKD.IANE, MethodObj)</span><br><span class="line">    External (_SB.ATKP, IntObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC, DeviceObj)</span><br><span class="line"></span><br><span class="line">    Scope (_SB.PCI0.LPCB.EC)</span><br><span class="line">    &#123;</span><br><span class="line">        // F1</span><br><span class="line">        // change _Q0A to XQ0A</span><br><span class="line">        // Find: 5F513041</span><br><span class="line">        // Replace: 58513041</span><br><span class="line">        Method (_Q0A, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x5E)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        // F2</span><br><span class="line">        // change _Q0B to XQ0B</span><br><span class="line">        // Find: 5F513042</span><br><span class="line">        // Replace: 58513042</span><br><span class="line">        Method (_Q0B, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x7D)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F3</span><br><span class="line">        // change _Q0C to XQ0C</span><br><span class="line">        // Find: 5F513043</span><br><span class="line">        // Replace: 58513043</span><br><span class="line">        Method (_Q0C, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0xC5)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F4</span><br><span class="line">        // change _Q0D to XQ0D</span><br><span class="line">        // Find: 5F513044</span><br><span class="line">        // Replace: 58513044</span><br><span class="line">        Method (_Q0D, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0xC4)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // F5</span><br><span class="line">        // change _Q0E to XQ0E</span><br><span class="line">        // Find: 5F513045</span><br><span class="line">        // Replace: 58513045</span><br><span class="line">        Method (_Q0E, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x20)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // F6</span><br><span class="line">        // change _Q0F to XQ0F</span><br><span class="line">        // Find: 5F513046</span><br><span class="line">        // Replace: 58513046</span><br><span class="line">        Method (_Q0F, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x10)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F7</span><br><span class="line">        // change _Q10 to XQ10</span><br><span class="line">        // Find: 5F513130</span><br><span class="line">        // Replace: 58513130</span><br><span class="line">        Method (_Q10, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x35)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F8</span><br><span class="line">        // change _Q10 to XQ10</span><br><span class="line">        // Find: 5F513131</span><br><span class="line">        // Replace: 58513131</span><br><span class="line">        Method (_Q11, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x61)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F9</span><br><span class="line">        // change _Q12 to XQ12</span><br><span class="line">        // Find: 5F513132</span><br><span class="line">        // Replace: 58513132</span><br><span class="line">        Method (_Q12, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x6B)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F10</span><br><span class="line">        // change _Q13 to XQ13</span><br><span class="line">        // Find: 5F513133</span><br><span class="line">        // Replace: 58513133</span><br><span class="line">        Method (_Q13, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x32)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F11</span><br><span class="line">        // change _Q14 to XQ14</span><br><span class="line">        // Find: 5F513134</span><br><span class="line">        // Replace: 58513134</span><br><span class="line">        Method (_Q14, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x31)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // F12</span><br><span class="line">        // change _Q15 to XQ15</span><br><span class="line">        // Find: 5F513135</span><br><span class="line">        // Replace: 58513135</span><br><span class="line">        Method (_Q15, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x30)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // media left arrow key</span><br><span class="line">        // change _Q6C to XQ6C</span><br><span class="line">        // Find: 5F513643</span><br><span class="line">        // Replace: 58513643</span><br><span class="line">        Method (_Q6C, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x40)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // media right arrow key</span><br><span class="line">        // change _Q6D to XQ6D</span><br><span class="line">        // Find: 5F513644</span><br><span class="line">        // Replace: 58513644</span><br><span class="line">        Method (_Q6D, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x41)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // media up arrow key</span><br><span class="line">        // change _Q6E to XQ6E</span><br><span class="line">        // Find: 5F513645</span><br><span class="line">        // Replace: 58513645</span><br><span class="line">        Method (_Q6E, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x43)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // media down arrow key</span><br><span class="line">        // change _Q6F to XQ6F</span><br><span class="line">        // Find: 5F513646</span><br><span class="line">        // Replace: 58513646</span><br><span class="line">        Method (_Q6F, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x45)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // space key</span><br><span class="line">        // change _Q71 to XQ71</span><br><span class="line">        // Find: 5F513731</span><br><span class="line">        // Replace: 58513731</span><br><span class="line">        Method (_Q71, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x5C)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // V key</span><br><span class="line">        // change _Q72 to XQ72</span><br><span class="line">        // Find: 5F513732</span><br><span class="line">        // Replace: 58513732</span><br><span class="line">        Method (_Q72, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x8A)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // C key</span><br><span class="line">        // change _Q73 to XQ73</span><br><span class="line">        // Find: 5F513733</span><br><span class="line">        // Replace: 58513733</span><br><span class="line">        Method (_Q73, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x82)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // ALS toggle A key</span><br><span class="line">        // change _Q6F to XQ6F</span><br><span class="line">        // Find: 5F513646</span><br><span class="line">        // Replace: 58513646</span><br><span class="line">        Method (_Q6F, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (^^^^ATKP)</span><br><span class="line">            &#123;</span><br><span class="line">                ^^^^ATKD.IANE (0x7A)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="亮度快捷键调整"><a href="#亮度快捷键调整" class="headerlink" title="亮度快捷键调整"></a>亮度快捷键调整</h2><p>通过BrightnessKeys.kext即可，链接如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/acidanthera/BrightnessKeys</span><br></pre></td></tr></table></figure>

<h2 id="CPU显示未知修复"><a href="#CPU显示未知修复" class="headerlink" title="CPU显示未知修复"></a>CPU显示未知修复</h2><p>打开终端并输入以下命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /System/Library/PrivateFrameworks/AppleSystemInfo.framework/Versions/A/Resources/zh_CN.lproj/</span><br><span class="line">cp AppleSystemInfo.strings ~/Desktop</span><br></pre></td></tr></table></figure>

<p>打开AppleSystemInfo.strings，将UnknownCPUKind下的内容修改为需要显示的内容，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;UnknownCPUKind&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Intel Core i7-8700K&lt;/string&gt;</span><br></pre></td></tr></table></figure>

<p>保存后在终端输入以下命令即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp ~/Desktop/AppleSystemInfo.strings /System/Library/PrivateFrameworks/AppleSystemInfo.framework/Versions/A/Resources/zh_CN.lproj/</span><br></pre></td></tr></table></figure>

<h1 id="系统安装与维护"><a href="#系统安装与维护" class="headerlink" title="系统安装与维护"></a>系统安装与维护</h1><h2 id="修改InstallESD-dmg"><a href="#修改InstallESD-dmg" class="headerlink" title="修改InstallESD.dmg"></a>修改InstallESD.dmg</h2><p>InstallESD.dmg位于macOS系统的安装包内，修改其内容（如删除部分kexts）可能会使安装过程更加顺利。</p>
<p>打开磁盘工具，点击菜单栏上的映像-转换，选择要转换的镜像，映像格式选择读&#x2F;写。打开转换好的dmg，修改完成后再次转换，映像格式选择压缩即可。</p>
<h2 id="去除机型检查"><a href="#去除机型检查" class="headerlink" title="去除机型检查"></a>去除机型检查</h2><p>可用Flat Package Editor或其它工具编辑OSInstall.mpkg，让Distribution脚本在hwbeModelCheck函数中总是返回true。编辑完成后在终端输入建议以下命令以重建映像。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Original.dmg为原始镜像</span><br><span class="line"># OSInstall.mpkg为修改过的镜像</span><br><span class="line">mkdir RO</span><br><span class="line">hdiutil mount Original.dmg -noverify -noautoopen -noautoopenrw -noautofsck -mountpoint RO cp RO/.DS_Store DS_STORE</span><br><span class="line">hdiutil detach RO -force</span><br><span class="line">rm -rf RO</span><br><span class="line">hdiutil convert Original.dmg -format UDRW -o ReadWrite.dmg</span><br><span class="line">mkdir RW</span><br><span class="line">xattr -c OSInstall.mpkg</span><br><span class="line">hdiutil mount ReadWrite.dmg -noverify -noautoopen -noautoopenrw -noautofsck -mountpoint RW cp OSInstall.mpkg RW/System/Installation/Packages/OSInstall.mpkg</span><br><span class="line">killall Finder fseventsd</span><br><span class="line">rm -rf RW/.fseventsd</span><br><span class="line">cp DS_STORE RW/.DS_Store</span><br><span class="line">hdiutil detach RW -force</span><br><span class="line">rm -rf DS_STORE RW</span><br></pre></td></tr></table></figure>

<h2 id="恢复盘"><a href="#恢复盘" class="headerlink" title="恢复盘"></a>恢复盘</h2><h3 id="FireWolf-OS-X-PE"><a href="#FireWolf-OS-X-PE" class="headerlink" title="FireWolf OS X PE"></a>FireWolf OS X PE</h3><p>类似Windows PE，FireWolf OS X PE可视作macPE，可为Mac提供恢复环境。下载链接如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://pe.firewolf.app/manual/downloads/thankyou.html</span><br></pre></td></tr></table></figure>

<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>在Windows下用Etcher刻录到U盘即可。</p>
<h4 id="引导启动"><a href="#引导启动" class="headerlink" title="引导启动"></a>引导启动</h4><p>在启动之前需先确保系统完整性保护（SIP）中已允许加载任意Recovery系统，即启用CSR标志位<code>CSR_ALLOW_ANY_RECOVERY_OS</code>，修改Clover配置文件中的Rt Variables-CsrActiveConfig为0x3E7即可。</p>
<p>使用引导High Sierra的Clover文件，可以顺利启动该恢复盘。</p>
<h1 id="系统调试与日志"><a href="#系统调试与日志" class="headerlink" title="系统调试与日志"></a>系统调试与日志</h1><h2 id="日志内容"><a href="#日志内容" class="headerlink" title="日志内容"></a>日志内容</h2><h3 id="previous-shutdown-cause-5"><a href="#previous-shutdown-cause-5" class="headerlink" title="previous shutdown cause:5"></a>previous shutdown cause:5</h3><p>Mac用于说明先前关机原因的代码。可在终端通过以下命令显示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log show --predicate &#x27;eventMessage contains &quot;Previous shutdown cause&quot;&#x27; --last 24h</span><br></pre></td></tr></table></figure>

<p>数字具体含义如下。</p>
<table>
<thead>
<tr>
<th>代码</th>
<th>含义</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>5</td>
<td>正确关机</td>
<td>通过关机菜单或其他关机命令关机</td>
</tr>
<tr>
<td>7</td>
<td>CPU线程错误</td>
<td>尝试安全模式</td>
</tr>
<tr>
<td>3</td>
<td>硬关机</td>
<td>按电源按钮强制关机</td>
</tr>
<tr>
<td>0</td>
<td>电源断开</td>
<td>对笔记本而言，若电源仍有电，则代表电池或电池控制器出现问题，可尝试重置SMC</td>
</tr>
<tr>
<td>-3</td>
<td>温度传感器超出阈值</td>
<td></td>
</tr>
<tr>
<td>-14</td>
<td>电流突峰</td>
<td>电问题或电池问题</td>
</tr>
<tr>
<td>-20</td>
<td>T2芯片导致的关机</td>
<td></td>
</tr>
<tr>
<td>-60</td>
<td>错误的主目录块（badMDBEr）</td>
<td>尝试重装系统</td>
</tr>
<tr>
<td>-61</td>
<td>应用程序无响应导致的关机</td>
<td></td>
</tr>
<tr>
<td>-62</td>
<td>应用程序无响应导致的重启</td>
<td></td>
</tr>
<tr>
<td>-71</td>
<td>SO-DIMM内存温度超出阈值</td>
<td>尝试清除风扇灰尘</td>
</tr>
<tr>
<td>-74</td>
<td>电池温度超出阈值</td>
<td>尝试重置SMC</td>
</tr>
<tr>
<td>-75</td>
<td>充电器通信问题</td>
<td></td>
</tr>
<tr>
<td>-78</td>
<td>充电器电流不正确</td>
<td></td>
</tr>
<tr>
<td>-79</td>
<td>电池电流不正确</td>
<td></td>
</tr>
<tr>
<td>-86</td>
<td>接近温度超出阈值</td>
<td></td>
</tr>
<tr>
<td>-95</td>
<td>CPU温度超出预知阈值</td>
<td>尝试重置SMC</td>
</tr>
<tr>
<td>-100</td>
<td>电源温度超出阈值</td>
<td></td>
</tr>
<tr>
<td>-102</td>
<td>过压保护导致的关机</td>
<td></td>
</tr>
<tr>
<td>-103</td>
<td>电池电压不足</td>
<td></td>
</tr>
<tr>
<td>-104</td>
<td>可能与电池有关</td>
<td></td>
</tr>
<tr>
<td>-108</td>
<td>可能与内存有关</td>
<td></td>
</tr>
<tr>
<td>-112</td>
<td>可能与内存有关</td>
<td></td>
</tr>
<tr>
<td>-127</td>
<td>PMU强制关闭</td>
<td></td>
</tr>
<tr>
<td>-128</td>
<td>可能与内存有关</td>
<td></td>
</tr>
</tbody></table>
<h2 id="内核Panic"><a href="#内核Panic" class="headerlink" title="内核Panic"></a>内核Panic</h2><p>可在&#x2F;Library&#x2F;Logs&#x2F;DiagnosticReports目录下找到Panic日志。</p>
<h3 id="错误数字含义"><a href="#错误数字含义" class="headerlink" title="错误数字含义"></a>错误数字含义</h3><table>
<thead>
<tr>
<th>向量偏移值</th>
<th>描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>Devide Error</td>
<td>当进行除以零的操作时产生</td>
</tr>
<tr>
<td>1</td>
<td>Debug Exceptions</td>
<td>当进行程序单步跟踪调试时，设置了标志寄存器eflags的T标志时产生这个中断</td>
</tr>
<tr>
<td>2</td>
<td>NMI Interrupt</td>
<td>由不可屏蔽产生</td>
</tr>
<tr>
<td>3</td>
<td>Breakpoint</td>
<td>由断点指令INT3产生，与Debug处理相同</td>
</tr>
<tr>
<td>4</td>
<td>INTO Detected Overflow</td>
<td>eflags的溢出标志0F引起</td>
</tr>
<tr>
<td>5</td>
<td>BOUND Range Exceeded</td>
<td>寻址到有效地址以外引起</td>
</tr>
<tr>
<td>6</td>
<td>Invalid Opcode</td>
<td>CPU执行发现一个无效的指令操作码</td>
</tr>
<tr>
<td>7</td>
<td>Coprocessor Not Available</td>
<td>设备不存在，指协处理器。在两种情况下会产生该中断：CPU遇到一个转意指令并且EM置位；MP和TS都在置位状态，CPU遇到wait或一个转意指令。在这种情况下，处理程序在必要应该更新协处理器的状态</td>
</tr>
<tr>
<td>8</td>
<td>Double Exception</td>
<td>双故障出错</td>
</tr>
<tr>
<td>9</td>
<td>Coprocessor Segment Overrun</td>
<td>协处理器段超出</td>
</tr>
<tr>
<td>10</td>
<td>Invalid Task State Segment</td>
<td>CPU切换时发现TSS无效</td>
</tr>
<tr>
<td>11</td>
<td>Segment Not Present</td>
<td>描述符所指的段不存在</td>
</tr>
<tr>
<td>12</td>
<td>Stack Fault</td>
<td>堆栈溢出或者不存在</td>
</tr>
<tr>
<td>13</td>
<td>General Protection</td>
<td>没有符合80386保护机制的（特权机制）操作引起</td>
</tr>
<tr>
<td>14</td>
<td>Page Fault</td>
<td>页溢出或不存在</td>
</tr>
<tr>
<td>16</td>
<td>Coprocessor Error</td>
<td>协处理器检测到非法操作</td>
</tr>
</tbody></table>
<h3 id="错误分析"><a href="#错误分析" class="headerlink" title="错误分析"></a>错误分析</h3><p>在Finder切换到<code>/Library/Logs/DiagnosticReports</code>，打开后缀名为panic的文档以获取内核错误报告，示例如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">*** Panic Report ***</span><br><span class="line">panic(cpu 6 caller 0xffffff8008b6f2e9): Kernel trap at 0xffffff7f8c7ba8b1, type 14=page fault</span><br><span class="line"></span><br><span class="line">registers:</span><br><span class="line">CR0: 0x000000008001003b, CR2: 0xffffff80639b8000, CR3: 0x0000000022202000, CR4: 0x00000000003627e0</span><br><span class="line">RAX: 0x0000000000000564, RBX: 0x0000000000000564, RCX: 0x0000000000000020, RDX: 0x000000000000002a</span><br><span class="line">RSP: 0xffffff92354ebc80, RBP: 0xffffff92354ebce0, RSI: 0x00000000000fbeab, RDI: 0xffffff92487b9154</span><br><span class="line">R8:  0x0000000000000000, R9:  0x0000000000000010, R10: 0x0000000000000010, R11: 0x0000000000000000</span><br><span class="line">R12: 0xffffff80639b6a70, R13: 0xffffff92354ebdc0, R14: 0xffffff92354ebdd4, R15: 0x0000000000000000</span><br><span class="line">RFL: 0x0000000000010297, RIP: 0xffffff7f8c7ba8b1, CS:  0x0000000000000008, SS:  0x0000000000000010</span><br><span class="line">Fault CR2: 0xffffff80639b8000, Error code: 0x0000000000000000, Fault CPU: 0x6, PL: 0, VF: 1</span><br><span class="line"></span><br><span class="line">Backtrace (CPU 6), Frame : Return Address</span><br><span class="line">0xffffff92354eb730 : 0xffffff8008a505f6 </span><br><span class="line">0xffffff92354eb780 : 0xffffff8008b7d604 </span><br><span class="line">0xffffff92354eb7c0 : 0xffffff8008b6f0f9 </span><br><span class="line">0xffffff92354eb840 : 0xffffff8008a02120 </span><br><span class="line">0xffffff92354eb860 : 0xffffff8008a5002c </span><br><span class="line">0xffffff92354eb990 : 0xffffff8008a4fdac </span><br><span class="line">0xffffff92354eb9f0 : 0xffffff8008b6f2e9 </span><br><span class="line">0xffffff92354ebb70 : 0xffffff8008a02120 </span><br><span class="line">0xffffff92354ebb90 : 0xffffff7f8c7ba8b1 </span><br><span class="line">0xffffff92354ebce0 : 0xffffff7f8c7ba40f </span><br><span class="line">0xffffff92354ebd60 : 0xffffff7f8c7b85e8 </span><br><span class="line">0xffffff92354ebda0 : 0xffffff7f8c7b9db2 </span><br><span class="line">0xffffff92354ebe00 : 0xffffff7f8b2b3873 </span><br><span class="line">0xffffff92354ebe50 : 0xffffff7f8b2bd473 </span><br><span class="line">0xffffff92354ebe90 : 0xffffff7f8b2bcc7d </span><br><span class="line">0xffffff92354ebed0 : 0xffffff8009091395 </span><br><span class="line">0xffffff92354ebf30 : 0xffffff800908fba2 </span><br><span class="line">0xffffff92354ebf70 : 0xffffff800908f1dc </span><br><span class="line">0xffffff92354ebfa0 : 0xffffff8008a014f7</span><br><span class="line"></span><br><span class="line">Kernel Extensions in backtrace:</span><br><span class="line">com.apple.iokit.IOAcceleratorFamily2(376.6) @0xffffff7f8b2b0000-&gt;0xffffff7f8b345fff</span><br><span class="line">com.apple.kext.AMDRadeonX4150(1.6) @0xffffff7f8c7b4000-&gt;0xffffff7f8cf20fff </span><br><span class="line"></span><br><span class="line">BSD process name corresponding to current thread: kernel_task</span><br><span class="line"></span><br><span class="line">Mac OS version:</span><br><span class="line">17C88</span><br><span class="line"></span><br><span class="line">Kernel version:</span><br><span class="line">Darwin Kernel Version 17.3.0: Thu Nov  9 18:09:22 PST 2017; root:xnu-4570.31.3~1/RELEASE_X86_64</span><br><span class="line">Kernel slide:     0x0000000008600000</span><br></pre></td></tr></table></figure>

<p>从以上内容可知，该错误由<code>14=page fault</code>即页面错误引起，RIP寄存器即程序计数器的值为<code>0xffffff7f8c7ba8b1</code>，CR2寄存器即触发页面错误的内存地址为<code>0xffffff80639b8000</code>，Kernel slide为<code>0x0000000008600000</code>。在kext回溯中，可以看到以下两个kext可能触发该页面错误，从而引起恐慌。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kext / com.apple.iokit.IOAcceleratorFamily2</span><br><span class="line">加载于 / 0xffffff7f8b2b0000</span><br><span class="line"></span><br><span class="line">kext / com.apple.kext.AMDRadeonX4150</span><br><span class="line">加载于 / 0xffffff7f8c7b4000</span><br></pre></td></tr></table></figure>

<p>下载Hopper，链接如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.hopperapp.com/</span><br></pre></td></tr></table></figure>

<p>打开Hoppeer并在软件中加载&#x2F;System&#x2F;Library&#x2F;Kernels&#x2F;kernel，单击Modify-Change File Base Address，在Base Address输入Kernel slide加上0x100000的值，即0xffffff8008700000。</p>
<p>重定位后点击<code>G</code>，输入Backtrace中的最后一个地址，即0xffffff8008a014f7。汇编代码片段如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                    _call_continuation:</span><br><span class="line">ffffff8008a014e0    mov     rcx, rdi</span><br><span class="line">ffffff8008a014e3    mov     rdi, rsi</span><br><span class="line">ffffff8008a014e6    mov     rsi, rdx</span><br><span class="line">ffffff8008a014e9    mov     rsp, qword [gs:0x30]</span><br><span class="line">ffffff8008a014f2    xor     rbp, rbp</span><br><span class="line">ffffff8008a014f5    call    rcx</span><br><span class="line">ffffff8008a014f7    mov     rdi, qword [gs:0x8]</span><br></pre></td></tr></table></figure>

<p>由堆栈相关知识可知，在调用ffffff8008a014f5处的call时会压入返回地址，此处为0xffffff8008a014f7。同理搜索Backtrace中的倒数第二个地址0xffffff800908f1dc，可得到另一个调用语句的地址。重复以上过程，结果如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">kernel.call_continuation()</span><br><span class="line">0xffffff8008a014f5 call rcx</span><br><span class="line"></span><br><span class="line">kernel.IOWorkLoop::threadMain()</span><br><span class="line">0xffffff800908f1d6 call qword [rax+0x1a8]</span><br><span class="line"></span><br><span class="line">kernel.IOWorkLoop::runEventSources()</span><br><span class="line">0xffffff800908fb9c call qword [rax+0x120]</span><br><span class="line"></span><br><span class="line">kernel.IOInterruptEventSource::checkForWork()</span><br><span class="line">0xffffff8009091392 call r11</span><br><span class="line"></span><br><span class="line">com.apple.iokit.IOAcceleratorFamily2.IOAccelEventMachine2::hardwareErrorEvent()</span><br><span class="line">0xffffff7f8b2bcc78 call IOAccelEventMachine2::restart_channel()</span><br><span class="line"></span><br><span class="line">com.apple.iokit.IOAcceleratorFamily2.IOAccelEventMachine2::restart_channel()</span><br><span class="line">0xffffff7f8b2bd46d call qword [rax+0x160]</span><br><span class="line"></span><br><span class="line">com.apple.iokit.IOAcceleratorFamily2.IOAccelFIFOChannel2::restart()</span><br><span class="line">0xffffff7f8b2b386d call qword [rax+0x208]</span><br><span class="line"></span><br><span class="line">com.apple.kext.AMDRadeonX4150.AMDRadeonX4150_AMDAccelChannel::getHardwareDiagnosisReport()</span><br><span class="line">0xffffff7f8c7b9dac call qword [rax+0xb00]</span><br><span class="line"></span><br><span class="line">com.apple.kext.AMDRadeonX4150.AMDRadeonX4150_AMDGraphicsAccelerator::writeDiagnosisReport()</span><br><span class="line">0xffffff7f8c7b85e2 call qword [rax+0x258]</span><br><span class="line"></span><br><span class="line">com.apple.kext.AMDRadeonX4150.AMDRadeonX4150_AMDAccelChannel::writeDiagnosisReport()</span><br><span class="line">0xffffff7f8c7ba40a call AMDRadeonX4150_AMDAccelChannel::writePendingCommandInfo</span><br><span class="line"></span><br><span class="line">com.apple.kext.AMDRadeonX4150.AMDRadeonX4150_AMDAccelChannel::writePendingCommandInfoDiagnosisReport()</span><br><span class="line">0xffffff7f8c7ba8b1 mov r8d, dword [r12+rax*4]</span><br><span class="line"></span><br><span class="line">kernel.hndl_alltraps()</span><br><span class="line">0xffffff8008a0211b call _kernel_trap</span><br></pre></td></tr></table></figure>

<p>根据以下内容，可知内核在找到要执行的任务后，首先调用com.apple.iokit.IOAcceleratorFamily2的内核线程，其中调用了restart_channel方法。然后切换到特定的kext即com.apple.kext.AMDRadeonX4150，调用writeDiagnosisReport方法。</p>
<p>在0xffffff7f8c7ba8b1处不是一个call指令，而是<code>mov r8d, dword [r12+rax*4]</code>。该地址即为RIP寄存器的内容，因此可以确定出现panic的指令位置。</p>
<p>根据内核报告，R12&#x3D;0xffffff80639b6a70，RAX&#x3D;0x0000000000000564，计算可得传送的地址为0xffffff80639b8000。该地址为fault CR2寄存器的内容。</p>
<p>因此可以猜测，0xffffff80639b8000指向一个未映射的页面，当com.apple.kext.AMDRadeonX4150中的mov指令尝试从该未映射地址读取时，会发生未处理的页面错误，从而导致panic。</p>
<h2 id="Data-Hub日志"><a href="#Data-Hub日志" class="headerlink" title="Data Hub日志"></a>Data Hub日志</h2><p>Data Hub日志中不包括Kernel和Kext的日志。可在终端通过以下命令获取Data Hub日志。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ioreg -lw0 -p IODeviceTree | grep boot-log | sort | sed &#x27;s/.*&lt;\(.*\)&gt;.*/\1/&#x27; | xxd -r -p</span><br></pre></td></tr></table></figure>

<h2 id="UEFI变量日志"><a href="#UEFI变量日志" class="headerlink" title="UEFI变量日志"></a>UEFI变量日志</h2><p>可在终端通过以下命令获取UEFI变量日志。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-log | awk &#x27;&#123;gsub(/%0d%0a%00/,&quot;&quot;);gsub(/%0d%0a/,&quot;\n&quot;)&#125;1&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="内核调试套件"><a href="#内核调试套件" class="headerlink" title="内核调试套件"></a>内核调试套件</h2><p>内核调试工具包（Kernel Debug Kits，KDK）可从内核和核心kext获取日志信息。</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>在终端输入以下命令以确定需要下载的KDK版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sw_vers | grep BuildVersion</span><br></pre></td></tr></table></figure>

<p>打开以下链接，搜索Kernel Debug Kit并下载相应的版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://developer.apple.com/download/all/</span><br></pre></td></tr></table></figure>

<p>下载后运行安装包进行安装。禁用系统SIP后，在终端输入以下命令以挂载根目录为可写。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Big Sur+</span><br><span class="line">mkdir ~/livemount</span><br><span class="line">diskutil list</span><br><span class="line"># 挂载上面看到的系统盘（不包含 - Data 的盘），此处为/dev/disk5s5</span><br><span class="line">sudo mount -o nobrowse -t apfs  /dev/disk5s5 ~/livemount</span><br><span class="line"></span><br><span class="line"># Catalina</span><br><span class="line">sudo mount -uw /</span><br></pre></td></tr></table></figure>

<p>然后输入以下命令安装。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Install KDK to System Volume</span><br><span class="line"># Ensure to replace &lt;KDK Version&gt;</span><br><span class="line"># For 10.15 and older, swap livemount with /Volumes/&lt;Target Volume&gt;</span><br><span class="line">sudo ditto /Library/Developer/KDKs/&lt;KDK Version&gt;/System ~/livemount/System</span><br><span class="line"></span><br><span class="line"># Rebuild the kernel cache(Big Sur and newer)</span><br><span class="line">sudo kmutil install --volume-root ~/livemount --update-all</span><br><span class="line"></span><br><span class="line"># Rebuild the kernel cache(Catalina and older)</span><br><span class="line">sudo kextcache -invalidate /Volumes/&lt;Target Volume&gt;</span><br><span class="line"></span><br><span class="line"># Finally, once done editing the system volume</span><br><span class="line"># we&#x27;ll want to create a new snapshot (Big Sur and newer)</span><br><span class="line">sudo bless --folder ~/livemount/System/Library/CoreServices --bootefi --create-snapshot</span><br></pre></td></tr></table></figure>

<p>完成安装后，需要添加以下启动参数之一。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># kasan是一个包含AddressSanitizer的日志密集型内核</span><br><span class="line">kcsuffix=debug（Big Sur已移除）</span><br><span class="line">kcsuffix=development</span><br><span class="line">kcsuffix=kasan</span><br></pre></td></tr></table></figure>

<p>重新启动并在终端输入以下命令以查看当前内核是否已被改变。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl kern.osbuildconfig</span><br></pre></td></tr></table></figure>

<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><p>禁用系统SIP后，在终端输入以下命令以挂载根目录为可写。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Big Sur+</span><br><span class="line">mkdir ~/livemount</span><br><span class="line">diskutil list</span><br><span class="line"># 挂载上面看到的系统盘（不包含 - Data 的盘），此处为/dev/disk5s5</span><br><span class="line">sudo mount -o nobrowse -t apfs  /dev/disk5s5 ~/livemount</span><br><span class="line"></span><br><span class="line"># Catalina</span><br><span class="line">sudo mount -uw /</span><br></pre></td></tr></table></figure>

<p>然后输入以下命令删除调试内核和kexts。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Revert to old snapshot (Big Sur+)</span><br><span class="line">sudo bless --mount ~/livemount --bootefi --last-sealed-snapshot</span><br><span class="line"></span><br><span class="line"># Reset kernel cache (Catalina and older)</span><br><span class="line">sudo rm /System/Library/Caches/com.apple.kext.caches/Startup/kernelcache.de*</span><br><span class="line">sudo rm /System/Library/PrelinkedKernels/prelinkedkernel.de*</span><br><span class="line">sudo kextcache -invalidate /</span><br></pre></td></tr></table></figure>

<p>删除启动参数<code>kcsuffix=</code>后重新启动，然后在终端输入以下命令以查看当前内核是否已被改变。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl kern.osbuildconfig</span><br></pre></td></tr></table></figure>

<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="SSDTTime"><a href="#SSDTTime" class="headerlink" title="SSDTTime"></a>SSDTTime</h3><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/corpnewt/SSDTTime</span><br></pre></td></tr></table></figure>

<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><h5 id="提示Could-not-locate-or-download-iasl"><a href="#提示Could-not-locate-or-download-iasl" class="headerlink" title="提示Could not locate or download iasl!"></a>提示Could not locate or download iasl!</h5><p>Python版本过时。可更新Python，或下载iasl并放置到SSDTTime的脚本文件夹中。</p>
<h2 id="旧版工具"><a href="#旧版工具" class="headerlink" title="旧版工具"></a>旧版工具</h2><h3 id="DSDT-editor"><a href="#DSDT-editor" class="headerlink" title="DSDT editor"></a>DSDT editor</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.insanelymac.com/forum/topic/223205-dsdt-editor-and-patcher/</span><br><span class="line">http://www.macbreaker.com/2012/03/make-dsdt-with-dsdt-editor.html</span><br></pre></td></tr></table></figure>

<h2 id="DSDT库"><a href="#DSDT库" class="headerlink" title="DSDT库"></a>DSDT库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Intel NUC5/NUC6/NUC7/NUC8 DSDT patches</span><br><span class="line">https://github.com/RehabMan/Intel-NUC-DSDT-Patch</span><br><span class="line"></span><br><span class="line"># DSDT Database</span><br><span class="line">https://www.tonymacx86.com/dsdt-database</span><br></pre></td></tr></table></figure>


<h2 id="本机文件内容"><a href="#本机文件内容" class="headerlink" title="本机文件内容"></a>本机文件内容</h2><h3 id="DSDT-1"><a href="#DSDT-1" class="headerlink" title="DSDT"></a>DSDT</h3><h4 id="电池"><a href="#电池" class="headerlink" title="电池"></a>电池</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br></pre></td><td class="code"><pre><span class="line">Scope (_SB.PCI0.LPCB.EC0)</span><br><span class="line">&#123;</span><br><span class="line">    Device (BAT0)</span><br><span class="line">    &#123;</span><br><span class="line">        Name (_HID, EisaId (&quot;PNP0C0A&quot;))  // _HID: Hardware ID</span><br><span class="line">        Name (_UID, Zero)  // _UID: Unique ID</span><br><span class="line">        Name (_PCL, Package (0x01)  // _PCL: Power Consumer List</span><br><span class="line">        &#123;</span><br><span class="line">            PCI0</span><br><span class="line">        &#125;)</span><br><span class="line">        Method (_STA, 0, NotSerialized)  // _STA: Status</span><br><span class="line">        &#123;</span><br><span class="line">            If (BATP (Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (0x1F)</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Return (0x0F)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Name (LOW2, 0x012C)</span><br><span class="line">        Name (PUNT, One)</span><br><span class="line">        Name (LFCC, 0x1770)</span><br><span class="line">        Name (NBIF, Package (0x0D)</span><br><span class="line">        &#123;</span><br><span class="line">            Zero, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            One, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            &quot;&quot;, </span><br><span class="line">            &quot;&quot;, </span><br><span class="line">            &quot;&quot;, </span><br><span class="line">            &quot;&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        Name (PBIF, Package (0x0D)</span><br><span class="line">        &#123;</span><br><span class="line">            One, </span><br><span class="line">            0x1770, </span><br><span class="line">            0x1770, </span><br><span class="line">            One, </span><br><span class="line">            0x39D0, </span><br><span class="line">            0x0258, </span><br><span class="line">            0x012C, </span><br><span class="line">            0x3C, </span><br><span class="line">            0x3C, </span><br><span class="line">            &quot;M3N&quot;, </span><br><span class="line">            &quot; &quot;, </span><br><span class="line">            &quot;LIon&quot;, </span><br><span class="line">            &quot;ASUSTeK&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        Name (PBST, Package (0x04)</span><br><span class="line">        &#123;</span><br><span class="line">            Zero, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF</span><br><span class="line">        &#125;)</span><br><span class="line">        Name (BIXT, Package (0x14)</span><br><span class="line">        &#123;</span><br><span class="line">            Zero, </span><br><span class="line">            Zero, </span><br><span class="line">            0x1770, </span><br><span class="line">            0x1770, </span><br><span class="line">            One, </span><br><span class="line">            0x39D0, </span><br><span class="line">            0x0258, </span><br><span class="line">            0x012C, </span><br><span class="line">            Zero, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0x3C, </span><br><span class="line">            0x3C, </span><br><span class="line">            &quot;M3N&quot;, </span><br><span class="line">            &quot; &quot;, </span><br><span class="line">            &quot;LIon&quot;, </span><br><span class="line">            &quot;ASUSTeK&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        Name (NBIX, Package (0x14)</span><br><span class="line">        &#123;</span><br><span class="line">            Zero, </span><br><span class="line">            Zero, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            One, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            Zero, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            0xFFFFFFFF, </span><br><span class="line">            &quot;&quot;, </span><br><span class="line">            &quot;&quot;, </span><br><span class="line">            &quot;&quot;, </span><br><span class="line">            &quot;&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        Method (FBIF, 5, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            Store (Arg0, PUNT)</span><br><span class="line">            Store (Arg1, Local1)</span><br><span class="line">            Store (Arg2, Local2)</span><br><span class="line">            If (LEqual (PUNT, Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Multiply (Local1, 0x0A, Local1)</span><br><span class="line">                Multiply (Local2, 0x0A, Local2)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (Arg0, Index (PBIF, Zero))</span><br><span class="line">            Store (Local1, Index (PBIF, One))</span><br><span class="line">            Store (Local2, Index (PBIF, 0x02))</span><br><span class="line">            Store (Local2, LFCC)</span><br><span class="line">            Store (Arg3, Index (PBIF, 0x03))</span><br><span class="line">            Store (Arg4, Index (PBIF, 0x04))</span><br><span class="line">            Divide (Local1, 0x0A, , Local5)</span><br><span class="line">            Store (Local5, Index (PBIF, 0x05))</span><br><span class="line">            Divide (Local1, 0x64, , Local6)</span><br><span class="line">            Store (Local6, Index (PBIF, 0x06))</span><br><span class="line">            Store (Local6, LOW2)</span><br><span class="line">            Divide (Local1, 0x64, , Local7)</span><br><span class="line">            Store (Local7, Index (PBIF, 0x07))</span><br><span class="line">            Store (Local7, Index (PBIF, 0x08))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (CBIF, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (PUNT)</span><br><span class="line">            &#123;</span><br><span class="line">                Store (DerefOf (Index (PBIF, 0x04)), Local0)</span><br><span class="line">                Store (Zero, Index (PBIF, Zero))</span><br><span class="line">                Multiply (DerefOf (Index (PBIF, One)), Local0, Index (PBIF, One))</span><br><span class="line">                Multiply (DerefOf (Index (PBIF, 0x02)), Local0, Index (PBIF, 0x02))</span><br><span class="line">                Multiply (DerefOf (Index (PBIF, 0x05)), Local0, Index (PBIF, 0x05))</span><br><span class="line">                Multiply (DerefOf (Index (PBIF, 0x06)), Local0, Index (PBIF, 0x06))</span><br><span class="line">                Multiply (DerefOf (Index (PBIF, 0x07)), Local0, Index (PBIF, 0x07))</span><br><span class="line">                Multiply (DerefOf (Index (PBIF, 0x08)), Local0, Index (PBIF, 0x08))</span><br><span class="line">                Divide (DerefOf (Index (PBIF, One)), 0x03E8, , Index (PBIF, One))</span><br><span class="line">                Divide (DerefOf (Index (PBIF, 0x02)), 0x03E8, , Index (PBIF, 0x02))</span><br><span class="line">                Divide (DerefOf (Index (PBIF, 0x05)), 0x03E8, , Index (PBIF, 0x05))</span><br><span class="line">                Divide (DerefOf (Index (PBIF, 0x06)), 0x03E8, , Index (PBIF, 0x06))</span><br><span class="line">                Divide (DerefOf (Index (PBIF, 0x07)), 0x03E8, , Index (PBIF, 0x07))</span><br><span class="line">                Divide (DerefOf (Index (PBIF, 0x08)), 0x03E8, , Index (PBIF, 0x08))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (_BIF, 0, NotSerialized)  // _BIF: Battery Information</span><br><span class="line">        &#123;</span><br><span class="line">            If (LNot (BATP (Zero)))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (NBIF)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (GBTT (Zero), 0xFF))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (NBIF)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            BATO ()</span><br><span class="line">            BATS (Zero)</span><br><span class="line">            Store (BIF9 (), Index (PBIF, 0x09))</span><br><span class="line">            Store (BIF0 (), Local0)</span><br><span class="line">            Store (BIF1 (), Local1)</span><br><span class="line">            Store (BIF2 (), Local2)</span><br><span class="line">            Store (BIF3 (), Local3)</span><br><span class="line">            Store (BIF4 (), Local4)</span><br><span class="line">            If (LNotEqual (Local0, Ones))</span><br><span class="line">            &#123;</span><br><span class="line">                If (LNotEqual (Local1, Ones))</span><br><span class="line">                &#123;</span><br><span class="line">                    If (LNotEqual (Local2, Ones))</span><br><span class="line">                    &#123;</span><br><span class="line">                        If (LNotEqual (Local3, Ones))</span><br><span class="line">                        &#123;</span><br><span class="line">                            If (LNotEqual (Local4, Ones))</span><br><span class="line">                            &#123;</span><br><span class="line">                                FBIF (Local0, Local1, Local2, Local3, Local4)</span><br><span class="line">                                CBIF ()</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (PUNT, Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Multiply (Local2, 0x0A, Local2)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (Local2, LFCC)</span><br><span class="line">            BATR ()</span><br><span class="line">            Return (PBIF)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (FBST, 4, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            And (Arg1, 0xFFFF, Local1)</span><br><span class="line">            Store (Zero, Local0)</span><br><span class="line">            If (ACAP ())</span><br><span class="line">            &#123;</span><br><span class="line">                Store (One, Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (Local0)</span><br><span class="line">            &#123;</span><br><span class="line">                If (CHGS (Zero))</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (0x02, Local0)</span><br><span class="line">                &#125;</span><br><span class="line">                Else</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (One, Local0)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Store (One, Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (BLLO)</span><br><span class="line">            &#123;</span><br><span class="line">                Store (0x04, Local2)</span><br><span class="line">                Or (Local0, Local2, Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (0x09, BRAH)</span><br><span class="line">            If (And (EB0S, 0x08))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (0x04, Local2)</span><br><span class="line">                Or (Local0, Local2, Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LGreaterEqual (Local1, 0x8000))</span><br><span class="line">            &#123;</span><br><span class="line">                Subtract (0xFFFF, Local1, Local1)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (Arg2, Local2)</span><br><span class="line">            If (LEqual (PUNT, Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (0x09, BRAH)</span><br><span class="line">                Multiply (Local1, B0DV, Local1)</span><br><span class="line">                Multiply (Local2, 0x0A, Local2)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            And (Local0, 0x02, Local3)</span><br><span class="line">            If (LNot (Local3))</span><br><span class="line">            &#123;</span><br><span class="line">                Subtract (LFCC, Local2, Local3)</span><br><span class="line">                Divide (LFCC, 0xC8, Local4, Local5)</span><br><span class="line">                If (LLess (Local3, Local5))</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (LFCC, Local2)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Divide (LFCC, 0xC8, Local4, Local5)</span><br><span class="line">                Subtract (LFCC, Local5, Local4)</span><br><span class="line">                If (LGreater (Local2, Local4))</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (Local4, Local2)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LNot (ACAP ()))</span><br><span class="line">            &#123;</span><br><span class="line">                Divide (Local2, MBLF, Local3, Local4)</span><br><span class="line">                If (LLess (Local1, Local4))</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (Local4, Local1)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (Local0, Index (PBST, Zero))</span><br><span class="line">            Store (Local1, Index (PBST, One))</span><br><span class="line">            Store (Local2, Index (PBST, 0x02))</span><br><span class="line">            Store (Arg3, Index (PBST, 0x03))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (CBST, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (PUNT)</span><br><span class="line">            &#123;</span><br><span class="line">                Store (0x09, BRAH)</span><br><span class="line">                Store (B0DV, Index (PBST, 0x03))</span><br><span class="line">                Store (DerefOf (Index (PBST, 0x03)), Local0)</span><br><span class="line">                Multiply (DerefOf (Index (PBST, One)), Local0, Index (PBST, One))</span><br><span class="line">                Divide (DerefOf (Index (PBST, One)), 0x03E8, , Index (PBST, One))</span><br><span class="line">                Multiply (DerefOf (Index (PBST, 0x02)), Local0, Index (PBST, 0x02))</span><br><span class="line">                Divide (DerefOf (Index (PBST, 0x02)), 0x03E8, , Index (PBST, 0x02))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (_BST, 0, NotSerialized)  // _BST: Battery Status</span><br><span class="line">        &#123;</span><br><span class="line">            Store (Zero, Index (PBST, Zero))</span><br><span class="line">            Store (Ones, Index (PBST, One))</span><br><span class="line">            Store (Ones, Index (PBST, 0x02))</span><br><span class="line">            Store (Ones, Index (PBST, 0x03))</span><br><span class="line">            If (LNot (BATP (Zero)))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (One, Index (PBST, Zero))</span><br><span class="line">                Return (PBST)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (GBTT (Zero), 0xFF))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (PBST)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            BATO ()</span><br><span class="line">            BATS (Zero)</span><br><span class="line">            Store (BSTS (), Local0)</span><br><span class="line">            Store (BCRT (), Local1)</span><br><span class="line">            Store (BRCP (), Local2)</span><br><span class="line">            Store (BVOT (), Local3)</span><br><span class="line">            If (LNotEqual (Local0, Ones))</span><br><span class="line">            &#123;</span><br><span class="line">                If (LNotEqual (Local1, Ones))</span><br><span class="line">                &#123;</span><br><span class="line">                    If (LNotEqual (Local2, Ones))</span><br><span class="line">                    &#123;</span><br><span class="line">                        If (LNotEqual (Local3, Ones))</span><br><span class="line">                        &#123;</span><br><span class="line">                            FBST (Local0, Local1, Local2, Local3)</span><br><span class="line">                            CBST ()</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            BATR ()</span><br><span class="line">            Return (PBST)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (_BIX, 0, NotSerialized)  // _BIX: Battery Information Extended</span><br><span class="line">        &#123;</span><br><span class="line">            If (LNot (BATP (Zero)))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (NBIX)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (GBTT (Zero), 0xFF))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (NBIX)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _BIF ()</span><br><span class="line">            Store (DerefOf (Index (PBIF, Zero)), Index (BIXT, One))</span><br><span class="line">            Store (DerefOf (Index (PBIF, One)), Index (BIXT, 0x02))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x02)), Index (BIXT, 0x03))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x03)), Index (BIXT, 0x04))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x04)), Index (BIXT, 0x05))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x05)), Index (BIXT, 0x06))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x06)), Index (BIXT, 0x07))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x07)), Index (BIXT, 0x0E))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x08)), Index (BIXT, 0x0F))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x09)), Index (BIXT, 0x10))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x0A)), Index (BIXT, 0x11))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x0B)), Index (BIXT, 0x12))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x0C)), Index (BIXT, 0x13))</span><br><span class="line">            If (LEqual (DerefOf (Index (BIXT, One)), One))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (Zero, Index (BIXT, One))</span><br><span class="line">                Store (DerefOf (Index (BIXT, 0x05)), Local0)</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x02)), Local0, Index (BIXT, 0x02))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x03)), Local0, Index (BIXT, 0x03))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x06)), Local0, Index (BIXT, 0x06))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x07)), Local0, Index (BIXT, 0x07))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x0E)), Local0, Index (BIXT, 0x0E))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x0F)), Local0, Index (BIXT, 0x0F))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x02)), 0x03E8, Local0, Index (BIXT, 0x02))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x03)), 0x03E8, Local0, Index (BIXT, 0x03))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x06)), 0x03E8, Local0, Index (BIXT, 0x06))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x07)), 0x03E8, Local0, Index (BIXT, 0x07))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x0E)), 0x03E8, Local0, Index (BIXT, 0x0E))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x0F)), 0x03E8, Local0, Index (BIXT, 0x0F))</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (B0C3, Index (BIXT, 0x08))</span><br><span class="line">            Store (0x0001869F, Index (BIXT, 0x09))</span><br><span class="line">            Return (BIXT)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (_BTP, 1, NotSerialized)  // _BTP: Battery Trip Point</span><br><span class="line">        &#123;</span><br><span class="line">            ST8E (0x29, 0xFF)</span><br><span class="line">            ST8E (0x2A, 0xFF)</span><br><span class="line">            ST8E (0x28, 0x0F)</span><br><span class="line">            If (LNotEqual (Arg0, Zero))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (DerefOf (Index (PBIF, 0x04)), Local0)</span><br><span class="line">                Multiply (Arg0, 0x03E8, Local1)</span><br><span class="line">                Divide (Local1, Local0, Local2, Local3)</span><br><span class="line">                If (CHGS (Zero))</span><br><span class="line">                &#123;</span><br><span class="line">                    If (LNotEqual (Local2, Zero))</span><br><span class="line">                    &#123;</span><br><span class="line">                        Add (Local3, One, Local3)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ST9E (0x29, 0xFF, And (Local3, 0xFF))</span><br><span class="line">                ShiftRight (Local3, 0x08, Local2)</span><br><span class="line">                And (Local2, 0xFF, Local2)</span><br><span class="line">                ST9E (0x2A, 0xFF, Local2)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SSDT-1"><a href="#SSDT-1" class="headerlink" title="SSDT"></a>SSDT</h3><h4 id="电池-1"><a href="#电池-1" class="headerlink" title="电池"></a>电池</h4><p>更名如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Comment: change BIFA to BIGA</span><br><span class="line">Find: 42494641</span><br><span class="line">Replace: 42494741</span><br><span class="line"></span><br><span class="line">Comment: change _BIX to XBIX</span><br><span class="line">Find: 5F424958</span><br><span class="line">Replace: 58424958</span><br></pre></td></tr></table></figure>

<p>SSDT如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">// 使用Catalina用户则需将EC0更改为EC</span><br><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;hack&quot;, &quot;BAT0&quot;, 0x00000000)</span><br><span class="line">&#123;</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0, DeviceObj) </span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BAT0, DeviceObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BAT0._BIF, MethodObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BAT0.BIXT, IntObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BAT0.NBIX, IntObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BAT0.PBIF, IntObj) </span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BATP, MethodObj) </span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.BSLF, IntObj) </span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.ECAV, MethodObj)</span><br><span class="line">    External (_SB.PCI0.LPCB.EC0.GBTT, MethodObj)</span><br><span class="line"></span><br><span class="line">    Scope (_SB.PCI0.LPCB.EC0)</span><br><span class="line">    &#123;</span><br><span class="line">        OperationRegion (ECAG, EmbeddedControl, Zero, 0xFF)</span><br><span class="line">        Field (ECAG, ByteAcc, Lock, Preserve)</span><br><span class="line">        &#123;</span><br><span class="line">            Offset (0x04), </span><br><span class="line">            Offset (0x05), </span><br><span class="line">            Offset (0x06), </span><br><span class="line">            Offset (0x07), </span><br><span class="line">            Offset (0x08), </span><br><span class="line">            Offset (0x80), </span><br><span class="line">            Offset (0x81), </span><br><span class="line">            Offset (0x82), </span><br><span class="line">            Offset (0x83), </span><br><span class="line">            Offset (0x84), </span><br><span class="line">            Offset (0x85), </span><br><span class="line">            Offset (0x86), </span><br><span class="line">            Offset (0x87), </span><br><span class="line">            Offset (0x88), </span><br><span class="line">            Offset (0x89), </span><br><span class="line">            Offset (0x93), </span><br><span class="line">            Offset (0x95), </span><br><span class="line">            Offset (0x97), </span><br><span class="line">            Offset (0x98), </span><br><span class="line">            Offset (0x9C), </span><br><span class="line">            Offset (0x9D), </span><br><span class="line">            Offset (0x9E), </span><br><span class="line">            Offset (0xA0), </span><br><span class="line">            Offset (0xA1), </span><br><span class="line">            Offset (0xA2), </span><br><span class="line">            Offset (0xA3), </span><br><span class="line">            Offset (0xA4), </span><br><span class="line">            Offset (0xA5), </span><br><span class="line">            Offset (0xA6), </span><br><span class="line">            Offset (0xA7), </span><br><span class="line">            Offset (0xA8), </span><br><span class="line">            Offset (0xB0), </span><br><span class="line">            Offset (0xB2), </span><br><span class="line">            Offset (0xB4), </span><br><span class="line">            Offset (0xB6), </span><br><span class="line">            Offset (0xB8), </span><br><span class="line">            Offset (0xBA), </span><br><span class="line">            Offset (0xBC), </span><br><span class="line">            Offset (0xBE), </span><br><span class="line">            Offset (0xC0), </span><br><span class="line">            Offset (0xC2), </span><br><span class="line">            Offset (0xC4), </span><br><span class="line">            C3HG,   8, </span><br><span class="line">            C3HF,   8, </span><br><span class="line">            Offset (0xC8), </span><br><span class="line">            Offset (0xD0), </span><br><span class="line">            Offset (0xD2), </span><br><span class="line">            Offset (0xD4), </span><br><span class="line">            Offset (0xD6), </span><br><span class="line">            Offset (0xD8), </span><br><span class="line">            Offset (0xDA), </span><br><span class="line">            Offset (0xDC), </span><br><span class="line">            Offset (0xDE), </span><br><span class="line">            Offset (0xE0), </span><br><span class="line">            Offset (0xE2), </span><br><span class="line">            Offset (0xE4), </span><br><span class="line">            Offset (0xE6), </span><br><span class="line">            Offset (0xE8), </span><br><span class="line">            Offset (0xF0), </span><br><span class="line">            Offset (0xF2), </span><br><span class="line">            Offset (0xF4), </span><br><span class="line">            BSVN,   8, </span><br><span class="line">            BSVM,   8, </span><br><span class="line">            Offset (0xF8), </span><br><span class="line">            Offset (0xFA), </span><br><span class="line">            Offset (0xFC), </span><br><span class="line">            SBUY,   8, </span><br><span class="line">            SBUP,   8</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Method (BIFA, 0, NotSerialized)</span><br><span class="line">        &#123;</span><br><span class="line">            If (ECAV ())</span><br><span class="line">            &#123;</span><br><span class="line">                If (BSLF)</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (B1B2 (SBUY, SBUP), Local0)</span><br><span class="line">                &#125;</span><br><span class="line">                Else</span><br><span class="line">                &#123;</span><br><span class="line">                    Store (B1B2 (BSVN, BSVM), Local0)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Else</span><br><span class="line">            &#123;</span><br><span class="line">                Store (Ones, Local0)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Return (Local0)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Scope (_SB.PCI0.LPCB.EC0.BAT0)</span><br><span class="line">    &#123;</span><br><span class="line">        Method (_BIX, 0, NotSerialized)  // _BIX: Battery Information Extended</span><br><span class="line">        &#123;</span><br><span class="line">            If (LNot (BATP (Zero)))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (NBIX)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            If (LEqual (GBTT (Zero), 0xFF))</span><br><span class="line">            &#123;</span><br><span class="line">                Return (NBIX)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _BIF ()</span><br><span class="line">            Store (DerefOf (Index (PBIF, Zero)), Index (BIXT, One))</span><br><span class="line">            Store (DerefOf (Index (PBIF, One)), Index (BIXT, 0x02))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x02)), Index (BIXT, 0x03))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x03)), Index (BIXT, 0x04))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x04)), Index (BIXT, 0x05))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x05)), Index (BIXT, 0x06))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x06)), Index (BIXT, 0x07))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x07)), Index (BIXT, 0x0E))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x08)), Index (BIXT, 0x0F))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x09)), Index (BIXT, 0x10))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x0A)), Index (BIXT, 0x11))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x0B)), Index (BIXT, 0x12))</span><br><span class="line">            Store (DerefOf (Index (PBIF, 0x0C)), Index (BIXT, 0x13))</span><br><span class="line">            If (LEqual (DerefOf (Index (BIXT, One)), One))</span><br><span class="line">            &#123;</span><br><span class="line">                Store (Zero, Index (BIXT, One))</span><br><span class="line">                Store (DerefOf (Index (BIXT, 0x05)), Local0)</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x02)), Local0, Index (BIXT, 0x02))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x03)), Local0, Index (BIXT, 0x03))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x06)), Local0, Index (BIXT, 0x06))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x07)), Local0, Index (BIXT, 0x07))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x0E)), Local0, Index (BIXT, 0x0E))</span><br><span class="line">                Multiply (DerefOf (Index (BIXT, 0x0F)), Local0, Index (BIXT, 0x0F))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x02)), 0x03E8, Local0, Index (BIXT, 0x02))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x03)), 0x03E8, Local0, Index (BIXT, 0x03))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x06)), 0x03E8, Local0, Index (BIXT, 0x06))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x07)), 0x03E8, Local0, Index (BIXT, 0x07))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x0E)), 0x03E8, Local0, Index (BIXT, 0x0E))</span><br><span class="line">                Divide (DerefOf (Index (BIXT, 0x0F)), 0x03E8, Local0, Index (BIXT, 0x0F))</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Store (B1B2 (C3HG, C3HF), Index (BIXT, 0x08))</span><br><span class="line">            Store (0x0001869F, Index (BIXT, 0x09))</span><br><span class="line">            Return (BIXT)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Method (B1B2, 2, NotSerialized)</span><br><span class="line">    &#123;</span><br><span class="line">        Return (Or (Arg0, ShiftLeft (Arg1, 0x08)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="I2C触控板"><a href="#I2C触控板" class="headerlink" title="I2C触控板"></a>I2C触控板</h3><p>SSDT如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">DefinitionBlock (&quot;&quot;, &quot;SSDT&quot;, 2, &quot;_ASUS_&quot;, &quot;Notebook&quot;, 0x01072009)</span><br><span class="line">&#123;</span><br><span class="line">    External(TPDI, FieldUnitObj)</span><br><span class="line">    External(TPHI, FieldUnitObj)</span><br><span class="line">    External (_SB.PCI0.I2C1,DeviceObj)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Scope (_SB.PCI0.I2C1)</span><br><span class="line">    &#123;</span><br><span class="line">        Device (TPXX)</span><br><span class="line">        &#123;</span><br><span class="line">            Name (SBFG, ResourceTemplate ()</span><br><span class="line">               &#123;</span><br><span class="line">                    GpioInt (Level, ActiveLow, Exclusive, PullUp, 0x0000,</span><br><span class="line">                            &quot;\\_SB.PCI0.GPI0&quot;, 0x00, ResourceConsumer, ,</span><br><span class="line">                            )</span><br><span class="line">                            &#123;   // Pin list</span><br><span class="line">                                0x55</span><br><span class="line">                            &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">            </span><br><span class="line">            Name (_ADR, One)  // _ADR: Address</span><br><span class="line">            Name (ETPH, Package (0x16)</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1201&quot;, </span><br><span class="line">                &quot;ELAN1203&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1201&quot;, </span><br><span class="line">                &quot;ELAN1300&quot;, </span><br><span class="line">                &quot;ELAN1301&quot;, </span><br><span class="line">                &quot;ELAN1300&quot;, </span><br><span class="line">                &quot;ELAN1301&quot;, </span><br><span class="line">                &quot;ELAN1000&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1203&quot;, </span><br><span class="line">                &quot;ELAN1203&quot;, </span><br><span class="line">                &quot;ELAN1201&quot;, </span><br><span class="line">                &quot;ELAN1300&quot;, </span><br><span class="line">                &quot;ELAN1300&quot;, </span><br><span class="line">                &quot;ELAN1200&quot;, </span><br><span class="line">                &quot;ELAN1300&quot;</span><br><span class="line">            &#125;)</span><br><span class="line">            Name (FTPH, Package (0x05)</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;FTE1001&quot;, </span><br><span class="line">                &quot;FTE1200&quot;, </span><br><span class="line">                &quot;FTE1200&quot;, </span><br><span class="line">                &quot;FTE1300&quot;, </span><br><span class="line">                &quot;FTE1300&quot;</span><br><span class="line">            &#125;)</span><br><span class="line">            Method (_HID, 0, NotSerialized)  // _HID: Hardware ID</span><br><span class="line">            &#123;</span><br><span class="line">                If ((TPDI &amp; 0x04))</span><br><span class="line">                &#123;</span><br><span class="line">                    Return (DerefOf (ETPH [TPHI]))</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                If ((TPDI &amp; 0x10))</span><br><span class="line">                &#123;</span><br><span class="line">                    Return (DerefOf (FTPH [TPHI]))</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Return (&quot;ELAN1010&quot;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Name (_CID, &quot;PNP0C50&quot; /* HID Protocol Device (I2C bus) */)  // _CID: Compatible ID</span><br><span class="line">            Name (_UID, One)  // _UID: Unique ID</span><br><span class="line">            Name (_S0W, 0x03)  // _S0W: S0 Device Wake State</span><br><span class="line">            Method (_DSM, 4, NotSerialized)  // _DSM: Device-Specific Method</span><br><span class="line">            &#123;</span><br><span class="line">                If ((Arg0 == ToUUID (&quot;3cdff6f7-4267-4555-ad05-b30a3d8938de&quot;) /* HID I2C Device */))</span><br><span class="line">                &#123;</span><br><span class="line">                    If ((Arg2 == Zero))</span><br><span class="line">                    &#123;</span><br><span class="line">                        If ((Arg1 == One))</span><br><span class="line">                        &#123;</span><br><span class="line">                            Return (Buffer (One)</span><br><span class="line">                            &#123;</span><br><span class="line">                                 0x03                                             // .</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        Else</span><br><span class="line">                        &#123;</span><br><span class="line">                            Return (Buffer (One)</span><br><span class="line">                            &#123;</span><br><span class="line">                                 0x00                                             // .</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    If ((Arg2 == One))</span><br><span class="line">                    &#123;</span><br><span class="line">                        Return (One)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Else</span><br><span class="line">                &#123;</span><br><span class="line">                    Return (Buffer (One)</span><br><span class="line">                    &#123;</span><br><span class="line">                         0x00                                             // .</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (_STA, 0, NotSerialized)  // _STA: Status</span><br><span class="line">            &#123;</span><br><span class="line">                        If (_OSI (&quot;Darwin&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            Return (0x0F)</span><br><span class="line">        &#125;</span><br><span class="line">        Else</span><br><span class="line">        &#123;</span><br><span class="line">            Return (Zero)</span><br><span class="line">        &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Method (_CRS, 0, Serialized)  // _CRS: Current Resource Settings</span><br><span class="line">            &#123;</span><br><span class="line">                Name (SBFB, ResourceTemplate ()</span><br><span class="line">                &#123;</span><br><span class="line">                    I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,</span><br><span class="line">                        AddressingMode7Bit, &quot;\\_SB.PCI0.I2C1&quot;,</span><br><span class="line">                        0x00, ResourceConsumer, , Exclusive,</span><br><span class="line">                        )</span><br><span class="line">                &#125;)</span><br><span class="line">                Return (ConcatenateResTemplate (SBFB, SBFG))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="参考教程"><a href="#参考教程" class="headerlink" title="参考教程"></a>参考教程</h1><h2 id="Patching-LAPTOP-DSDT-x2F-SSDTs"><a href="#Patching-LAPTOP-DSDT-x2F-SSDTs" class="headerlink" title="Patching LAPTOP DSDT&#x2F;SSDTs"></a>Patching LAPTOP DSDT&#x2F;SSDTs</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.tonymacx86.com/threads/guide-patching-laptop-dsdt-ssdts.152573/</span><br></pre></td></tr></table></figure>

<h2 id="DSDT与SSDT编译错误解决方案合集汇总"><a href="#DSDT与SSDT编译错误解决方案合集汇总" class="headerlink" title="DSDT与SSDT编译错误解决方案合集汇总"></a>DSDT与SSDT编译错误解决方案合集汇总</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://imacos.top/2019/08/23/1709/</span><br></pre></td></tr></table></figure>

<h2 id="OpenCore引导各平台所需要的SSDT"><a href="#OpenCore引导各平台所需要的SSDT" class="headerlink" title="OpenCore引导各平台所需要的SSDT"></a>OpenCore引导各平台所需要的SSDT</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://imacos.top/2020/03/29/ssdt/</span><br></pre></td></tr></table></figure>

<h2 id="小白也能看懂的入门教程DSDT-x2F-SSDT-x2F-ROM提取完整步骤编译拆分补丁除错实现笔记本电脑电池显示"><a href="#小白也能看懂的入门教程DSDT-x2F-SSDT-x2F-ROM提取完整步骤编译拆分补丁除错实现笔记本电脑电池显示" class="headerlink" title="小白也能看懂的入门教程DSDT&#x2F;SSDT&#x2F;ROM提取完整步骤编译拆分补丁除错实现笔记本电脑电池显示"></a>小白也能看懂的入门教程DSDT&#x2F;SSDT&#x2F;ROM提取完整步骤编译拆分补丁除错实现笔记本电脑电池显示</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://imacos.top/2019/07/22/1409/</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/posts/Hackintosh-Installation.html" rel="prev" title="黑苹果的安装与配置">
      <i class="fa fa-chevron-left"></i> 黑苹果的安装与配置
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/posts/AMD-Hackintosh-Guide.html" rel="next" title="AMD安装黑苹果指南">
      AMD安装黑苹果指南 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ACPI%E4%BC%98%E5%8C%96"><span class="nav-text">ACPI优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DSDT"><span class="nav-text">DSDT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9"><span class="nav-text">修改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DTGP%E6%96%B9%E6%B3%95"><span class="nav-text">DTGP方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RTC%E4%BF%AE%E5%A4%8D"><span class="nav-text">RTC修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HPET%E4%BF%AE%E5%A4%8D"><span class="nav-text">HPET修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PIC-x2F-TIMR%E8%AE%BE%E5%A4%87%E4%BF%AE%E5%A4%8D"><span class="nav-text">PIC&#x2F;TIMR设备修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IOATAFamily-kext%E5%86%85%E6%A0%B8%E6%81%90%E6%85%8C%E4%BF%AE%E5%A4%8D"><span class="nav-text">IOATAFamily.kext内核恐慌修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%94%9FAHCI%E6%94%AF%E6%8C%81"><span class="nav-text">原生AHCI支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Clamshell%E4%BF%AE%E5%A4%8D"><span class="nav-text">Clamshell修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E5%A4%8DUUID-Error"><span class="nav-text">修复UUID Error</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A9EHCI-USB-2-0%E8%AF%86%E5%88%AB%E4%B8%BA%E5%86%85%E5%BB%BA"><span class="nav-text">让EHCI USB 2.0识别为内建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%B3%E8%BF%87%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%9F%A5"><span class="nav-text">跳过操作系统检查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E4%BA%AE%E5%BA%A6%E6%BB%91%E5%9D%97"><span class="nav-text">开启亮度滑块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8USB%E5%94%A4%E9%86%92%E7%9D%A1%E7%9C%A0"><span class="nav-text">用USB唤醒睡眠</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8VoodooHDA%E4%BD%86%E5%BF%98%E8%AE%B0%E5%88%A0%E9%99%A4AppleHDA%E4%BF%AE%E5%A4%8D"><span class="nav-text">使用VoodooHDA但忘记删除AppleHDA修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BDAC%E9%80%82%E9%85%8D%E5%99%A8%E9%A9%B1%E5%8A%A8"><span class="nav-text">引导加载AC适配器驱动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BDAppleLPC"><span class="nav-text">引导加载AppleLPC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BD%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8"><span class="nav-text">引导加载显卡驱动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E6%98%BE%E5%8D%A1"><span class="nav-text">禁用显卡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BD%E5%A3%B0%E5%8D%A1%E9%A9%B1%E5%8A%A8"><span class="nav-text">引导加载声卡驱动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E8%B0%83%E8%8A%82%E9%A3%8E%E6%89%87%E8%BD%AC%E9%80%9F%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-text">设置调节风扇转速快捷键</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%AE%E5%BA%A6%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84"><span class="nav-text">亮度按键映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BDAppleLPC"><span class="nav-text">加载AppleLPC</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95"><span class="nav-text">调试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSDT"><span class="nav-text">SSDT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E8%A1%A8"><span class="nav-text">列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSDT%E7%A4%BA%E4%BE%8B"><span class="nav-text">SSDT示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-EC"><span class="nav-text">SSDT-EC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-EC-USBX"><span class="nav-text">SSDT-EC-USBX</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-IMEI"><span class="nav-text">SSDT-IMEI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-PLUG"><span class="nav-text">SSDT-PLUG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-AWAC-x2F-SSDT-RTC0-RANGE-HEDT"><span class="nav-text">SSDT-AWAC&#x2F;SSDT-RTC0-RANGE-HEDT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-PMC"><span class="nav-text">SSDT-PMC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-RHUB"><span class="nav-text">SSDT-RHUB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-PNLF"><span class="nav-text">SSDT-PNLF</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-XOSI"><span class="nav-text">SSDT-XOSI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-UNC"><span class="nav-text">SSDT-UNC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-CPUR"><span class="nav-text">SSDT-CPUR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSDT-SBUS-MCHC"><span class="nav-text">SSDT-SBUS-MCHC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IRQ-SSDT"><span class="nav-text">IRQ SSDT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FixShutdown-USB-SSDT"><span class="nav-text">FixShutdown-USB-SSDT</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSDT%E7%94%9F%E6%88%90"><span class="nav-text">SSDT生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSDT%E5%88%B6%E4%BD%9C"><span class="nav-text">SSDT制作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E5%BC%95%E7%94%A8"><span class="nav-text">外部引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="nav-text">偏移量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A2%84%E7%BD%AE%E5%8F%98%E9%87%8F%E6%B3%95%E5%BC%80%E5%85%B3%E8%AE%BE%E5%A4%87"><span class="nav-text">预置变量法开关设备</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E6%83%85%E5%86%B5"><span class="nav-text">一般情况</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5"><span class="nav-text">特殊情况</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="nav-text">基本框架</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B5%E6%B1%A0%E4%BF%AE%E8%A1%A5"><span class="nav-text">电池修补</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A1%AE%E8%AE%A4%E4%BF%AE%E6%94%B9%E4%BD%8D%E7%BD%AE"><span class="nav-text">确认修改位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5"><span class="nav-text">数据插入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BD%8D%E7%BD%AE%E4%BB%A3%E7%A0%81"><span class="nav-text">添加位置代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%83%A8%E5%BC%95%E7%94%A8"><span class="nav-text">添加外部引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E5%A4%84%E7%90%86"><span class="nav-text">字节处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%90%8D%E8%A1%A5%E4%B8%81"><span class="nav-text">添加更名补丁</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-OSI%E5%88%A4%E6%96%AD"><span class="nav-text">添加_OSI判断</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%8C%E6%88%90%E4%BF%AE%E8%A1%A5"><span class="nav-text">完成修补</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86"><span class="nav-text">特殊处理</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%83%A0%E6%99%AE%E7%AC%94%E8%AE%B0%E6%9C%ACACEL%E8%AE%BE%E5%A4%87%E7%A6%81%E6%AD%A2"><span class="nav-text">惠普笔记本ACEL设备禁止</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#ECRD%E5%92%8CECWT%E8%AF%BB%E5%86%99%E6%8E%A7%E5%88%B6"><span class="nav-text">ECRD和ECWT读写控制</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%8F%8C%E7%94%B5%E6%B1%A0%E7%B3%BB%E7%BB%9F"><span class="nav-text">双电池系统</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I2C%E8%A7%A6%E6%8E%A7%E6%9D%BF%E4%BF%AE%E8%A1%A5"><span class="nav-text">I2C触控板修补</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E8%A1%A5%E5%87%86%E5%A4%87"><span class="nav-text">修补准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E5%8E%9F%E8%AE%BE%E5%A4%87"><span class="nav-text">禁用原设备</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E9%A2%84%E7%BD%AE%E5%8F%98%E9%87%8F%E6%B3%95"><span class="nav-text">通过预置变量法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-STA%E4%BF%AE%E6%94%B9%E6%B3%95"><span class="nav-text">通过_STA修改法</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E7%94%A8GPIO"><span class="nav-text">启用GPIO</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E7%83%AD%E8%A1%A5%E4%B8%81"><span class="nav-text">新建热补丁</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4APIC%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-text">移除APIC中断控制器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#GPIO%E5%9B%BA%E5%AE%9A"><span class="nav-text">GPIO固定</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E8%A1%A5"><span class="nav-text">代码修补</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97GPIO-Pin"><span class="nav-text">计算GPIO Pin</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%A1%AB%E5%85%A5GPIO-Pin"><span class="nav-text">填入GPIO Pin</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%83%A8%E5%BC%95%E7%94%A8-1"><span class="nav-text">添加外部引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%8C%E6%88%90%E4%BF%AE%E8%A1%A5-1"><span class="nav-text">完成修补</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ACPIDebug"><span class="nav-text">ACPIDebug</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A9%B1%E5%8A%A8"><span class="nav-text">驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-text">使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96"><span class="nav-text">系统优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8E%E7%A1%95%E7%AC%94%E8%AE%B0%E6%9C%AC%E9%94%AE%E7%9B%98%E4%BF%AE%E5%A4%8D"><span class="nav-text">华硕笔记本键盘修复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%94%AE%E9%A9%B1%E5%8A%A8"><span class="nav-text">按键驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%94%AE%E4%BF%AE%E5%A4%8D"><span class="nav-text">按键修复</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87DSDT"><span class="nav-text">通过DSDT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87SSDT"><span class="nav-text">通过SSDT</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%AE%E5%BA%A6%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%B0%83%E6%95%B4"><span class="nav-text">亮度快捷键调整</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU%E6%98%BE%E7%A4%BA%E6%9C%AA%E7%9F%A5%E4%BF%AE%E5%A4%8D"><span class="nav-text">CPU显示未知修复</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E4%B8%8E%E7%BB%B4%E6%8A%A4"><span class="nav-text">系统安装与维护</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9InstallESD-dmg"><span class="nav-text">修改InstallESD.dmg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%BB%E9%99%A4%E6%9C%BA%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="nav-text">去除机型检查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%81%A2%E5%A4%8D%E7%9B%98"><span class="nav-text">恢复盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FireWolf-OS-X-PE"><span class="nav-text">FireWolf OS X PE</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8"><span class="nav-text">引导启动</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E8%AF%95%E4%B8%8E%E6%97%A5%E5%BF%97"><span class="nav-text">系统调试与日志</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%86%85%E5%AE%B9"><span class="nav-text">日志内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#previous-shutdown-cause-5"><span class="nav-text">previous shutdown cause:5</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E6%A0%B8Panic"><span class="nav-text">内核Panic</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%95%B0%E5%AD%97%E5%90%AB%E4%B9%89"><span class="nav-text">错误数字含义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90"><span class="nav-text">错误分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Hub%E6%97%A5%E5%BF%97"><span class="nav-text">Data Hub日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UEFI%E5%8F%98%E9%87%8F%E6%97%A5%E5%BF%97"><span class="nav-text">UEFI变量日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%A5%97%E4%BB%B6"><span class="nav-text">内核调试套件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD"><span class="nav-text">卸载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7"><span class="nav-text">工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSDTTime"><span class="nav-text">SSDTTime</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD"><span class="nav-text">下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%90%E7%A4%BACould-not-locate-or-download-iasl"><span class="nav-text">提示Could not locate or download iasl!</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A7%E7%89%88%E5%B7%A5%E5%85%B7"><span class="nav-text">旧版工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DSDT-editor"><span class="nav-text">DSDT editor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DSDT%E5%BA%93"><span class="nav-text">DSDT库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E6%9C%BA%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="nav-text">本机文件内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DSDT-1"><span class="nav-text">DSDT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B5%E6%B1%A0"><span class="nav-text">电池</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSDT-1"><span class="nav-text">SSDT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B5%E6%B1%A0-1"><span class="nav-text">电池</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#I2C%E8%A7%A6%E6%8E%A7%E6%9D%BF"><span class="nav-text">I2C触控板</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%95%99%E7%A8%8B"><span class="nav-text">参考教程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Patching-LAPTOP-DSDT-x2F-SSDTs"><span class="nav-text">Patching LAPTOP DSDT&#x2F;SSDTs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DSDT%E4%B8%8ESSDT%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%90%88%E9%9B%86%E6%B1%87%E6%80%BB"><span class="nav-text">DSDT与SSDT编译错误解决方案合集汇总</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenCore%E5%BC%95%E5%AF%BC%E5%90%84%E5%B9%B3%E5%8F%B0%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84SSDT"><span class="nav-text">OpenCore引导各平台所需要的SSDT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%99%BD%E4%B9%9F%E8%83%BD%E7%9C%8B%E6%87%82%E7%9A%84%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8BDSDT-x2F-SSDT-x2F-ROM%E6%8F%90%E5%8F%96%E5%AE%8C%E6%95%B4%E6%AD%A5%E9%AA%A4%E7%BC%96%E8%AF%91%E6%8B%86%E5%88%86%E8%A1%A5%E4%B8%81%E9%99%A4%E9%94%99%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%94%B5%E8%84%91%E7%94%B5%E6%B1%A0%E6%98%BE%E7%A4%BA"><span class="nav-text">小白也能看懂的入门教程DSDT&#x2F;SSDT&#x2F;ROM提取完整步骤编译拆分补丁除错实现笔记本电脑电池显示</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Payton"
      src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Payton</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-comments"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Payton</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">30:27</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
